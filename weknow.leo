<?xml version="1.0" encoding="utf-8"?>
<!-- Created by Leo (http://webpages.charter.net/edreamleo/front.html) -->
<?xml-stylesheet ekr_test?>
<leo_file xmlns:leo="http://www.leo-editor.org/2011/leo" >
<leo_header file_format="2" tnodes="0" max_tnode_index="0" clone_windows="0"/>
<globals body_outline_ratio="0.5" body_secondary_ratio="0.5">
	<global_window_position top="50" left="50" height="500" width="700"/>
	<global_log_window_position top="0" left="0" height="0" width="0"/>
</globals>
<preferences/>
<find_panel_settings/>
<vnodes>
<v t="zoomq.20120710140424.5446" a="E"><vh>4SAE</vh>
<v t="zoomq.20120710140424.5447"><vh>@nosent README.md</vh></v>
<v t="zoomq.20120710140424.5454"><vh>@nosent config.yaml</vh></v>
<v t="zoomq.20120710140424.5455"><vh>@nosent index.wsgi</vh></v>
<v t="zoomq.20120727213305.3937"><vh>功能/数据mapping</vh>
<v t="zoomq.20120727213305.14708"><vh>TODO</vh></v>
<v t="zoomq.20120720204727.3913"><vh>URL mapping</vh></v>
<v t="zoomq.20120720204727.3914"><vh>KV mapping</vh></v>
</v>
<v t="zoomq.20120723102156.5544" a="E"><vh>@nosent config.py</vh>
<v t="zoomq.20120727213305.14750"><vh>组件引用</vh></v>
<v t="zoomq.20120710140424.5456"><vh>&lt;&lt;cfg4Borg&gt;&gt;</vh>
<v t="zoomq.20120820121523.7443"><vh>4API+authentication</vh></v>
</v>
</v>
<v t="zoomq.20120723102156.5541"><vh>module</vh>
<v t="zoomq.20120723102156.5544" a="E"></v>
<v t="zoomq.20120802192540.5461"><vh>MANIFEST4CRX()</vh></v>
<v t="zoomq.20120717112543.5481"><vh>@nosent utility.py</vh>
<v t="zoomq.20120727213305.14698"><vh>&lt;&lt;declarations&gt;&gt;</vh></v>
<v t="zoomq.20120727213305.14751"><vh>KV4CRX()</vh></v>
<v t="zoomq.20120805183037.4193"><vh>KV4GRP()</vh>
<v t="zoomq.20120805183037.5897"><vh>&lt;&lt;set crc grp 相关值列表&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120804110957.4478"><vh>ST4CRX()</vh></v>
<v t="zoomq.20120802192540.8726"><vh>PUTHIS()</vh></v>
<v t="zoomq.20120804110957.4146"><vh>PUT2SS()</vh></v>
<v t="zoomq.20120804110957.4489"><vh>PUT_PIC4CRX()</vh></v>
<v t="zoomq.20120727213305.14756"><vh>INIobjSYS()</vh></v>
<v t="zoomq.20120802192540.5463"><vh>IDX4LIST()</vh></v>
<v t="zoomq.20120804110957.4144"><vh>POP4KV()</vh></v>
<v t="zoomq.20120802192540.8728"><vh>INS2KV()</vh></v>
<v t="zoomq.20120804110957.4485"><vh>POP4LIST()</vh></v>
<v t="zoomq.20120805183037.4187"><vh>INS2LIST()</vh></v>
<v t="zoomq.20120805183037.5896"><vh>INS2DICT4LIST()</vh></v>
<v t="zoomq.20120802192540.7100"><vh>TSTAMP()</vh></v>
<v t="zoomq.20120802192540.5468"><vh>GENID()</vh></v>
<v t="zoomq.20120727213305.14699"><vh>INCR4KV()</vh></v>
<v t="zoomq.20120727213305.14701"><vh>INCR4MM()</vh></v>
</v>
<v t="zoomq.20120727213305.14687"><vh>@nosent crx_id.py</vh>
<v t="zoomq.20120727213305.14688"><vh>crx_id declarations</vh></v>
<v t="zoomq.20120727213305.14689"><vh>usage</vh></v>
<v t="zoomq.20120727213305.14690"><vh>HexToInt</vh></v>
<v t="zoomq.20120727213305.14691"><vh>HexToMPDecimal</vh></v>
<v t="zoomq.20120727213305.14692"><vh>HexTo256</vh></v>
<v t="zoomq.20120727213305.14693"><vh>GetPublicKey</vh></v>
<v t="zoomq.20120727213305.14694"><vh>GetCRXHash</vh></v>
<v t="zoomq.20120727213305.14695"><vh>GetCRXAppID</vh></v>
<v t="zoomq.20120727213305.14696"><vh>GetCRXAppID4upload</vh></v>
<v t="zoomq.20120727213305.14697"><vh>main</vh></v>
</v>
<v t="zoomq.20120811092308.5970"><vh>@nosent data_uri.py</vh></v>
<v t="zoomq.20120820121523.7422"><vh>@nosent auth.py</vh>
<v t="zoomq.20120820121523.7423"><vh>&lt;&lt;declarations&gt;&gt;</vh></v>
<v t="zoomq.20120820121523.7426"><vh>sha256_uhex</vh></v>
<v t="zoomq.20120820121523.7424"><vh>check_login</vh></v>
<v t="zoomq.20120820121523.7425"><vh>auth_required</vh></v>
</v>
<v t="zoomq.20120820121523.7432"><vh>@nosent lb4crx2cli.py</vh>
<v t="zoomq.20120820121523.7433" a="E"><vh>&lt;&lt;declarations&gt;&gt;</vh>
<v t="zoomq.20120820121523.7438"><vh>cfg. Borg</vh></v>
</v>
<v t="zoomq.20120820121523.7437"><vh>__genRESTargs</vh></v>
<v t="zoomq.20120820121523.7442"><vh>__genRESTsign</vh></v>
<v t="zoomq.20120820121523.7439"><vh>call2sae</vh></v>
</v>
</v>
<v t="zoomq.20120723102156.5543" a="E"><vh>web</vh>
<v t="zoomq.20120723102156.5545"><vh>@nosent __init__.py</vh>
<v t="zoomq.20120723102156.5546"><vh>__init__ declarations</vh></v>
<v t="zoomq.20120723102156.5548"><vh>/</vh></v>
<v t="zoomq.20120727213305.14707"><vh>404+各种默认处理</vh></v>
<v t="zoomq.20120723102156.5547"><vh>handel_redirect</vh></v>
</v>
<v t="zoomq.20120723102156.5561" a="E"><vh>@nosent mana4api.py</vh>
<v t="zoomq.20120723102156.5562"><vh>&lt;&lt;declarations&gt;&gt;</vh></v>
<v t="zoomq.20120723102156.5568"><vh>/api</vh></v>
<v t="zoomq.20120820121523.7421"><vh>/api/dc</vh></v>
<v t="zoomq.20121015120918.6115"><vh>/api/dc/add</vh></v>
<v t="zoomq.20121015120918.7801"><vh>pep265sd</vh></v>
<v t="zoomq.20121015120918.6117"><vh>/api/dc/dlrank</vh></v>
<v t="zoomq.20121015120918.7800"><vh>/api/cron/dlrank</vh></v>
<v t="zoomq.20120820121523.7444" a="E"><vh>4CLI</vh>
<v t="zoomq.20120820121523.7441"><vh>/api/cli</vh>
<v t="zoomq.20120821205456.4730"><vh>&lt;&lt;CRX matters&gt;&gt;</vh>
<v t="zoomq.20120821205456.4736"><vh>&lt;&lt;crx单独信息&gt;&gt;</vh></v>
<v t="zoomq.20120821205456.4735"><vh>&lt;&lt;crx下载数调整&gt;&gt;</vh></v>
<v t="zoomq.20120821205456.4734"><vh>&lt;&lt;crx统计信息&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120820121523.7445"><vh>&lt;&lt;USR matters&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120821205456.4726"><vh>_usradd()</vh></v>
<v t="zoomq.20120821205456.4728"><vh>_usrset()</vh></v>
<v t="zoomq.20120821205456.4729"><vh>_usrchk()</vh></v>
<v t="zoomq.20120821205456.4732"><vh>_xinfo()</vh></v>
<v t="zoomq.20120821205456.4738"><vh>_json()</vh></v>
</v>
<v t="zoomq.20120727213305.13050"><vh>/api/sysincr</vh></v>
<v t="zoomq.20120727213305.14707"></v>
</v>
<v t="zoomq.20120821205456.5127"><vh>apiSTUFF</vh>
<v t="zoomq.20120820121523.7054"><vh>/api/js</vh></v>
<v t="zoomq.20120820121523.7051"><vh>/api/js</vh></v>
</v>
<v t="zoomq.20120710140424.5489"><vh>@nosent mana4up.py</vh>
<v t="zoomq.20120717112543.5477"><vh>&lt;&lt;declarations&gt;&gt;</vh></v>
<v t="zoomq.20120811092308.5972"><vh>/up</vh></v>
<v t="zoomq.20120805183037.4195"><vh>/up/:gid</vh></v>
<v t="zoomq.20120805183037.4207"><vh>/up/:gid/ed</vh></v>
<v t="zoomq.20120805183037.4217"><vh>/up/:gid/info</vh></v>
<v t="zoomq.20120717112543.5478"><vh>/up/:gid/crx/add</vh>
<v t="zoomq.20120805183037.5879" a="E"><vh>&lt;&lt;crx upload&gt;&gt;</vh>
<v t="zoomq.20120805183037.5887"><vh>&lt;&lt;upgrade crx&gt;&gt;</vh></v>
<v t="zoomq.20120805183037.5880"><vh>&lt;&lt;new .crx&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20120805183037.5882"><vh>up/:gid/crx/:uuid/duplicate</vh></v>
<v t="zoomq.20120805183037.5876"><vh>/up/:gid/crx/:uuid</vh></v>
<v t="zoomq.20120805183037.4197"><vh>/up/:gid/crx/:uuid/ed</vh></v>
<v t="zoomq.20120717112543.5479"><vh>/up/:gid/crx/:uuid/info</vh></v>
<v t="zoomq.20120805183037.5891"><vh>/up/:gid/crx/:uuid/pub</vh></v>
<v t="zoomq.20120805183037.4235"><vh>/up/:gid/crx/:uuid/pic/:pid/ed</vh></v>
<v t="zoomq.20120805183037.4241"><vh>/up/:gid/crx/:uuid/pic/:pid/see</vh></v>
<v t="zoomq.20120805183037.4247"><vh>/up/:gid/crx/:uuid/pic/:pid/del</vh></v>
<v t="zoomq.20120727213305.14707"></v>
</v>
<v t="zoomq.20120723102156.5585"><vh>@nosent mana4sys.py</vh>
<v t="zoomq.20120723102156.5586"><vh>&lt;&lt;declarations&gt;&gt;</vh></v>
<v t="zoomq.20120821205456.5126"><vh>usrs/</vh></v>
<v t="zoomq.20120727213305.14707"></v>
<v t="zoomq.20120804110957.4482"><vh>/mana</vh>
<v t="zoomq.20120805183037.15010"><vh>gen</vh></v>
<v t="zoomq.20120811092308.4297"><vh>gen/:uuid.html</vh></v>
<v t="zoomq.20120811092308.5959"><vh>gen/:tid.html</vh>
<v t="zoomq.20120812211216.4323"><vh>&lt;&lt;GEN APP.PAGE&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20120727213305.14835"><vh>crxs/</vh>
<v t="zoomq.20121015120918.6085"><vh>crx/ini-&gt;</vh>
<v t="zoomq.20121015120918.6086" a="E"><vh>&lt;&lt;crx upload&gt;&gt;</vh>
<v t="zoomq.20121015120918.6087"><vh>&lt;&lt;read JSON&gt;&gt;</vh></v>
<v t="zoomq.20121015120918.6088"><vh>&lt;&lt;upgrade crx&gt;&gt;</vh></v>
<v t="zoomq.20121015120918.6089"><vh>&lt;&lt;set KV&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20120727213305.14837"><vh>crx/:uuid</vh></v>
<v t="zoomq.20120804110957.4136"><vh>crx/:uuid/ed</vh></v>
<v t="zoomq.20120727213305.14836"><vh>crx/jsini</vh></v>
<v t="zoomq.20121015120918.6108" a="E"><vh>crx/jsup</vh>
<v t="zoomq.20121015120918.6109" a="E"><vh>&lt;&lt;ujsfile upload&gt;&gt;</vh>
<v t="zoomq.20121015120918.6111"><vh>&lt;&lt;upgrade crx&gt;&gt;</vh></v>
<v t="zoomq.20121015120918.6112"><vh>&lt;&lt;set KV&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20120727213305.14840" a="E"><vh>crx/:uuid/info-&gt;</vh>
<v t="zoomq.20120805183037.4183"><vh>CRX更新</vh></v>
<v t="zoomq.20120805183037.4184"><vh>TAG绑定</vh></v>
<v t="zoomq.20120805183037.4185"><vh>GRP绑定</vh></v>
</v>
<v t="zoomq.20120727213305.14838"><vh>crx/:uuid/duplicate</vh></v>
<v t="zoomq.20120723102156.5593"><vh>crx/:uuid/pic/:sid/del-&gt;</vh></v>
<v t="zoomq.20120804110957.4487"><vh>crx/:uuid/pic/:sid/ed</vh></v>
<v t="zoomq.20120804110957.4495"><vh>crx/:uuid/pic/:sid/see</vh></v>
<v t="zoomq.20120727213305.14842"><vh>crx/pubs</vh></v>
<v t="zoomq.20120727213305.14864"><vh>crx/:uuid/try</vh></v>
<v t="zoomq.20120727213305.14854"><vh>crx/:uuid/pub-&gt;</vh></v>
<v t="zoomq.20120727213305.14839"><vh>crx/:uuid/out-&gt;</vh></v>
<v t="zoomq.20120727213305.14856"><vh>crx/:uuid/bak-&gt;</vh></v>
<v t="zoomq.20120802192540.7098"><vh>crx/:uuid/arch-&gt;</vh></v>
<v t="zoomq.20120804110957.4153"><vh>crx/:uuid/recover-&gt;</vh></v>
</v>
<v t="zoomq.20120727213305.14727"><vh>tags/</vh>
<v t="zoomq.20120727213305.14759"><vh>tag/ini-&gt;</vh></v>
<v t="zoomq.20120727213305.14761"><vh>tag/:tid</vh></v>
<v t="zoomq.20120727213305.14767"><vh>tag/:tid/ed</vh></v>
<v t="zoomq.20120727213305.14775"><vh>tag/:tid/del-&gt;</vh></v>
<v t="zoomq.20120727213305.14771"><vh>tag/:tid/info</vh></v>
</v>
<v t="zoomq.20120727213305.14803"><vh>grps/</vh>
<v t="zoomq.20120727213305.14804"><vh>grp/ini-&gt;</vh></v>
<v t="zoomq.20120727213305.14805"><vh>grp/:gid</vh></v>
<v t="zoomq.20120727213305.14806"><vh>grp/:gid/ed</vh></v>
<v t="zoomq.20120727213305.14808"><vh>grp/:gid/info</vh></v>
<v t="zoomq.20120727213305.14807"><vh>grp/:gid/del-&gt;</vh></v>
</v>
</v>
</v>
<v t="zoomq.20120727213305.14715" a="E"><vh>templates</vh>
<v t="zoomq.20120812115324.4334"><vh>&lt;&lt;sspathdefine&gt;&gt;</vh></v>
<v t="zoomq.20120727213305.14728"><vh>BASE组件</vh>
<v t="zoomq.20120710140424.5449" a="E"><vh>@nosent base.html</vh>
<v t="zoomq.20120812115324.4334"></v>
<v t="zoomq.20120710140424.5453"><vh>CSS</vh>
<v t="zoomq.20120804110957.4149"><vh>esp. 警告...</vh></v>
<v t="zoomq.20120804110957.4148"><vh>表单相关</vh></v>
<v t="zoomq.20120804110957.4147"><vh>textarea+select</vh></v>
<v t="zoomq.20120727213305.14772"><vh>button</vh></v>
<v t="zoomq.20120727213305.14773"><vh>a as button</vh></v>
<v t="zoomq.20120727213305.14781"><vh>a as btn in &lt;sub&gt;</vh></v>
</v>
<v t="zoomq.20120727213305.14749"><vh>validatious.1.0.5.min.css</vh></v>
</v>
<v t="zoomq.20120727213305.14719"><vh>@nosent validatious.html</vh>
<v t="zoomq.20120727213305.14735"><vh>&lt;&lt;validatious.0.9.1.min.js&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120727213305.14741"><vh>@nosent validate.js.html</vh>
<v t="zoomq.20120727213305.14738"><vh>&lt;&lt;validate.js 1.1&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120727213305.14737"><vh>@nosent manav.html</vh></v>
<v t="zoomq.20120727213305.14705"><vh>@nosent 404.html</vh></v>
</v>
<v t="zoomq.20120727213305.14717"><vh>@nosent index.html</vh></v>
<v t="zoomq.20120727213305.14782"><vh>扩展管理</vh>
<v t="zoomq.20120727213305.14848" a="E"><vh>@nosent crxs.html</vh>
<v t="zoomq.20120727213305.14849"><vh>&lt;&lt;1st CRX&gt;&gt;</vh></v>
<v t="zoomq.20120727213305.14850" a="E"><vh>&lt;&lt;CRX li&gt;&gt;</vh>
<v t="zoomq.20120821205456.4733"><vh>&lt;&lt;zip info.s&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120727213305.14851" a="E"><vh>&lt;&lt;CRX pub&gt;&gt;</vh>
<v t="zoomq.20120821205456.4733"></v>
</v>
<v t="zoomq.20120805183037.5894" a="E"><vh>&lt;&lt;CRX bak&gt;&gt;</vh>
<v t="zoomq.20120821205456.4733"></v>
</v>
<v t="zoomq.20120727213305.14852"><vh>&lt;&lt;CRX out&gt;&gt;</vh>
<v t="zoomq.20120821205456.4733"></v>
</v>
<v t="zoomq.20120804110957.4151"><vh>&lt;&lt;CRX arch&gt;&gt;</vh>
<v t="zoomq.20120821205456.4733"></v>
</v>
</v>
<v t="zoomq.20120727213305.14791"><vh>@nosent crx.html</vh>
<v t="zoomq.20120727213305.14792"><vh>&lt;&lt;详情展示&gt;&gt;</vh></v>
<v t="zoomq.20120804110957.4483"><vh>&lt;&lt;配图&gt;&gt;</vh></v>
<v t="zoomq.20120804110957.4480"><vh>&lt;&lt;操作按钮&gt;&gt;</vh></v>
<v t="zoomq.20120805183037.5889"><vh>&lt;&lt;退回信息&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120804110957.4139"><vh>@nosent crxpic.html</vh>
<v t="zoomq.20120811092308.4293"><vh>图片详情</vh></v>
<v t="zoomq.20120804110957.4140"><vh>提交表单</vh></v>
</v>
<v t="zoomq.20120727213305.14786"><vh>@nosent crxtry.html</vh>
<v t="zoomq.20120727213305.14862"><vh>定制表单</vh></v>
</v>
<v t="zoomq.20120804110957.4498"><vh>@nosent seepic.html</vh>
<v t="zoomq.20120811092308.4294"><vh>图片详情</vh></v>
<v t="zoomq.20120804110957.4499"><vh>提交表单</vh></v>
</v>
<v t="zoomq.20120804110957.4492"><vh>@nosent crxed.html</vh>
<v t="zoomq.20120804110957.4493" a="E"><vh>提交表单</vh>
<v t="zoomq.20120812115324.4331"><vh>&lt;&lt;操作按钮&gt;&gt;</vh></v>
<v t="zoomq.20120812115324.4332"><vh>&lt;&lt;详情&gt;&gt;</vh></v>
<v t="zoomq.20120804110957.4500"><vh>&lt;&lt;标签选列&gt;&gt;</vh></v>
<v t="zoomq.20120804110957.4502"><vh>&lt;&lt;团队选列&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20121015120918.6096" a="E"><vh>@nosent ujsed.html</vh>
<v t="zoomq.20121015120918.6097" a="E"><vh>提交表单</vh>
<v t="zoomq.20121015120918.6098"><vh>&lt;&lt;操作按钮&gt;&gt;</vh></v>
<v t="zoomq.20121015120918.6102"><vh>&lt;&lt;.js&gt;&gt;</vh></v>
<v t="zoomq.20121015120918.6099"><vh>&lt;&lt;详情&gt;&gt;</vh></v>
<v t="zoomq.20121015120918.6100"><vh>&lt;&lt;标签选列&gt;&gt;</vh></v>
<v t="zoomq.20121015120918.6101"><vh>&lt;&lt;团队选列&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20120727213305.14795"><vh>@nosent crxduplicated.html</vh>
<v t="zoomq.20120804110957.4142"><vh>详情展示</vh></v>
</v>
<v t="zoomq.20120727213305.14859"><vh>@nosent crxpubs.html</vh>
<v t="zoomq.20120727213305.14860"><vh>&lt;&lt;CRX pub&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20120811092308.4295"><vh>服务功能</vh>
<v t="zoomq.20120811092308.5956"><vh>@nosent gen.html</vh></v>
<v t="zoomq.20120811092308.4307"><vh>@nosent expbase.html</vh>
<v t="zoomq.20120812115324.4334"></v>
<v t="zoomq.20120811092308.4308" a="E"><vh>&lt;&lt;CSS&gt;&gt;</vh>
<v t="zoomq.20120811092308.5969"><vh>CSS Buttons</vh></v>
</v>
</v>
<v t="zoomq.20120727213305.14721"><vh>@nosent gentag.html</vh>
<v t="zoomq.20120811092308.5967"><vh>TITLE</vh></v>
<v t="zoomq.20120811092308.5966"><vh>TAGs</vh></v>
<v t="zoomq.20120811092308.5968"><vh>APP.s</vh></v>
<v t="zoomq.20120811092308.5964" a="E"><vh>&lt;&lt;CSS&gt;&gt;</vh>
<v t="zoomq.20120811092308.5965"><vh>img</vh></v>
</v>
</v>
<v t="zoomq.20120811092308.5963"><vh>@nosent gencrx.html</vh></v>
</v>
<v t="zoomq.20120727213305.14733"><vh>用户服务</vh>
<v t="zoomq.20120805183037.4212"><vh>@nosent upalertnoid.html</vh></v>
<v t="zoomq.20120811092308.5978"><vh>@nosent upgrp.html</vh>
<v t="zoomq.20120811092308.5979"><vh>&lt;&lt;add CRX&gt;&gt;</vh></v>
<v t="zoomq.20120811092308.5980"><vh>&lt;&lt;团队信息&gt;&gt;</vh></v>
<v t="zoomq.20120811092308.5981"><vh>&lt;&lt;操作指引&gt;&gt;</vh></v>
<v t="zoomq.20120811092308.5982"><vh>&lt;&lt;扩展信息&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120805183037.4202"><vh>@nosent upgrped.html</vh>
<v t="zoomq.20120805183037.4203"><vh>&lt;&lt;团队信息&gt;&gt;</vh></v>
<v t="zoomq.20120805183037.4205"><vh>&lt;&lt;操作指引&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120805183037.4222"><vh>@nosent upcrx.html</vh>
<v t="zoomq.20120805183037.4223"><vh>&lt;&lt;详情展示&gt;&gt;</vh></v>
<v t="zoomq.20120805183037.4224"><vh>&lt;&lt;配图&gt;&gt;</vh></v>
<v t="zoomq.20120805183037.4225"><vh>&lt;&lt;操作按钮&gt;&gt;</vh></v>
</v>
<v t="zoomq.20120805183037.4230"><vh>@nosent upcrxed.html</vh>
<v t="zoomq.20120805183037.4231"><vh>提交表单</vh>
<v t="zoomq.20120805183037.4232"><vh>标签选列</vh></v>
</v>
</v>
<v t="zoomq.20120805183037.5885"><vh>@nosent upcrxduplicated.html</vh>
<v t="zoomq.20120805183037.5886"><vh>详情展示</vh></v>
</v>
<v t="zoomq.20120805183037.4238"><vh>@nosent upcrxpic.html</vh>
<v t="zoomq.20120805183037.4239"><vh>提交表单</vh></v>
</v>
<v t="zoomq.20120805183037.4244"><vh>@nosent upseepic.html</vh>
<v t="zoomq.20120805183037.4245"><vh>提交表单</vh></v>
</v>
</v>
<v t="zoomq.20120805183037.15012"><vh>@nosent mana.html</vh></v>
<v t="zoomq.20120727213305.14817"><vh>权限管理</vh>
<v t="zoomq.20120727213305.14822"><vh>@nosent authors.html</vh>
<v t="zoomq.20120727213305.14823"><vh>&lt;&lt;author li&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20120821205456.5115"><vh>团队管理</vh>
<v t="zoomq.20120821205456.5116" a="E"><vh>@nosent grped.html</vh>
<v t="zoomq.20120821205456.5117"><vh>定制表单</vh></v>
<v t="zoomq.20120821205456.5118"><vh>操作按钮</vh></v>
</v>
<v t="zoomq.20120821205456.5119" a="E"><vh>@nosent grp.html</vh>
<v t="zoomq.20120821205456.5120"><vh>团队信息</vh></v>
<v t="zoomq.20120821205456.5121"><vh>扩展信息</vh></v>
<v t="zoomq.20120821205456.5122"><vh>操作指引</vh></v>
</v>
<v t="zoomq.20120821205456.5123"><vh>@nosent grps.html</vh>
<v t="zoomq.20120821205456.5124"><vh>&lt;&lt;1st GRP&gt;&gt;</vh></v>
<v t="zoomq.20120821205456.5125"><vh>&lt;&lt;GRP li&gt;&gt;</vh></v>
</v>
</v>
<v t="zoomq.20120727213305.14729"><vh>标签管理</vh>
<v t="zoomq.20120727213305.14725" a="E"><vh>@nosent taged.html</vh>
<v t="zoomq.20120727213305.14776"><vh>定制表单</vh></v>
</v>
<v t="zoomq.20120727213305.14769"><vh>@nosent tag.html</vh>
<v t="zoomq.20120805183037.4190"><vh>标签信息</vh></v>
<v t="zoomq.20120805183037.4191"><vh>扩展信息</vh></v>
<v t="zoomq.20120727213305.14778"><vh>操作指引</vh></v>
</v>
<v t="zoomq.20120727213305.14764"><vh>@nosent tags.html</vh>
<v t="zoomq.20120727213305.14779"><vh>&lt;&lt;TAGli&gt;&gt;</vh></v>
<v t="zoomq.20120727213305.14765"><vh>&lt;&lt;1st TAG&gt;&gt;</vh></v>
</v>
</v>
</v>
<v t="zoomq.20120717112543.5493"><vh>__chaos</vh>
<v t="zoomq.20120727213305.14743"><vh>&lt;&lt;validate&gt;&gt;</vh></v>
<v t="zoomq.20120727213305.14734"><vh>表单JS验证</vh></v>
<v t="zoomq.20120727213305.14730"><vh>用户crx升级</vh>
<v t="zoomq.20120727213305.14723"><vh>crxup.html</vh></v>
</v>
</v>
<v t="zoomq.20120723102156.5539"><vh>3party</vh></v>
</v>
</vnodes>
<tnodes>
<t tx="zoomq.20120710140424.5446">creat API+admin srv for lb-crx publish mana.</t>
<t tx="zoomq.20120710140424.5447">@language markdown
# 珠海GDG 微信综合管理服务
~ base 珠三角技术沙龙活动综合管理应用

## 主要开发人员：
- jeff @jeff_kit

## 主要功能

- 查询过往活动
- 报名参加指定活动
- 查询历史报名情况
- 查询社区关键信息
- 自动发送提醒邮件

## Change logging

- 130806 frok from gztechparty/techparty

</t>
<t tx="zoomq.20120710140424.5449">@language html
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN"&gt;
&lt;head&gt;
  &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" &gt;

&lt;&lt;sspathdefine&gt;&gt;

  &lt;title&gt;
{% block title4act %}
{% endblock%}- lb4crx2pub ~猎豹扩展商店后台 v12.10.16.2&lt;/title&gt;

{% block headJS %}
{% endblock%}

    &lt;style type="text/css"&gt;
@others
    &lt;/style&gt;
&lt;/head&gt;

{% block body %}
&lt;body&gt;
{% endblock%}

&lt;div id="mainbody"&gt;
    {% block mainbody %}
    {% endblock%}
&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
    &lt;hr/&gt;
    &lt;/div&gt;
&lt;div id="footbar"&gt;
    {% block footernav %}
    {% endblock%}
    |&lt;a href="http://crxdoczh.readthedocs.org/en/latest/5-more/lb4crx/index.html"&gt;帮助&lt;/a&gt;

    &lt;div id="poweredby"&gt;
    &lt;b&gt;powered by:&lt;/b&gt;
        &lt;a href="http://www.python.org/"&gt;Python&lt;/a&gt;
        ,&lt;a href="http://bottle.paws.de/"&gt;Bottle&lt;/a&gt;
        ,&lt;a href="http://webpages.charter.net/edreamleo/front.html"&gt;Leo&lt;/a&gt;
        ,&lt;a href="http://sae.sina.com.cn"&gt;SAE&lt;/a&gt;
        ,&lt;a href="https://www.upyun.com/"&gt;UpYun&lt;/a&gt;
        ,&lt;a href="http://www.catb.org/hacker-emblem/"&gt;Hacker&lt;/a&gt;
     &lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;

{% block footerJS %}
{% endblock%}
&lt;/body&gt;
&lt;/html&gt;
</t>
<t tx="zoomq.20120710140424.5453">@language css
body{overflow-x:hidden}
body,img,a,div,span,h1,h2,h3,h4,h5,h6,hr,p,blockquote,dl,dt,dd,ul,ol,li,pre,form,fieldset,legend,button,textarea,th,td,tr,input{
    margin:0;padding:0
}
body { 
    background: #fefefe; color: #343434; 
    margin: 1em; padding: 0; font-size:105%;
}
h1,h2,h3,h4,h5,h6{
    margin:20px 0 10px 0;
    border-radius:5px;
    padding-left: 15px;
}
h1{
    background: #EBFAFF;
}
h2{
    background: #D1F4FF;
}
h3{
    background: #B8EEFF;
}
h4{
    background: #9EE8FF;
}

input,pre,body,button,select,textarea{
    font:14px/28px Segoe UI,Tahoma,Verdana,Arial,Helvetica,sans-serif
}


img { border: none }
hr {
  width : 100%;
  height : 2px;
  background : #efefef;
  border : 1px solid #ddd;
  clear : both;
}
div#poweredby{
  float : right;
}

a {color:#333;}
a:hover {color:blue;}

del {font-size:95%; color:#555;}


/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ .btnw */
span.right{
    float:right;
}
.btnw{
    border:1px solid #ccc;
    height:42px;
    display:inline-block;
}
.btn::-moz-focus-inner{border:0}


@others



@-moz-document domain(){
    .btnw button{padding:0 27px 0 27px}
    }








</t>
<t tx="zoomq.20120710140424.5454">@language yaml
---
name: weknow
version: 2

</t>
<t tx="zoomq.20120710140424.5455">@language py
import sae
import config
from bottle import debug, run
from web import APP

application = sae.create_wsgi_app(APP)


</t>
<t tx="zoomq.20120710140424.5456">#管理员邮箱列表
ADMIN_EMAIL_LIST = ['zoomquiet+lb@gmail.com']
@others

#   Storage domain name 约定
D2X = 'crx4lb'
D2P = 'pic2lb'
D4P = 'page4crx'
#KVDB 对象模板
#   系统索引键-名字典
K4D = {'incr':"TOT"
    ,'his':"SYS:his"        # 指向被复制的过往各种对象
    ,'crx':"SYS:crxs"       # 所有己发布的CRX
    ,'try':"SYS:trys"       # 所有待审核的CRX 
    ,'bak':"SYS:bak"        # 所有被退回的CRX 
    ,'out':"SYS:outs"       # 所有己下架的CRX 
    ,'arch':"SYS:arch"      # 所有己归档的CRX 
    ,'api4cx':"SYS:ctcrx"   # API可请求下载统计的 uuid 
    ,'grp':"SYS:grps"
    ,'tag':"SYS:tags"
    ,'pic':"SYS:pics"
    ,'usr':"SYS:users"      # 所有用户(包含已经 del 的)
    ,'stuff':"SYS:stuff"
}
#   历史操作 键-名字典
K4H = {'C':"Create"
    ,'D':"Delete"
    ,'U':"Update"
}
objHis = {'id':None     # 历史版本扩展ID
    ,'hisobj':None
    ,'hisact':"..."     # 操作类型C|D|U~ Create|Delet|Update = 创建|删除|更新
    ,'tstamp':''        # yymmddHHMMSS+5位微秒
}
#   所有扩展 uuid-&gt;x:id 值对 单独收集?
objCRX = {'uuid':None    # 扩展ID 为唯一
    ,'id':None      # 上次 历史版本ID
    ,'hisid':[]     # 所有操作历史
    ,'sid':None     # 存储ID
    ,'tagid':[]     #   可以属于多种标签
    ,'grpid':None   # 只能有一个作者拥有!
    ,'pic':[]
    ,'icon':None    # only one icon?!
    ,'name':""
    ,'desc':"是也乎"
    ,'version':'0.1'
    ,'dlrank':1024  #   下载总数量
    ,'detail':"..."
    ,'reply':"..."  # 审发回执(不显示在外部页面)
    ,'ispub':0      # 是否审发
    ,'isdel':0      # 是否删除
    ,'isreco':0     # 是否推荐
    ,'isbd':0       # 是否商务
    ,'gsdl':9442
    ,'gsusr':9442
    ,'gsrank':3     # google web store abt.
}
#   'sid':None         # 存储ID
objPIC = {'size':"M"         # XXXL|XXL|XL|L|M
    ,'icon':0           # 是否icon SIZE
    ,'reco':0           # 是否推荐
    ,'isdel':0          # 是否删除
    ,'note':"是也乎"
    ,'order':0
}
#'id':None
objGRP = {'id':None
    ,'hisid':[]     # 所有操作历史
    ,'crxs':[]      # 已发布的
    ,'trys':[]      # 待发布的
    ,'outs':[]      # 被下架的
    ,'baks':[]      # 被回退的
    ,'pic':[]
    ,'name':""
    ,'weibo':""
    ,'mail':""
    ,'desc':"..."
    ,'lead':""
    ,'isdel':0      # 是否删除
    ,'icon':0       # 是否icon SIZE
    ,'reco':0       # 是否推荐
    ,'order':0
}

objTAG = {'id':None
    ,'hisid':[]     # 所有操作历史
    ,'crxs':[]
    ,'name':""
    ,'desc':"..."
    ,'isdel':0      # 是否删除
    ,'order':0
}

objUSR = {'id':None # "usr:"+unicode(sha256(用户名).hexdigest())
    ,'crxs':[]
    ,'name':""
    ,'passwd':""    # unicode(sha256(口令).hexdigest())
    ,'isdel':0      # 是否删除
    ,'level':9      # 0|1 管理|团队
}



</t>
<t tx="zoomq.20120710140424.5489">@language py
# -*- coding: utf-8 -*-
&lt;&lt;declarations&gt;&gt;
from config import CFG

#debug(True)
APP = Bottle()

KV = sae.kvdb.KVClient()
SG = sae.storage.Client()

@others

</t>
<t tx="zoomq.20120717112543.5477">#import os
import sys
import time
import traceback
import zipfile
from copy import deepcopy
#from tempfile import TemporaryFile
#from StringIO import StringIO
#from shutil import copyfileobj
import json

import sae
import sae.storage
import sae.kvdb

from bottle import Bottle
from bottle import __version__ as bottleVer
from bottle import debug, run
from bottle import redirect, abort
from bottle import request, response, local
from bottle import static_file
from bottle import template
#from bottle import jinja2_view as view
#from bottle import jinja2_template as template
from bottle import jinja2_template as template
from bottle import TEMPLATE_PATH

import crx_id
#   120821 appended for SAE upgrade cancel Basic Author...
from auth import auth_required

from utility import INCR4KV as __incr
from utility import TSTAMP, GENID
from utility import POP4KV, POP4LIST, INS2LIST, IDX4LIST
from utility import ST4CRX, KV4CRX, KV4GRP
from utility import INIobjSYS, PUTHIS, PUT2SS, PUT_PIC4CRX



</t>
<t tx="zoomq.20120717112543.5478">@APP.route('/&lt;gid&gt;/crx/add', method='POST')
@auth_required()
def addcrx(gid):
    '''初始/升级 .crx   realy ACTION:
        - chk manifest.json info:
            - if  uuid exist AND ver is up -&gt;  
                + copy as x:id -&gt; historic KVobj
                + up ver/desc/name
            - else -&gt;
                + creat new crx KVobj
                + append uuid into SYS:trys
        - deepcopy(CFG.objCRX) set var with .crx
            - append uuid into CFG.K4D['uuid']
            - append uuid into CFG.K4D['try']
        - jump into /crx/x:id/info
    '''
    #print "\t&gt;&gt;&gt; addcrx()"
    crxfile = request.files.get('crxfile', None) #request.files.get('data')
    if crxfile is not None:
        &lt;&lt;crx upload&gt;&gt;
    uri = "/up/%s/crx/%s"% (gid, uuid)
    #print uri
    response.set_header('location', uri)
    response.status = 303
    #   redirect NOT WORK! abt.
    #redirect("/crx/%s/info"% tid, code=303)
    #https://github.com/defnull/bottle/issues/236
    #https://groups.google.com/forum/#!topic/bottlepy/RQV3B7ACiNk/discussion
    return None


</t>
<t tx="zoomq.20120717112543.5479">@APP.route('/&lt;gid&gt;/crx/&lt;uuid&gt;/info', method='POST')
def crxinfo(gid, uuid):
    ''' realy ACTION:
        - set obj. vars base uuid
         if upload pic:
            + put into Storage
            + create new objPIC KV
            + append sid into SYS:pics
            + append sid into crx.pic
        + binding TAG
    '''
    picfile = request.files.get('picture', None) #request.files.get('data')
    if picfile is not None:
        filename = picfile.filename
        raw = picfile.file.read() # This is dangerous for big files
        sid, uri, crcrx = PUT_PIC4CRX(raw, filename, uuid)
    else:
        crcrx = KV.get(uuid)
    name = request.forms.get('name')
    desc = request.forms.get('desc', '...')
    tags = request.forms.getlist('tags')
    #    up CRX
    crcrx['name'] = name.decode('utf-8')
    crcrx['desc'] = desc.decode('utf-8')
    crcrx['tagid'] = tags
    KV.set(uuid, crcrx)
    #    up TAGS
    if tags:
        for t in tags:
            tag = KV.get(t)
            tag['crxs'] = INS2LIST(uuid, tag['crxs'])
            KV.set(t, tag)
    tobjs = IDX4LIST(tags, KV)
    #   return default grpcrx
    redirect("/up/%s/crx/%s"% (gid, uuid) )
    
    #print tobjs
    return template('upcrx.html'
        , crx = crcrx 
        , tags = tobjs 
        , gid = gid
        , uuid = uuid
        )



</t>
<t tx="zoomq.20120717112543.5481">@language python
@tabwidth -4
# -*- coding: utf-8 -*-
&lt;&lt;declarations&gt;&gt;

@others

if __name__ == '__main__':
    if 2 != len(sys.argv) :
        print '''Usage:
            utility.py test
        '''
    else:
        print "hand testing ..."
        #MANIFEST4CRX(open('../../elf.crx', "rb").read())
        #print GENID('sae',"sdfsdfsd")
        #print GENID('crx')
        #print INIobjSYS('cc')
        #print 'increase by KVDB: %s' % INCR4KV()
        #print 'increase by Memcache: %s' % INCR4MM()
    
</t>
<t tx="zoomq.20120717112543.5493">    '''
    #return "You missed a field."
    #"Hello %s! You uploaded %s (%d bytes)." % (name, filename, len(raw))
    #return "You missed a field."
    #return template('upcrx.tpl')

    #return
    
    #print dir(data.file)
    #print type(data.file)
    # GET某个domain下的object
    #ob = s.get('crx4lb', data.filename)
    #print dir(ob)
    #print "\ttype(ob)", type(ob)
    #sdata = ob.data
    #print sdata
    #AppID = crx_id.GetCRXAppID4upload(data.file)
    #AppID = crx_id.GetCRXAppID4upload(sdata)
    #print 'AppID: %s' % AppID
    #data.file.seek(0)
    #print "data.file.closed", data.file.closed
    #print len(raw)
    raw = ""
    if name and data.file:
        while True:
            datachunk = data.file.read(1024)
            if not datachunk:
                break
            raw = raw + datachunk

        filename = data.filename

    try:
        buf = data.file.read(data.bufsize)
        while True:
            buf = data.file.read(data.bufsize)
            if not buf:
                break
            print data.bufsize
        #outfile.close()
        #return 'Uploaded %s !' % upfile.filename        
    except Exception,e:
        print e.message
        return 'Failed in uploading %s !' % data.filename

    @route('/upload', method='POST')
def do_upload():
    try:
        filename = request.POST.get('Filename')
        root, ext = os.path.splitext(filename)
        assert ext[1:].lower() in ALLOWED_TYPE, "Invalid file type: " + ext
        if not os.path.isdir(UPLOAD_BASE):
            os.makedirs(UPLOAD_BASE)
        filedata = request.POST.get('Filedata')
        assert filedata is not None, "Invalid Upload data."
        with open(os.path.join(UPLOAD_BASE, filename), 'wb') as f:
            shutil.copyfileobj(filedata.file, f, 8192)
    except AssertionError, e:
        abort(403, str(e))
    else:
        return filename

    '''
</t>
<t tx="zoomq.20120720204727.3913">@language python
@tabwidth -4

Path design

    /   ~ readme

- for dev.:
    /up
    /up/crx            &gt; CRX:x:id
    /up/:crx-id       &gt; CRX:x:id
    /up/:crx-id/ed  &gt; CRX:x:id
    /up/list            &gt; TEAM:t:id-&gt;crxs-&gt;CRX:x:id
    /up/team        &gt; TEAM:t:id
    /up/team/ed &gt; TEAM:t:id
    /up/load
    
- for admin:
    /mana       索引
    #/mana/st    状态
    /mana/ini    状态
    /mana/crx        &gt; CRX:x:id
    /mana/pub       &gt; SYS:crx:updated
    /mana/teams   &gt; SYS:teams:all
    /mana/classes &gt; SYS:classes:all
    /mana/class     &gt; TAG:gid-&gt;x:id
    /mana/reco      &gt; ??
    /mana/gen       &gt; 动态!
        /prestore
            /:classid
            /:crxid
    
- for api
    /api
    /api/st
        + 整体
        + /:x:id
        + /:c:id
        + /:t:id
    /api/ct
</t>
<t tx="zoomq.20120720204727.3914">@language python
@tabwidth -4

sae.kvdb:
    服务限制:
        key的最大长度：200字节
        value的最大长度：4M （默认启用压缩）
        mget获取的最大KEY个数：32
        pkrget获取的最大KEY个数：100

abt. TOT:
    - 0++

abt. SYS:
- crxs:crtnew = [,,]
- crxs:all = [x:id,,,]
- teams:all = [x:id,,,]
- tags:all = [x:id,,,]
- h:id = HASH(YYMMddhhssmmm+HIS+0)
    + hisctrl = [hisid,hisid,...]
    
abt. CRX:
- x:id = HASH(YYMMddhhssmmm+CRX++0)
    + sid
    + name
    + version
    + date
    + desc
    + detail
    + hisid = x:id
    + img [sid,sid,,,]
    + classid
    + dlrank=1111
    + gsrank=***
    + gsdl=100000
    + gsusr=50000
    + isbd = 0
    + isreco = 0
    
abt. PIC:
- p:id = HASH(YYMMddhhssmmm+PIC++0)
    + sid
    + type = XXXL|XXL|XL|L|M
    + icon=0
    + reco=0
    + note=1
    + order=0
    
abt. GROUP:
- g:id = HASH(YYMMddhhssmmm+GRP++0)
    + name
    + mail
    + weibo
    + desc
    + lead
    + hisid = x:id
    + crxs
        + [x:id,x:id,,,]

abt. TAG:
- t:id = HASH(YYMMddhhssmmm+TAG++0)
    + tagname
    + tagid
    + hisid = x:id
    + recos =  [x:id,x:id,,,]
    + crxs =  [x:id,x:id,,,]

</t>
<t tx="zoomq.20120723102156.5539">@path 3party</t>
<t tx="zoomq.20120723102156.5541">@path module</t>
<t tx="zoomq.20120723102156.5543">@path web


- passwdaccess: if(path ~ "/up") passwd "up:up"
- passwdaccess: if(path ~ "/mana") passwd "mana:mana"

</t>
<t tx="zoomq.20120723102156.5544">@language py
# -*- coding: utf-8 -*-
VERSION = "mana4lbcrx v12.10.15"

@others

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 全局值
class Borg():
    '''base http://blog.youxu.info/2010/04/29/borg
        - 单例式配置收集类
    '''
    __collective_mind = {}
    def __init__(self):
        self.__dict__ = self.__collective_mind
        
    &lt;&lt;cfg4Borg&gt;&gt;

CFG = Borg()

</t>
<t tx="zoomq.20120723102156.5545">@language python
@tabwidth -4
# -*- coding: utf-8 -*-

@others

if __name__ == '__main__':
    debug(True)
    #0.0.0.0
    run(app, host="0.0.0.0",reloader=True)
</t>
<t tx="zoomq.20120723102156.5546">#!/usr/bin/python
# -*- coding: utf-8 -*-

from bottle import Bottle
from bottle import __version__ as bottleVer
from bottle import debug, run
from bottle import redirect, abort, error
from bottle import request, response, local
from bottle import static_file
#from bottle import template
#from bottle import jinja2_view as view
from bottle import jinja2_template as template
from bottle import TEMPLATE_PATH

#from mysession import get_session_info, set_session_info
#from mysession import deco_session_check

from config import JINJA2TPL_PATH
TEMPLATE_PATH.insert(0, JINJA2TPL_PATH)
#from config import CUSTOM_TPL_PATH
#TEMPLATE_PATH.insert(0, CUSTOM_TPL_PATH)


APP = Bottle()

#APP.mount('/up', __import__('mana4up').APP)
APP.mount('/api', __import__('mana4api').APP)
#APP.mount('/mana', __import__('mana4sys').APP)

#run(host='10.33.6.22', port=8080)

'''
from bottle import install
from cors_plugin import RequestPreflightPlugin
request_preflight_plugin = RequestPreflightPlugin( allow_origin = '*'
    ,preflight_methods = [ 'GET', 'POST', 'PUT', 'DELETE', 'OPTION' ]
    ,ttl = 3600 )
APP.install( request_preflight_plugin )
'''




</t>
<t tx="zoomq.20120723102156.5547">@APP.route('/center')
def handel_redirect():
    return redirect(request.path+'/')

</t>
<t tx="zoomq.20120723102156.5548">@APP.route('/')
#@view('404.html')
def index():
    return template('index.html')

</t>
<t tx="zoomq.20120723102156.5561">@language py
# -*- coding: utf-8 -*-
&lt;&lt;declarations&gt;&gt;
from config import CFG

debug(True)
APP = Bottle()

KV = sae.kvdb.KVClient(debug=1)
#SG = sae.storage.Client()

@others




</t>
<t tx="zoomq.20120723102156.5562">#import os
import time
import traceback
#import json
import urllib2 as urilib
from copy import deepcopy
#from tempfile import TemporaryFile
#from StringIO import StringIO
#from shutil import copyfileobj
import pprint
pp = pprint.PrettyPrinter(indent=4)

import sae
import sae.storage
import sae.kvdb
import pylibmc

from bottle import Bottle
from bottle import __version__ as bottleVer

from bottle import debug, run
from bottle import redirect, abort
from bottle import request, response, local
from bottle import static_file
#from bottle import template
#from bottle import jinja2_view as view
from bottle import jinja2_template as template
from bottle import TEMPLATE_PATH

#import urllib2 as urilib
from auth import auth_required, sha256_uhex
from lb4crx2cli import __genRESTsign


from utility import INCR4KV as __incr
from utility import TSTAMP, GENID
from utility import POP4KV, POP4LIST, INS2LIST, INS2DICT4LIST, IDX4LIST
from utility import ST4CRX, KV4CRX, KV4GRP
from utility import INIobjSYS, PUTHIS, PUT2SS, PUT_PIC4CRX
</t>
<t tx="zoomq.20120723102156.5568">@APP.route('/')
def api():
    #print "\t/api by Bottle %s"% bottleVer
    return "\t/api by Bottle %s"% bottleVer
    #return template('api.tpl')
    #redirect('/api/%s/sysincr'% 123)


@APP.route('/cron/dlrank', method='OPTIONS')
@APP.route('/dc/&lt;uuid&gt;', method='OPTIONS')
@APP.route('/dc/add/&lt;uuid&gt;', method='OPTIONS')
@APP.route('/dc/dlrank/&lt;order&gt;', method='OPTIONS')
def CORSupport(uuid):
    response.set_header('Access-Control-Allow-Origin', '*')
    response.set_header('Access-Control-Allow-Headers', 'x-requested-with')
    #print "\t&gt;&gt;&gt;OPTIONS"
    
    
#@APP.route('/dc/&lt;uuid&gt;', method='OPTIONS')
#@APP.route('/dc/&lt;:re:.*&gt;', method='OPTIONS')
#@APP.route('/dc/&lt;uuid&gt;', method='OPTIONS')
#@APP.route('/dc/&lt;:re:.*&gt;', method='OPTIONS')
def cors():
    response.set_header('Access-Control-Allow-Origin', '*')
    response.set_header('Access-Control-Allow-Headers', 'x-requested-with')
    #response.set_header('Content-Type','application/json; charset=utf-8')
    


</t>
<t tx="zoomq.20120723102156.5585">@language py
# -*- coding: utf-8 -*-
&lt;&lt;declarations&gt;&gt;
from config import CFG

debug(True)
APP = Bottle()

KV = sae.kvdb.KVClient()
SG = sae.storage.Client()

@others


</t>
<t tx="zoomq.20120723102156.5586">#import os
import time
import traceback
import zipfile
#import json as JSON
from copy import deepcopy

import pprint
pp = pprint.PrettyPrinter(indent=4)
#from tempfile import TemporaryFile
#from StringIO import StringIO
#from shutil import copyfileobj
import sae
import sae.storage
import sae.kvdb

from bottle import Bottle
from bottle import debug, run
from bottle import redirect, abort
from bottle import request, response, local
from bottle import static_file
#from bottle import template
#from bottle import jinja2_view as view
from bottle import jinja2_template as template
from bottle import TEMPLATE_PATH

import crx_id
#   120821 appended for SAE upgrade cancel Basic Author...
from auth import auth_required

from utility import INCR4KV as __incr
from utility import TSTAMP, GENID
from utility import POP4KV, POP4LIST, INS2LIST, INS2DICT4LIST, IDX4LIST
from utility import ST4CRX, KV4CRX, KV4GRP
from utility import INIobjSYS, PUTHIS, PUT2SS, PUT_PIC4CRX

</t>
<t tx="zoomq.20120723102156.5593">@APP.route('/crx/&lt;uuid&gt;/pic/&lt;sid&gt;/del')
def delpic(uuid, sid):
    '''del. crx's pic:
        + del. SS obj
        + pop sid from SYS:pics
        + pop sid from crx.pic
        + set pic['isdel'] = 1
    '''
    print uuid, sid
    try:
        ss = sae.storage.Client()
        ss.delete(CFG.D2P, sid)
        #print "\tKV.get(k4pic)", KV.get(k4pic)
    except:
        print "&gt;&gt;&gt;/crx/&lt;xid&gt;/pic/&lt;sid&gt;/del \n\t", traceback.print_exc()
        #sys.exit(1)
        #return None
    #return None
    #   + pop sid from SYS:pic
    k4pic, crpics = INIobjSYS('pic')
    POP4KV(sid, k4pic, crpics)
    #print KV.get(k4pic)
    #   + pop sid from crx.pic
    crx = KV.get(uuid)
    crpics = crx['pic']
    POP4LIST(sid, crpics)   #crpics.pop(crpics.index(sid))
    crx['pic'] = crpics
    KV.set(uuid, crx)
    #   + set pic['isdel'] = 1
    pic = KV.get(sid)
    pic['isdel'] = 1
    KV.set(sid, pic)

    #print "\tKV.set(uuid)['pic']:", KV.get(uuid)['pic']
    redirect("/mana/crx/%s"% uuid)

    





</t>
<t tx="zoomq.20120727213305.13050">@APP.route('/sysincr')
#@APP.route('/&lt;ddd&gt;/sysincr')
def sysincr():
    from utility import INCR4KV as __incr
    #kv = sae.kvdb.KVClient()
    #print  kv.get_info()
    return str(__incr())
    
    '''
    kv = sae.kvdb.KVClient()
    print dir(kv)
    print kv.get_info()
    print kv.get("TOT")
    
    if not kv.get("TOT"):
        kv.add("TOT", 1)
    print kv.get("TOT")
    print type(kv.get("TOT")+1)
    
    kv.replace("TOT",kv.get("TOT")+1)
    print kv.get("TOT")
    
    return str(kv.get("TOT"))
    '''



</t>
<t tx="zoomq.20120727213305.14687">@language python
@tabwidth -4
#!/usr/bin/env python
# Copyright (c) 2011 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

""" Read a CRX file and write out the App ID and the Full Hash of the ID.
See: http://code.google.com/chrome/extensions/crx.html
and 'http://stackoverflow.com/questions/'
  + '1882981/google-chrome-alphanumeric-hashes-to-identify-extensions'
for docs on the format.
"""

@others

if __name__ == '__main__':
  sys.exit(main(sys.argv))

</t>
<t tx="zoomq.20120727213305.14688">
import sys
import hashlib


EXPECTED_CRX_MAGIC_NUM = 'Cr24'
EXPECTED_CRX_VERSION = 2


</t>
<t tx="zoomq.20120727213305.14689">def usage(argv):
  print "%s: crx_file" % argv[0]

</t>
<t tx="zoomq.20120727213305.14690">def HexToInt(hex_chars):
  """ Convert bytes like \xab -&gt; 171 """
  val = 0
  for i in xrange(len(hex_chars)):
    val += pow(256, i) * ord(hex_chars[i])
  return val

</t>
<t tx="zoomq.20120727213305.14691">def HexToMPDecimal(hex_chars):
  """ Convert bytes to an MPDecimal string. Example \x00 -&gt; "aa"
      This gives us the AppID for a chrome extension.
  """
  result = ''
  base = ord('a')
  for i in xrange(len(hex_chars)):
    value = ord(hex_chars[i])
    dig1 = value / 16
    dig2 = value % 16
    result += chr(dig1 + base)
    result += chr(dig2 + base)
  return result

</t>
<t tx="zoomq.20120727213305.14692">def HexTo256(hex_chars):
  """ Convert bytes to pairs of hex digits. E.g., \x00\x11 -&gt; "{0x00, 0x11}"
      The format is taylored for copy and paste into C code:
      const uint8 sha256_hash[] = { ... }; """
  result = []
  for i in xrange(len(hex_chars)):
    value = ord(hex_chars[i])
    dig1 = value / 16
    dig2 = value % 16
    result.append('0x' + hex(dig1)[2:] + hex(dig2)[2:])
  return '{%s}' % ', '.join(result)

</t>
<t tx="zoomq.20120727213305.14693">def GetPublicKey(f):
  magic_num = f.read(4)
  if magic_num != EXPECTED_CRX_MAGIC_NUM:
    raise 'Invalid magic number: %s (expecting %s)' % (magic_num,
                                                       EXPECTED_CRX_MAGIC_NUM)
  version = f.read(4)
  if not version[0] != EXPECTED_CRX_VERSION:
    raise 'Invalid version number: %s (expecting %s)' % (version,
                                                         EXPECTED_CRX_VERSION)
  pub_key_len_bytes = HexToInt(f.read(4))
  sig_len_bytes = HexToInt(f.read(4))
  pub_key = f.read(pub_key_len_bytes)
  return pub_key

</t>
<t tx="zoomq.20120727213305.14694">def GetCRXHash(filename):
  f = open(filename, 'rb')
  pub_key = GetPublicKey(f)
  f.close()
  pub_key_hash = hashlib.sha256(pub_key).digest()
  return HexTo256(pub_key_hash)

</t>
<t tx="zoomq.20120727213305.14695">def GetCRXAppID(filename):
  f = open(filename, 'rb')
  pub_key = GetPublicKey(f)
  f.close()
  pub_key_hash = hashlib.sha256(pub_key).digest()
  # AppID is the MPDecimal of only the first 128 bits of the hash.
  return HexToMPDecimal(pub_key_hash[:128/8])


</t>
<t tx="zoomq.20120727213305.14696">def GetCRXAppID4upload(file):
  f = file
  pub_key = GetPublicKey(f)
  #f.close()
  pub_key_hash = hashlib.sha256(pub_key).digest()
  # AppID is the MPDecimal of only the first 128 bits of the hash.
  return HexToMPDecimal(pub_key_hash[:128/8])

</t>
<t tx="zoomq.20120727213305.14697">def main(argv):
  if len(argv) != 2:
    usage(argv)
    return 1
  print 'Raw Bytes: %s' % GetCRXHash(sys.argv[1])
  print 'AppID: %s' % GetCRXAppID(sys.argv[1])


</t>
<t tx="zoomq.20120727213305.14698">import os
import sys
import traceback
from copy import deepcopy
from time import time, gmtime, strftime, localtime
#print os.path

from config import CFG
# KVDB or Memcache global sys. event count KEY
_k4incr = CFG.K4D['incr']

import sae.storage
import sae.kvdb
KV = sae.kvdb.KVClient()


</t>
<t tx="zoomq.20120727213305.14699">def INCR4KV():
    '''BASE KVDB make GLOBAL increaser
    '''
    if not KV.get(_k4incr):
        #print "\t EMPTY?!"
        KV.add(_k4incr, 1111)
    else:
        #print "\t incr. BASE HISTORIC"
        KV.replace(_k4incr,KV.get(_k4incr)+1)
    
    return KV.get(_k4incr)




</t>
<t tx="zoomq.20120727213305.14701">def INCR4MM():
    '''BASE Memcache make GLOBAL increaser
    '''
    import pylibmc
    
    mc = pylibmc.Client()
    if not mc.get(_k4incr):
        mc.set(_k4incr, 1111)
    else:
        mc.incr(_k4incr)
    return mc.get(_k4incr)



</t>
<t tx="zoomq.20120727213305.14705">@language html
{% extends "base.html" %}

{% block title4act %}
404
{% endblock %}

{% block mainbody %}
&lt;h1&gt;猎豹扩展商店后台:404(Bottle版) &lt;/h1&gt;

&lt;h2&gt;真心没作呢,介事儿&lt;/h2&gt;

吼这位:-(
&lt;pre&gt;
zoomquiet+lb4crx2srv # gmail.com
&lt;/pre&gt;
{% endblock %}

{% block footernav %}
:-[
{% endblock %}



</t>
<t tx="zoomq.20120727213305.14707">#@view('404.html')
@APP.error(404)
def error404(error):
    return template('404.html')

@APP.route('/favicon.ico')
def favicon():
    abort(204)
    
@APP.route('/static/&lt;filename&gt;')
def server_static(filename):
    return static_file(filename, root='static')
    </t>
<t tx="zoomq.20120727213305.14708">+ 排序
    - 周下载
        - 每日统计
        - Ajax 动态统计
        &lt;-  Taskqueue 异步进行
        &lt;&lt;- AngularJS
        &gt;&gt; 防攻击!
        
    - 更新更动
    - rate
    - 编辑之选
    
+ 活跃度! &lt;- api 配合
+ SEO
+ 搜索!

</t>
<t tx="zoomq.20120727213305.14715">@path templates

#for local debug:
{% set sspath4pic = "http://localhost:8080/stor-stub/pic2lb" %}
{% set sspath4crx = "http://localhost:8080/stor-stub/crx4lb" %}

#for SAE debug:
{% set sspath4pic = "http://lb4crx-pic2lb.stor.sinaapp.com" %}
{% set sspath4crx = "http://lb4crx-crx4lb.stor.sinaapp.com" %}

{% set sspage2crx = "http://lb4crx-page4crx.stor.sinaapp.com" %}
</t>
<t tx="zoomq.20120727213305.14717">@language html
{% extends "base.html" %}

{% block title4act %}
index
{% endblock %}

{% block mainbody %}
&lt;h1&gt;扩展商店后台(Bottle版) =&lt;/h1&gt;

是也乎;-)

&lt;h2&gt;服务作者&lt;/h2&gt;

&lt;a href="/up"&gt;扩展上传&lt;/a&gt;
;&lt;a href="/up/team"&gt;团队维护&lt;/a&gt;

&lt;h2&gt;商店管理&lt;/h2&gt;

&lt;a href="/mana"&gt;管理索引&lt;/a&gt;;
包含以下管理控制:
&lt;pre&gt;
+ 商店管理
|   +- 页面生成
|   +- 状态统计
+ 页面管理
|   +- 标签管理
|   +- 推荐位编辑
+ 团队管理
|   +- 团队初始化
|   +- 团队信息修订
` 扩展管理
    +- 审发扩展
&lt;/pre&gt;

&lt;h2&gt;接口服务&lt;/h2&gt;

&lt;a href="/api"&gt;接口索引&lt;/a&gt; ;
包含以下管理控制:
&lt;pre&gt;
+ 查询
|   +- 下载统计
+ 更新
|   +- 下载计数
|   +- 扩展信息
|   +- 团队信息
` 控制
    +- 编辑之选
&lt;/pre&gt;
{% endblock %}

{% block footernav %}
:-}
{% endblock %}


</t>
<t tx="zoomq.20120727213305.14719">@language html

&lt;script type="text/javascript" language="javascript"&gt;
&lt;&lt;validatious.0.9.1.min.js&gt;&gt;
&lt;/script&gt;
</t>
<t tx="zoomq.20120727213305.14721">@language html
{% extends "expbase.html" %}

{% block title4pub %}
{{ crttag.name }}
{% endblock %}

{% block headCSS %}
&lt;style type="text/css"&gt;
&lt;&lt;CSS&gt;&gt;
&lt;/style&gt;
{% endblock headCSS %}

{% block mainbody %}
&lt;div class="bigbox"&gt;
@others
&lt;/div&gt; &lt;!-- class="bigbox"--&gt;

&lt;div class="cover" style="display:none;"&gt;
&lt;div class="detail"&gt;&lt;div class="close"&gt;&lt;/div&gt;&lt;iframe src="" style="overflow: hidden;" border="0" frameborder="0" marginheight="0" scrolling="no" marginwidth="0" width="100%" height="100%" id="iframe"&gt;&lt;/iframe&gt;&lt;/div&gt;
&lt;/div&gt;

{% endblock mainbody %}

</t>
<t tx="zoomq.20120727213305.14723">@language html
{% extends "base.html" %}

{% block title4act %}
up
    {% endblock %}

{% block headJS %}
&lt;script type="text/javascript" language="javascript"
    src="http://zq4org.b0.upaiyun.com/j/prototype.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" language="javascript"
    src="http://zq4org.b0.upaiyun.com/j/scriptaculous.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" language="javascript"
    src="http://zq4org.b0.upaiyun.com/j/jsvalidate_beta04.js"&gt;&lt;/script&gt;
    {% endblock%}

{% block mainbody %}
&lt;h2&gt;猎豹国产原创扩展:上传&lt;/h2&gt;

&lt;form action="/up/crx" method="post" enctype="multipart/form-data" class="validate"&gt;
  名称:&lt;input type="text" name="name" class="required" title="!必填项!"/&gt;
  &lt;br/&gt;
  文件:&lt;input type="file" name="data" class="required" title="!必填项!"/&gt;
  &lt;br/&gt;

&lt;span id="reply_submit" class="btnw"&gt;
    &lt;button type="submit" class="action"&gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;/form&gt;
    {% endblock %}

{% block footernav %}
:-]
    {% endblock %}

</t>
<t tx="zoomq.20120727213305.14725">@language html
{% extends "base.html" %}
{% block title4act %}
TAGed.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展标签, 编辑&lt;/legend&gt;
&lt;form action="/mana/tag/{{ tag.id }}/info" method="post" class="validate"&gt;
@others
&lt;/form&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120727213305.14727">@APP.route('/tags')
@auth_required()
def tags():
    ''' realy ACTION:
        - listing all tag with ctrl links
    '''
    sysk, crtags = INIobjSYS('tag')
    #print sysk, crtags
    #print KV.get(sysk)
    #print len(crtags)
    if 0 == len(crtags):
        objtags = None
    else:
        objtags = []
        for tid in crtags:
            #print tid
            #print KV.get(tid)
            objtags.append(KV.get(tid))
    return template('tags.html', tags=objtags)


@others

</t>
<t tx="zoomq.20120727213305.14728">基础模板组
</t>
<t tx="zoomq.20120727213305.14729"></t>
<t tx="zoomq.20120727213305.14730"></t>
<t tx="zoomq.20120727213305.14733"></t>
<t tx="zoomq.20120727213305.14734">
{% block headJS %}
&lt;script type="text/javascript" language="javascript" src="http://zq4org.b0.upaiyun.com/j/prototype.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" language="javascript" src="http://zq4org.b0.upaiyun.com/j/scriptaculous.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" language="javascript" src="http://zq4org.b0.upaiyun.com/j/jsvalidate_beta04.js"&gt;&lt;/script&gt;
    {% endblock%}
</t>
<t tx="zoomq.20120727213305.14735">/**
 * TERMS OF USE - Validatious 2.0
 * Open source under the BSD License.
 * Copyright 2008 Christian Johansen.
 * All rights reserved.
 */
var addDOMLoadEvent=(function(){var F=[],A,E,C,B,D,G=function(){C=true;clearInterval(A);while(B=F.shift()){B()}if(E){E.onreadystatechange=""}};return function(H){if(C){return H()}if(!F[0]){if(document.addEventListener){document.addEventListener("DOMContentLoaded",G,false)}if(/WebKit/i.test(navigator.userAgent)){A=setInterval(function(){if(/loaded|complete/.test(document.readyState)){G()}},10)}D=window.onload;window.onload=function(){G();if(D){D()}}}F.push(H)}})();var Base=function(){};Base.extend=function(B,E){var F=Base.prototype.extend;Base._prototyping=true;var D=new this;F.call(D,B);delete Base._prototyping;var C=D.constructor;var A=D.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==A){this._constructing=true;C.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||F).call(arguments[0],D)}}}};A.ancestor=this;A.extend=this.extend;A.forEach=this.forEach;A.implement=this.implement;A.prototype=D;A.toString=this.toString;A.valueOf=function(G){return(G=="object")?A:C.valueOf()};F.call(A,E);if(typeof A.init=="function"){A.init()}return A};Base.prototype={extend:function(B,H){if(arguments.length&gt;1){var E=this[B];if(E&amp;&amp;(typeof H=="function")&amp;&amp;(!E.valueOf||E.valueOf()!=H.valueOf())&amp;&amp;/\bbase\b/.test(H)){var A=H.valueOf();H=function(){var K=this.base||Base.prototype.base;this.base=E;var J=A.apply(this,arguments);this.base=K;return J};H.valueOf=function(J){return(J=="object")?H:A};H.toString=Base.toString}this[B]=H}else{if(B){var G=Base.prototype.extend;if(!Base._prototyping&amp;&amp;typeof this!="function"){G=this.extend||G}var D={toSource:null};var F=["constructor","toString","valueOf"];var C=Base._prototyping?0:1;while(I=F[C++]){if(B[I]!=D[I]){G.call(this,I,B[I])}}for(var I in B){if(!D[I]){G.call(this,I,B[I])}}}}return this},base:function(){}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(A,D,C){for(var B in A){if(this.prototype[B]===undefined){D.call(C,A[B],B,A)}}},implement:function(){for(var A=0;A&lt;arguments.length;A++){if(typeof arguments[A]=="function"){arguments[A](this.prototype)}else{this.prototype.extend(arguments[A])}}return this},toString:function(){return String(this.valueOf())}});function addEvent(B,D,C){if(B.addEventListener){B.addEventListener(D,C,false)}else{if(!C.$$guid){C.$$guid=addEvent.guid++}if(!B.events){B.events={}}var A=B.events[D];if(!A){A=B.events[D]={};if(B["on"+D]){A[0]=B["on"+D]}}A[C.$$guid]=C;B["on"+D]=handleEvent}}addEvent.guid=1;function removeEvent(A,C,B){if(A.removeEventListener){A.removeEventListener(C,B,false)}else{if(A.events&amp;&amp;A.events[C]){delete A.events[C][B.$$guid]}}}function handleEvent(D){var C=true;D=D||fixEvent(((this.ownerDocument||this.document||this).parentWindow||window).event);var A=this.events[D.type];for(var B in A){this.$$handleEvent=A[B];if(this.$$handleEvent(D)===false){C=false}}return C}function fixEvent(A){A.preventDefault=fixEvent.preventDefault;A.stopPropagation=fixEvent.stopPropagation;return A}fixEvent.preventDefault=function(){this.returnValue=false};fixEvent.stopPropagation=function(){this.cancelBubble=true};if(typeof v2==="undefined"||v2===null){v2={}}v2.empty=function empty(A){return typeof A=="undefined"||A===null||A===""};v2.array=function array(C){var A=[];if(C&amp;&amp;typeof C.item==="function"){for(var B=0;B&lt;C.length;B++){A[B]=C[B]}C=A}return v2.empty(C)?[]:(typeof C.shift=="undefined"?[C]:C)};v2.Object={extend:function(C,A,B){B=typeof B==="undefined"?false:B;for(var D in A){if(B&amp;&amp;typeof C[D]!=="undefined"){continue}if(A.hasOwnProperty(D)&amp;&amp;typeof A[D]!=="undefined"){C[D]=A[D]}}return C}};v2.Object.extend(String.prototype,{strip:function(){return this.replace(/^\s+|\s+$/,"")}});v2.Object.extend(Array.prototype,{indexOf:function(C,A){for(var B=0;B&lt;this.length;B++){if(this[B]===C){return B}}return -1}});v2.$=function(A,C){if(typeof A=="string"){A=document.getElementById(A)}C=typeof C=="undefined"?true:C;if(A===null||typeof A.hide!="undefined"||!C){return A}for(var B in v2.Element){if(v2.Element.hasOwnProperty(B)){(function(){var D=B;var E={};E[D]=function(){var F=[A];for(var G=0;G&lt;arguments.length;G++){F.push(arguments[G])}return v2.Element[D].apply(v2.Element,F)};v2.Object.extend(A,E,true)})()}}return A};v2.$$=function $$(E,N){N=N||document;if(document.querySelectorAll){v2.$$=function(Q,R){return(R||document).querySelectorAll(Q)};return v2.$$(E,N)}var O=E.split(",");var J,H,F,B,K,D,A,I,C,G,L,M;var P=[];for(J=0;(E=O[J]);J++){B=E.strip().split(/[^a-zA-Z]/)[0]||"*";K=E.replace(/^\./,"_.").split(/\./);C=[];G=[];for(H=1;H&lt;K.length;H++){C.push(K[H].split(/[^a-zA-Z\-_]/)[0])}K=E.replace("][","].[").split(/[\[\]]/);for(H=0;H&lt;K.length-1;H+=2){D=K[H+1].split("=");D[1]=D[1]||true;G.push(D)}A=N.getElementsByTagName(B);elementLoop:for(H=0;(I=A[H]);H++){for(F=0;F&lt;C.length;F++){if(!v2.Element.hasClassName(I,C[F])){continue elementLoop}}for(F=0;F&lt;G.length;F++){L=G[F][0];M=G[F][1];if(I.hasAttribute){if(!I.hasAttribute(L)||(M!==true&amp;&amp;I.getAttribute(L)!==M)){continue elementLoop}}else{L=L==="for"?"htmlFor":L;if(typeof I[L]==="undefined"||(M!==true&amp;&amp;I[L]!==M)){continue elementLoop}}}if(P.indexOf(I)&lt;0){P.push(I)}}}return P};v2.Element={observe:function(B,C,A){addEvent(B,C,A)},computedStyle:function(A,C){var B="";if(document.defaultView&amp;&amp;document.defaultView.getComputedStyle){B=document.defaultView.getComputedStyle(A,"").getPropertyValue(C)}else{if(A.currentStyle){C=C.replace(/\-(\w)/g,function(D,E){return E.toUpperCase()});B=A.currentStyle[C]}}return B},visible:function(A){return v2.Element.computedStyle(A,"display")!="none"&amp;&amp;v2.Element.computedStyle(A,"visibility")!="hidden"&amp;&amp;(A.parentNode===null||A.parentNode.nodeType!=1||v2.Element.visible(A.parentNode))},hasClassName:function(B,A){return new RegExp("(^|\\s)"+A+"(\\s|$)").test(B.className)},addClassName:function(B,A){B.className+=v2.Element.hasClassName(B,A)?"":" "+A;B.className=B.className.replace("  "," ").replace(/^\s|\s$/,"");return B},removeClassName:function(B,A){var C=new RegExp("(^|\\s)"+A+"(\\s|$)");B.className=B.className.replace(C," ").replace("  "," ").replace(/^\s|\s$/,"");return B},position:function(A){var B={x:0,y:0};while(A!==null){B.x+=A.offsetLeft;B.y+=A.offsetTop;A=A.offsetParent}return B},scrollTo:function(A){var B=v2.Element.position(A);window.scrollTo(B.x,B.y)},previous:function(A){do{A=A.previousSibling}while(A&amp;&amp;A.nodeType!==1);return A}};v2.Object.extend(Function.prototype,{bind:function(B){var A=this;A.__cc=A.__cc||[];window.__coc=window.__coc||0;if(typeof B.__id=="undefined"){B.__id=window.__coc++}A.__cc[B.__id]=A.__cc[B.__id]||function(){try{return A.apply(B,arguments)}catch(C){}};return A.__cc[B.__id]}});if(typeof addDOMLoadEvent!="undefined"){v2.addDOMLoadEvent=addDOMLoadEvent}v2.CompositeFormItem=Base.extend({type:"generic",constructor:function(){if(v2.empty(this.__validators)){this.__validators=[]}if(v2.empty(this.__errors)){this.__errors=[]}this.__passOnAny=false;this.__message=null;this.parent=null},add:function(A){this.__validators.push(A);A.parent=this},get:function(A){return !v2.empty(A)?this.__validators[A]:this.__validators},validate:function(){this.__errors=[];var A=this.test("validate");if(A){this.__errors=[];this.onSuccess()}else{this.onFailure()}return A},test:function(C){var B,A,D=0;C=C||"test";for(B=0;(A=this.__validators[B]);B++){if(A[C]()){D++}else{this.__errors.push(A)}}return this.passOnAny()&amp;&amp;D&gt;0||!this.passOnAny()&amp;&amp;D===this.__validators.length},getInvalid:function(){return this.__errors.length===0?null:this.__errors},setMessage:function(A){this.__message=A},getMessages:function(){if(!v2.empty(this.__message)){return[this.__message]}var C=[],B,A;for(B=0,A;(A=this.__errors[B]);B++){C=C.concat(A.getMessages())}return C},passOnAny:function(A){if(typeof A!=="undefined"){this.__passOnAny=!!A}return this.__passOnAny},onSuccess:function(){},onFailure:function(){}});v2.InputElement=Base.extend({constructor:function(B,A){this.__name=null;this.__events=v2.empty(A)?["blur"]:v2.array(A);this.__elements=v2.array(B)},monitor:function(D){this.__monitored=true;var C,A,B,E;for(C=0;(B=this.__elements[C]);C++){for(A=0;(E=this.__events[A]);A++){v2.Element.observe(B,E,D)}}},getValue:function(){return this.__elements[0].value},getLabel:function(){var B=this.__elements[0];var A=v2.$$("label[for="+(B.id||B.name)+"]",B.form);return A&amp;&amp;A[0]},getName:function(){if(this.__name){return this.__name}var A=this.getLabel();if(A){return A.title!==""?A.title:A.innerHTML}var B=this.__elements[0];return B.id||B.name},setName:function(A){this.__name=!!A?A:null;return this},getParent:function(){return this.__elements[0].parentNode},getElements:function(){return this.__elements},visible:function(){if(!v2.$(this.getParent()).visible()){return false}for(var A=0,B;(B=this.__elements[A]);A++){if(v2.Element.visible(B)){return true}}return false}},{__fields:{},get:function(B){if(B&amp;&amp;B.constructor===v2.InputElement){return B}var C=v2.$(B),H,G,F,A,D,E;if(!C){A="input$, select$, textarea$";F=v2.$$(A.replace(/\$/g,"[name="+B+"]"));C=F[0]}if(!C){throw new TypeError(B+" does not resolve to an HTML element!")}H=C.name||C.id;if((G=v2.InputElement.__fields[H])){return G}if(C.options){G=new v2.SelectElement(C)}else{if(C.tagName.toLowerCase()==="textarea"){G=new v2.TextareaElement(C)}else{if(C.type&amp;&amp;C.type=="radio"){F=v2.$$("input[type=radio][name="+C.name+"]",C.form);G=new v2.RadioElement(F)}else{if(C.type&amp;&amp;C.type=="checkbox"){D=C.className;E=/\bg_([^\s]*)\b/;F=E.test(D)?v2.$$("input[type=checkbox].g_"+D.match(E)[1],C.form):[C];G=new v2.CheckboxElement(F)}else{G=new v2.InputElement(C)}}}}return(v2.InputElement.__fields[H]=G)}});v2.$f=v2.InputElement.get;v2.RadioElement=v2.InputElement.extend({constructor:function(A){this.base(A,["click","change"])},getValue:function(){for(var B=0,A;(A=this.__elements[B]);B++){if(A.checked){return A.value}}return null},getLabel:function(){var B=this.__elements[0].parentNode;if(B.tagName.toLowerCase()==="li"){return v2.$(B.parentNode).previous()}var A=v2.$(this.__elements[0]).previous();return A||this.base()},getParent:function(){var A=this.__elements[0].parentNode;return A.tagName.toLowerCase()==="li"?A.parentNode.parentNode:A}});v2.SelectElement=v2.InputElement.extend({constructor:function(A){this.base([A],"change")},getValue:function(){var A=this.__elements[0];if(!A.multiple){return A.options[A.selectedIndex].value}var B=[];for(var C=0,D;(D=A.options[C]);C++){if(D.selected){B.push(D.value)}}return B}});v2.TextareaElement=v2.InputElement.extend({});v2.CheckboxElement=v2.RadioElement.extend({getValue:function(){var A=[],B,C;for(B=0,C;(C=this.__elements[B]);B++){if(C.checked){A.push(C.value)}}return A}});v2.Message=Base.extend({constructor:function(B,C,A){this.message=B;this.params=C||[];this.values=A||[]},copy:function(){return new v2.Message(this.message,this.params,this.values)},toString:function(){var C=this.message+"";for(var A=0,B=null;(B=this.params[A]);A++){C=C.replace("${"+B+"}",this.values[A])}return C}});v2.Validator=Base.extend({constructor:function(B,C,D,E,A){this.__name=B;this.__test=C;this.__message=new v2.Message(D||"${field} does not pass "+B+" validator",E);this.__aliases=v2.array(A);this.acceptEmpty=true},test:function(C,E,D){D=typeof D==="undefined"?false:D;var B=C.getValue();var A=(this.acceptEmpty&amp;&amp;B==="")||this.__test(C,B,E);return(A&amp;&amp;!D)||(!A&amp;&amp;D)},getName:function(){return this.__name},getMessage:function(){return this.__message},setMessage:function(A){this.__message.message=A}},{validators:{},add:function(B){if(!B.name||!B.fn){throw new TypeError("Options object should contain name and fn")}B=v2.Object.extend({params:[],aliases:[],acceptEmpty:true},B,false);var F=v2.array(B.params);var D=new v2.Validator(B.name,B.fn,B.message,F,B.aliases);D.acceptEmpty=B.acceptEmpty;var E=v2.array(B.aliases).concat([B.name]);for(var C=0,A;(A=E[C]);C++){v2.Validator.validators[A]=D}return D},reg:function(B,C,F,D,A,E){return v2.Validator.add({name:B,fn:C,message:D,params:F,aliases:A,acceptEmpty:E})},get:function(A){var B;if(A.constructor===v2.Validator){return A}if((B=v2.Validator.validators[A])){return B}return null}});v2.$v=function(A){return v2.Validator.get(A)};v2.$msg=function(){if(arguments.length===2){return v2.Validator.get(arguments[0]).setMessage(arguments[1])}for(var A in arguments[0]){try{v2.Validator.get(A).setMessage(arguments[0][A])}catch(B){}}};v2.Field=v2.CompositeFormItem.extend({validateHidden:false,instant:false,instantWhenValidated:true,type:"field",constructor:function(B,A,C){this.base();this.__monitored=false;this.element=v2.$f(B);this.instant=typeof A!=="undefined"?A:this.instant;this.instantWhenValidated=typeof C!=="undefined"?C:this.instantWhenValidated;this.__monitor(this.instant)},test:function(){if(!this.validateHidden&amp;&amp;!this.element.visible()){return true}return this.base()},validate:function(){this.__monitor(this.instantWhenValidated&amp;&amp;!this.__monitored);return this.base()},addValidator:function(A,E,C){var B=v2.$v(A);if(B===null){throw new Error(A+" is not a valid validator")}if(typeof C!=="undefined"&amp;&amp;C!==null){C=new v2.Message(C,B.getMessage().params)}var D=new v2.FieldValidator(this.element,B,v2.array(E),C);this.add(D);return D},getParent:function(){return this.element.getParent()},__monitor:function(C){if(!C||this.__monitored){return }this.__monitored=true;var A=this.parent&amp;&amp;this.parent.type==="fieldset"?this.parent:this;var B=A.validate.bind(this);this.element.monitor(function(D){B(D)})}});v2.Fieldset=v2.CompositeFormItem.extend({type:"fieldset",constructor:function(A){this.base();this.element=A},getParent:function(){return this.element}});v2.FieldValidator=Base.extend({invert:false,constructor:function(C,A,E,D){this.__field=C;this.__validator=A;this.__params=v2.array(E);this.__message=D||A.__message.copy();var B=this.__message.params;if(B.length&lt;1||B[0]!=="field"){this.__message.params=["field"].concat(B)}this.__message.values=[this.__field.getName()].concat(this.__params)},test:function(){return this.__validator.test(this.__field,this.__params,this.invert)},validate:function(){return this.test()},getInvalid:function(){return !this.test()?this:null},setMessage:function(A){this.__message.message=A},getMessages:function(){return[this.__message.toString()]},add:function(){},remove:function(){},get:function(){},passOnAny:function(){},onSuccess:function(){},onFailure:function(){}});v2.Form=v2.CompositeFormItem.extend({type:"form",constructor:function(A){this.base();this.__form=v2.$(A);this.__form.observe("submit",this.validate.bind(this));this.__buttons=[];this.__activeButton=null},addButton:function(A){this.__buttons.push(A);v2.Element.observe(A,"click",(function(B){this.__activeButton=A}).bind(this))},validate:function(){var D=arguments.length&gt;0?arguments[0]:null;var C=this.__buttons;var A=this.__activeButton;this.__activeButton=null;if(C.length&gt;0&amp;&amp;C.indexOf(A)&lt;0){return true}var B=this.base();if(!B&amp;&amp;D){D.preventDefault();D.returnValue=false}return B}},{forms:{},get:function(C){var B=v2.$(C),A;if(B===null||B.tagName.toLowerCase()!=="form"){throw new ArgumentError("idOrElement should represent a form element")}if(!v2.empty(A=v2.Form.forms[B.id])){return A}return(v2.Form.forms[B.id]=new v2.Form(B))}});(function(){var A=v2.Validator;A.reg("alpha",function(C,B,D){return/^[a-zA-Z\u00A1-\uFFFF]*$/.test(B)});A.reg("alphanum",function(C,B,D){return/^([a-zA-Z\u00A1-\uFFFF0-9])*$/.test(B)});A.reg("confirmation-of",function(C,B,D){return B===v2.$f(D[0]).getValue()},"field-id","${field} should be an exact match",null,false);A.reg("email",function(C,B,D){return/^[a-z0-9!#$%&amp;'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&amp;'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(B)});A.reg("max-length",function(C,B,D){return B.length&lt;D[0]},"max");A.reg("max-val",function(C,B,D){return B&lt;=D[0]},"max");A.reg("min-length",function(C,B,D){return B.length&gt;=D[0]},"min");A.reg("min-val",function(C,B,D){return B&gt;=D[0]},"min");A.reg("numeric",function(C,B,D){return/^[0-9]*(\.[0-9]+)?$/.test(B)});A.reg("required",function(C,B,D){return !v2.empty(B)&amp;&amp;!(typeof B.length!=="undefined"&amp;&amp;B.length===0)},null,null,"not-empty",false);A.reg("url",function(C,B,D){return/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(B)});A.reg("word",function(C,B,D){return/^([a-zA-Z\u00A1-\uFFFF0-9_\-\s\t])*$/.test(B)})})();v2.$msg({alpha:"${field} should only contain letters",alphanum:"${field} should only contain letters and numbers","car-regnum-nor":"${field} should be a valid norwegian auto registration number","confirmation-of":"${field} should be a confirmation of ${field-id}",email:"${field} should be a valid email address","max-length":"${field} should be no more than ${max} characters long","max-val":"${field} should be no bigger than ${min}","min-length":"${field} should be atleast ${min} characters long","min-val":"${field} should be atleast ${min}",numeric:"${field} should only contain numbers","phone-nor":"${field} should be a valid norwegian phone number",required:"${field} is required","ssn-nor":"${field} should be a valid norwegian social security number",url:"${field} should be a valid URL",word:"${field} should only contain letters, numbers and punctuation"});v2.ErrorReporting={displayErrors:-1,positionErrorsAbove:true,failureClass:"error",successClass:"",messagesClass:"messages",onFailure:function(){if(this.parent&amp;&amp;this.parent.type==="fieldset"){return }var I=this.onSuccess();var F="",C,G,A,J;var K=[];var B=this.getMessages();I.addClassName(this.failureClass);I.removeClassName(this.successClass);var D=this.displayErrors;var H=this.__errors.length;D=D&lt;0||D&gt;H?H:D;if(D===0){return }var E=document.createElement("ul");E.id=this.__getId();E.className=this.messagesClass;for(C=0;C&lt;D;C++){G=B[C];if(!G||K.indexOf(G.toString())&gt;=0){continue}K.push(G.toString());J=document.createElement("li");J.innerHTML=G.toString();E.appendChild(J)}if(this.positionErrorsAbove){I.insertBefore(E,I.firstChild)}else{I.appendChild(E)}},onSuccess:function(){if(this.parent&amp;&amp;this.parent.type==="fieldset"){return null}var A=v2.$(this.getParent());var B=v2.$(this.__getId());if(B&amp;&amp;A===B.parentNode){A.removeChild(B)}A.removeClassName(this.failureClass);A.addClassName(this.successClass);return A},__getId:function(){var A=this.element.getElements?this.element.getElements()[0]:null;var C=A||this.getParent();var B=C.className;var D=((C.id||C.name||B.replace(this.failureClass,""))+"_"+this.failureClass).replace(" ","_").replace(/_+/,"_");return D}};v2.Object.extend(v2.Field.prototype,v2.ErrorReporting);v2.Object.extend(v2.Fieldset.prototype,v2.ErrorReporting);v2.Object.extend(v2.Form.prototype,{scrollToFirstWhenFail:true,onFailure:function(){if(!this.scrollToFirstWhenFail){return }var B,A,D,C=this.__form;D=C.all||C.getElementsByTagName("*");for(B=0;(A=D[B]);B++){if(v2.Element.hasClassName(A,v2.ErrorReporting.failureClass)){v2.Element.scrollTo(A);return }}}});v2.Object.extend(v2.Validator,{prefix:""});v2.Object.extend(v2.Form,{autoValidateClass:"validate",actionButtonClass:"action"});v2.html={validateAnyClass:"validate_any",validateAllClass:"validate_all",validatorsFromString:function(I){var E=v2.Validator.prefix;var G=new RegExp("^"+E,"");var F,H,B,D,A,C=[];I=I.split(" ");for(F=0;(H=I[F]);F++){B=false;if(!v2.empty(E)&amp;&amp;!G.test(H)){continue}H=H.replace(G,"");if(/^not_/.test(H)){H=H.replace(/^not_/,"");B=true}D=H.split("_");A=D.shift();if(A&amp;&amp;(A=v2.$v(A))){C.push({validator:A,params:D,invert:B})}}return C},applyValidators:function(A,F,D){if(!v2.empty(D)){F.setMessage(D)}for(var C=0,B,E;(B=A[C]);C++){E=F.addValidator(B.validator,B.params);E.invert=B.invert}return F}};v2.html.Form=Base.extend({constructor:function(A){this.form=v2.Form.get(A);this.__parsed={};this.parseElement(A,this.form);this.form.passOnAny(v2.$(A).hasClassName(v2.html.validateAnyClass))},parseElement:function(C,K,E){var A=v2.$$("div, fieldset, input, select, textarea",C);var H,F,B,I,G,D,L,J;this.__parsed[C.id||C.name]=true;E=E||[];for(H=0;(G=A[H]);H++){if(E.length===0&amp;&amp;(/^\s*$/.test(G.className)||this.__parsed[G.id||G.name])){continue}D=G.tagName.toLowerCase();if(D==="input"&amp;&amp;v2.Element.hasClassName(G,v2.Form.actionButtonClass)){this.form.addButton(G);continue}if(D==="div"||D==="fieldset"){this.parseBlock(G,K);continue}J=E.concat(v2.html.validatorsFromString(G.className));if(J.length&gt;0){L=new v2.Field(G);v2.html.applyValidators(J,L,G.title);this.__parsed[G.id||G.name]=true;K.add(L)}}},parseBlock:function(C,E){var D=new v2.Fieldset(C);var B=true;v2.$(C);if(C.hasClassName(v2.html.validateAnyClass)){}else{if(C.hasClassName(v2.html.validateAllClass)){B=false}else{return }}D.passOnAny(B);var A=v2.html.validatorsFromString(C.className);this.parseElement(C,D,A);if(!/^\s*$/.test(C.title)){D.setMessage(C.title)}if(D.get(0)){E.add(D)}}});v2.addDOMLoadEvent(function(){var A=document.getElementsByTagName("form");for(var B=0,C;(C=A[B]);B++){if(v2.Element.hasClassName(C,v2.Form.autoValidateClass)){new v2.html.Form(C)}}});v2.dsl={__validateTemplate:function(A){return function(){var F=arguments[0];var D=F.element||(F.item?F.item.element:null)||null;if(D===null){while(!!F&amp;&amp;!F.element){F=F.get(0)}}var E=new v2.dsl.Form(D.getElements()[0].form);E.item.passOnAny(A);for(var C=0,B;(B=arguments[C]);C++){E.item.add(B.item||B)}return E}},__andOr:function(A){return function(){var D=new v2.dsl.Collection();D.item.passOnAny(A);for(var C=0,B;(B=arguments[C]);C++){D.item.add(B.item)}return D}}};v2.dsl.expose=function(){var A=v2.dsl;v2.Object.extend(window,{validate:A.validate,validateAll:A.validateAll,validateAny:A.validateAny,and:A.and,or:A.or},false)};v2.dsl.validateAll=v2.dsl.validate=v2.dsl.__validateTemplate(false);v2.dsl.validateAny=v2.dsl.__validateTemplate(true);v2.dsl.and=v2.dsl.__andOr(false);v2.dsl.or=v2.dsl.__andOr(true);v2.Object.extend(String.prototype,{is:function(A,C){var B=new v2.dsl.Field(this.toString());return B.addValidator(A,C)}});(function(){var A=String.prototype;A.isA=A.isAn=A.has=A.hasA=A.hasAn=A.is})();v2.dsl.Field=Base.extend({__currentValidator:null,__and:null,constructor:function(A){this.item=new v2.Field(A)},addValidator:function(A,C,B){if(typeof B!=="undefined"){if(this.__and!==null&amp;&amp;this.__and!==B){throw new Error("Field previously set up with "+(this.__and?"AND":"OR")+", unable to shift")}this.__and=B;this.item.passOnAny(!B)}this.__currentValidator=this.item.addValidator(A,C);return this},and:function(A,B){if(!this.__currentValidator){throw new Error("Cannot add more validators when no validators are added yet")}return this.addValidator(A,B,true)},or:function(A,B){if(!!this.__currentValidator){throw new Error("Cannot add more validators when no validators are added yet")}return this.addValidator(A,B,false)},explain:function(A){if(!this.__currentValidator){throw new Error("No active field validator")}this.__currentValidator.setMessage(A);return this},help:function(A){this.item.setMessage(A);return this},withName:function(A){this.item.element.setName(A);return this}});(function(){var A=v2.dsl.Field.prototype;A.orIs=A.orIsA=A.orIsAn=A.orHas=A.orHasA=A.orHasAn=A.or;A.andIs=A.andIsA=A.andIsAn=A.andHas=A.andHasA=A.andHasAn=A.and})();v2.dsl.Collection=Base.extend({constructor:function(){this.item=new v2.CompositeFormItem()},explain:function(A){this.item.setMessage(A)}});v2.dsl.Form=Base.extend({constructor:function(A){this.item=v2.Form.get(A)},on:function(){var B,A;for(B=0;B&lt;arguments.length;B++){A=v2.$(arguments[B]);this.item.addButton(A.tagName.toLowerCase()!=="input"?A.getElementsByTagName("input")[0]:A)}}});
</t>
<t tx="zoomq.20120727213305.14737">@language html
导航:&lt;a href="/"&gt;首页&lt;/a&gt;
|&lt;a href="/mana"&gt;管理&lt;/a&gt;
|&lt;a href="/api"&gt;接口&lt;/a&gt;


</t>
<t tx="zoomq.20120727213305.14738">/*
 * validate.js 1.1
 * Copyright (c) 2012 Rick Harrison, http://rickharrison.me
 * validate.js is open sourced under the MIT license.
 * Portions of validate.js are inspired by CodeIgniter.
 * http://rickharrison.github.com/validate.js
 */

(function(k,l,i){var m={required:"The %s field is required.",matches:"The %s field does not match the %s field.",valid_email:"The %s field must contain a valid email address.",valid_emails:"The %s field must contain all valid email addresses.",min_length:"The %s field must be at least %s characters in length.",max_length:"The %s field must not exceed %s characters in length.",exact_length:"The %s field must be exactly %s characters in length.",greater_than:"The %s field must contain a number greater than %s.",
less_than:"The %s field must contain a number less than %s.",alpha:"The %s field must only contain alphabetical characters.",alpha_numeric:"The %s field must only contain alpha-numeric characters.",alpha_dash:"The %s field must only contain alpha-numeric characters, underscores, and dashes.",numeric:"The %s field must contain only numbers.",integer:"The %s field must contain an integer.",decimal:"The %s field must contain a decimal number.",is_natural:"The %s field must contain only positive numbers.",
is_natural_no_zero:"The %s field must contain a number greater than zero.",valid_ip:"The %s field must contain a valid IP.",valid_base64:"The %s field must contain a base64 string."},n=function(){},o=/^(.+)\[(.+)\]$/,h=/^[0-9]+$/,p=/^\-?[0-9]+$/,g=/^\-?[0-9]*\.?[0-9]+$/,j=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,q=/^[a-z]+$/i,r=/^[a-z0-9]+$/i,s=/^[a-z0-9_-]+$/i,t=/^[0-9]+$/i,u=/^[1-9][0-9]*$/i,v=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,w=
/[^a-zA-Z0-9\/\+=]/i,e=function(a,b,c){this.callback=c||n;this.errors=[];this.fields={};this.form=l.forms[a]||{};this.messages={};this.handlers={};a=0;for(c=b.length;a&lt;c;a++){var d=b[a];d.name&amp;&amp;d.rules&amp;&amp;(this.fields[d.name]={name:d.name,display:d.display||d.name,rules:d.rules,id:null,type:null,value:null,checked:null})}this.form.onsubmit=function(a){return function(b){try{return a._validateForm(b)}catch(c){}}}(this)};e.prototype.setMessage=function(a,b){this.messages[a]=b;return this};e.prototype.registerCallback=
function(a,b){a&amp;&amp;("string"===typeof a&amp;&amp;b&amp;&amp;"function"===typeof b)&amp;&amp;(this.handlers[a]=b);return this};e.prototype._validateForm=function(a){this.errors=[];for(var b in this.fields)if(this.fields.hasOwnProperty(b)){var c=this.fields[b]||{},d=this.form[c.name];d&amp;&amp;d!==i&amp;&amp;(c.id=d.id,c.type=d.type,c.value=d.value,c.checked=d.checked);this._validateField(c)}"function"===typeof this.callback&amp;&amp;this.callback(this.errors,a);if(0&lt;this.errors.length)if(a&amp;&amp;a.preventDefault)a.preventDefault();else return!1;return!0};
e.prototype._validateField=function(a){var b=a.rules.split("|");if(!(-1===a.rules.indexOf("required")&amp;&amp;(!a.value||""===a.value||a.value===i)))for(var c=0,d=b.length;c&lt;d;c++){var f=b[c],e=null,g=!1;if(parts=o.exec(f))f=parts[1],e=parts[2];"function"===typeof this._hooks[f]?this._hooks[f].apply(this,[a,e])||(g=!0):"callback_"===f.substring(0,9)&amp;&amp;(f=f.substring(9,f.length),"function"===typeof this.handlers[f]&amp;&amp;!1===this.handlers[f].apply(this,[a.value])&amp;&amp;(g=!0));if(g){b=this.messages[f]||m[f];c="An error has occurred with the "+
a.display+" field.";b&amp;&amp;(c=b.replace("%s",a.display),e&amp;&amp;(c=c.replace("%s",this.fields[e]?this.fields[e].display:e)));this.errors.push({id:a.id,name:a.name,message:c});break}}};e.prototype._hooks={required:function(a){var b=a.value;return"checkbox"===a.type?!0===a.checked:null!==b&amp;&amp;""!==b},matches:function(a,b){return(el=this.form[b])?a.value===el.value:!1},valid_email:function(a){return j.test(a.value)},valid_emails:function(a){for(var a=a.value.split(","),b=0;b&lt;a.length;b++)if(!j.test(a[b]))return!1;
return!0},min_length:function(a,b){return!h.test(b)?!1:a.value.length&gt;=parseInt(b,10)},max_length:function(a,b){return!h.test(b)?!1:a.value.length&lt;=parseInt(b,10)},exact_length:function(a,b){return!h.test(b)?!1:a.value.length===parseInt(b,10)},greater_than:function(a,b){return!g.test(a.value)?!1:parseFloat(a.value)&gt;parseFloat(b)},less_than:function(a,b){return!g.test(a.value)?!1:parseFloat(a.value)&lt;parseFloat(b)},alpha:function(a){return q.test(a.value)},alpha_numeric:function(a){return r.test(a.value)},
alpha_dash:function(a){return s.test(a.value)},numeric:function(a){return g.test(a.value)},integer:function(a){return p.test(a.value)},decimal:function(a){return g.test(a.value)},is_natural:function(a){return t.test(a.value)},is_natural_no_zero:function(a){return u.test(a.value)},valid_ip:function(a){return v.test(a.value)},valid_base64:function(a){return w.test(a.value)}};k.FormValidator=e})(window,document);
</t>
<t tx="zoomq.20120727213305.14741">@language html

&lt;script type="text/javascript" language="javascript"&gt;
&lt;&lt;validate.js 1.1&gt;&gt;
&lt;/script&gt;
</t>
<t tx="zoomq.20120727213305.14743">@language js
new FormValidator('upcrxform', [{
    name: 'crxname',
    display: 'required',    
    rules: 'required|min_length[4]'
}, {
    name: 'crxfile',
    display: 'required',    
    rules: 'required'
}], function(errors, event) {
    var SELECTOR_ERRORS = $('.error_box'),
        SELECTOR_SUCCESS = $('.success_box');
        
    if (errors.length &gt; 0) {
        SELECTOR_ERRORS.empty();
        
        for (var i = 0, errorLength = errors.length; i &lt; errorLength; i++) {
            SELECTOR_ERRORS.append(errors[i].message + '&lt;br /&gt;');
        }
        
        SELECTOR_SUCCESS.css({ display: 'none' });
        SELECTOR_ERRORS.fadeIn(200);
    } else {
        SELECTOR_ERRORS.css({ display: 'none' });
        SELECTOR_SUCCESS.fadeIn(200);
    }
    
    if (event &amp;&amp; event.preventDefault) {
        event.preventDefault();
    } else if (event) {
        event.returnValue = false;
    }
});

</t>
<t tx="zoomq.20120727213305.14749">@language css

/**
 * TERMS OF USE - Validatious 2.0
 * Open source under the BSD License.
 * Copyright 2008 Christian Johansen.
 * All rights reserved.
 */
.error{color:#900;background:#f8f8f8;}
.error .messages,.error .messages li{list-style:none;}
.error .messages{font-size:1em;padding:.6667em 0 0 1em;}
</t>
<t tx="zoomq.20120727213305.14750">import sys
import os.path
#from os.path import abspath, dirname, join
#import logging
app_root = os.path.dirname(__file__)
sys.path.insert(0, os.path.join(app_root, "3party/"))
sys.path.insert(0, os.path.join(app_root, "module/"))
sys.path.insert(0, os.path.join(app_root, "web/"))

'''
sys.path.insert(0, abspath(dirname(__file__)))
sys.path.insert(0, abspath(join(dirname(__file__), "3party/")))
sys.path.insert(0, abspath(join(dirname(__file__), "module/")))
sys.path.insert(0, abspath(join(dirname(__file__), "web/")))
CUSTOM_TPL_PATH = os.path.abspath(
    os.path.join(
        os.path.dirname(__file__)
        , "views/")
    )
'''

#   指定的模板路径
JINJA2TPL_PATH = os.path.abspath(
    os.path.join(
        os.path.dirname(__file__)
        , "templates/")
    )
#   静态文件
#STATIC_FILE_PATH = abspath(join(dirname(__file__), "static/"))
#   网站根域名
#ROOT_DOMAIN = 'test.com'
#   session相关
#SECRET_KEY = 'secret_key_for_test'
#SESSION_MAX_AGE = 7200
</t>
<t tx="zoomq.20120727213305.14751">def KV4CRX(uuid, action):
    '''.crx 状态 KV 列表统一切换器:
        - 对扩展的所有状态对应的组合映射到一批列表中
      act\KV|crx try out bak arch api4cx 
        新增  0   1   0   0    0   0   (请求上架)    
        回退  0   0   0   1    0   0    
        上架  1   0   0   0    0   1   
        下架  0   0   1   0    0   0   
        归档  0   0   0   0    1   0   
        回收  0   1   0   0    0   0   
    '''
    #print uuid
    #KV = sae.kvdb.KVClient()
    k4crx, crcrxs = INIobjSYS('crx')
    k4try, crtrys = INIobjSYS('try')
    k4out, crouts = INIobjSYS('out')
    k4bak, crbaks = INIobjSYS('bak')
    k4arc, crarch = INIobjSYS('arch')
    k4ctc, ctcapi = INIobjSYS('api4cx')
    try:
        if "ini" == action:
            POP4KV(uuid, k4crx, crcrxs)
            INS2KV(uuid, k4try, crtrys)
            POP4KV(uuid, k4out, crouts)
            POP4KV(uuid, k4bak, crbaks)
            POP4KV(uuid, k4arc, crarch)
            POP4KV(uuid, k4ctc, ctcapi)
        elif "bak" == action:
            POP4KV(uuid, k4crx, crcrxs)
            POP4KV(uuid, k4try, crtrys)
            POP4KV(uuid, k4out, crouts)
            INS2KV(uuid, k4bak, crbaks)
            POP4KV(uuid, k4arc, crarch)
            POP4KV(uuid, k4ctc, ctcapi)
        elif "recover" == action:
            POP4KV(uuid, k4crx, crcrxs)
            INS2KV(uuid, k4try, crtrys)
            POP4KV(uuid, k4out, crouts)
            POP4KV(uuid, k4bak, crbaks)
            POP4KV(uuid, k4arc, crarch)
            POP4KV(uuid, k4ctc, ctcapi)
        elif "pub" == action:
            INS2KV(uuid, k4crx, crcrxs)
            POP4KV(uuid, k4try, crtrys)
            POP4KV(uuid, k4out, crouts)
            POP4KV(uuid, k4bak, crbaks)
            POP4KV(uuid, k4arc, crarch)
            INS2KV(uuid, k4ctc, ctcapi)
        elif "out" == action:
            POP4KV(uuid, k4crx, crcrxs)
            POP4KV(uuid, k4try, crtrys)
            INS2KV(uuid, k4out, crouts)
            POP4KV(uuid, k4bak, crbaks)
            POP4KV(uuid, k4arc, crarch)
            POP4KV(uuid, k4ctc, ctcapi)
        elif "arch" == action:
            POP4KV(uuid, k4crx, crcrxs)
            POP4KV(uuid, k4try, crtrys)
            POP4KV(uuid, k4out, crouts)
            POP4KV(uuid, k4bak, crbaks)
            INS2KV(uuid, k4arc, crarch)
            POP4KV(uuid, k4ctc, ctcapi)
    except:
        print "&gt;&gt;&gt;KV4CRX(uuid)\n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    print "\t crcrxs:",crcrxs
    print "\t crtrys:",crtrys
    print "\t crouts:",crouts
    print "\t crbaks:",crbaks
    print "\t crarch:",crarch
    print "\t ctcapi:",ctcapi
    
    return crcrxs, crtrys, crouts, crbaks, crarch, ctcapi



</t>
<t tx="zoomq.20120727213305.14756">def INIobjSYS(key):
    '''try and init. all kinds of objSYS K/V
    '''    
    if key not in CFG.K4D.keys():
        return None
    else:
        #print CFG.K4D[key]
        if not KV.get(CFG.K4D[key]):
            KV.add(CFG.K4D[key],[])
        return CFG.K4D[key], KV.get(CFG.K4D[key])




</t>
<t tx="zoomq.20120727213305.14759">@APP.route('/tag/ini', method='POST')
def initag():
    ''' realy ACTION:
        - deepcopy(CFG.objTAG) updeta with from
        - appended t:id into CFG.K4D['tag']
        - jump into /tag/t:id/info
    '''
    name = request.forms.get('name')
    desc = request.forms.get('desc', '...') #request.files.get('data')
    #print name, desc
    #print GENID('tag')
    tag =  deepcopy(CFG.objTAG)
    #print "CFG.objTAG id: ", id(CFG.objTAG)
    #print "tag id: ", id(tag)
    tid = GENID('tag')
    tag['id'] = tid
    tag['name'] = name.decode('utf-8')
    tag['desc'] = desc.decode('utf-8')
    #print tag
    sysk, crtags = INIobjSYS('tag')
    #print sysk, crtags
    try:
        KV.add(tid, tag)
        #print "&gt;&gt;&gt;  collection all TAGs"
        crtags.append(tid)  # return None !!!!
        KV.set(sysk, crtags)
        uri = "/mana/tag/%s"% tid
        #print uri
        #redirect("/tag/%s/info"% tid, code=303)
        response.set_header('location', uri)
        response.status = 303
        #redirect NOT WORK! abt.
        #https://github.com/defnull/bottle/issues/236
        #https://groups.google.com/forum/#!topic/bottlepy/RQV3B7ACiNk/discussion
    except:
        print "&gt;&gt;&gt;/mana/tag/ini\n\t", traceback.print_exc()
        #sys.exit(1)
        return None
        
    #return None


</t>
<t tx="zoomq.20120727213305.14761">@APP.route('/tag/&lt;tid&gt;')
def tagsee(tid):
    ''' realy ACTION:
        - get obj. by t:id
    '''
    #print tid
    #print INIobjSYS('tag')
    crtag = KV.get(tid)
    crxs = IDX4LIST(crtag['crxs'], KV)
    return template('tag.html'
        , tag=crtag
        , crxs=crxs
        )


    '''
    print "\t&gt;&gt;&gt;", crtag['crxs']
    cli = []
    for i in crtag['crxs']:
        if "t:" == i[:2]:
            print i
        else:
            cli.append(i)
    print cli
    crtag['crxs'] = cli
    KV.set(tid, crtag)
    '''

</t>
<t tx="zoomq.20120727213305.14764">@language html
{% extends "base.html" %}

{% block title4act %}
TAGs
    {% endblock title4act %}

{% block headJS %}
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
    {% if tags is none %}
            &lt;b&gt;还未有任何标签!&lt;/b&gt;
            &lt;fieldset&gt;
            &lt;legend&gt;初始化个;-}&lt;/legend&gt;
            &lt;&lt;1st TAG&gt;&gt;            
            &lt;/fieldset&gt;
    {% else %}
            &lt;h2&gt;商店标签s::&lt;/h2&gt;
                &lt;&lt;TAGli&gt;&gt;
                &lt;hr/&gt;
            &lt;fieldset&gt;
            &lt;legend&gt;追加;-}&lt;/legend&gt;
            &lt;&lt;1st TAG&gt;&gt;            
            &lt;/fieldset&gt;
    {% endif %}
        
{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120727213305.14765">&lt;form action="/mana/tag/ini" method="post"  
    id="initagform" name="initagform" class="validate"&gt;
名称:&lt;input type="text" name="name" id="name" 
    class="required min-length_4" title="标签名称必填!且长过4字!"/&gt;
  &lt;br/&gt;
描述:&lt;input type="text" name="desc" id="desc" value="......"/&gt;
  &lt;br/&gt;
&lt;span id="reply_submit" class="btnw right"&gt;
    &lt;button type="submit" name="submit" class="action" &gt;就酱&lt;/button&gt;
&lt;/span&gt;
&lt;/form&gt;
</t>
<t tx="zoomq.20120727213305.14767">@APP.route('/tag/&lt;tid&gt;/ed')
@auth_required()
def taged(tid):
    ''' realy ACTION:
        - get obj. by t:id
    '''
    #print tid
    #print INIobjSYS('tag')
    crtag = KV.get(tid)
    #print crtag
    return template('taged.html', tag=crtag)


</t>
<t tx="zoomq.20120727213305.14769">@language html
{% extends "base.html" %}
{% block title4act %}
TAGinfo.
    {% endblock title4act %}
{% block headJS %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展标签, 信息&lt;/legend&gt;
&lt;label&gt;

@others

&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120727213305.14771">@APP.route('/tag/&lt;tid&gt;/info', method='POST')
def taginfo(tid):
    ''' realy ACTION:
        - set obj. vars base t:id
    '''
    name = request.forms.get('name')
    desc = request.forms.get('desc', '...') #request.files.get('data')
    #print name, desc
    #print INIobjSYS('tag')
    crtag = KV.get(tid)
    crtag['name'] = name.decode('utf-8')
    crtag['desc'] = desc.decode('utf-8')
    KV.set(tid, crtag)
    #print crtag
    redirect("/mana/tag/%s"% tid)
    #return template('tag.html', tag=crtag)


</t>
<t tx="zoomq.20120727213305.14772">.btnw button {
    font-size:16px;
    text-align:center;
    overflow:visible;
    height:42px;
    padding:0 28px;
    line-height:41px;
    padding-bottom:2px;
    vertical-align:text-bottom;
    
    z-index:1;
    overflow:visible;
    display:inline-block;
    border:0;
    margin:0;
    text-align:center;
    white-space:nowrap;
    cursor:pointer;
    color:#555;
    background-color:#fff;
    background-image:-webkit-gradient(linear,0 0,0 100%,from(#fff),to(#f3f3f3));
    background-image:-moz-linear-gradient(#fff,#f3f3f3);
    background-image:-o-linear-gradient(#fff,#f3f3f3);
    background-image:linear-gradient(#fff,#f3f3f3);
    filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#ffffff',EndColorStr='#f3f3f3');
    zoom:1;
}

.btnw button:hover{
    border-color: #3072b3;
    border-bottom-color: #2a65a0;
    text-decoration: none;
    text-shadow: -1px -1px 0 rgba(0,0,0,0.3);
    color: #fff;
    background-color: #3c8dde;
    background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#599bdc), to(#3072b3));
    background-image: -moz-linear-gradient(#599bdc, #3072b3);
    background-image: -o-linear-gradient(#599bdc, #3072b3);
    background-image: linear-gradient(#599bdc, #3072b3);
    }

.btnw button:active{
    color:#666;
    background-color:#f3f3f3;
    background-image:-webkit-gradient(linear,0 0,0 100%,from(#f3f3f3),to(#fff));
    background-image:-moz-linear-gradient(#f3f3f3,#fff);
    background-image:-o-linear-gradient(#f3f3f3,#fff);background-image:linear-gradient(#f3f3f3,#fff);
    filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#f3f3f3',EndColorStr='#ffffff')
}

</t>
<t tx="zoomq.20120727213305.14773">.btnw a {
    text-decoration: none;
    font-size:16px;
    text-align:center;
    overflow:visible;
    padding:0 28px;
    height:40px;
    line-height:41px;
    padding-bottom:2px;
    vertical-align:text-bottom;
    
    z-index:1;
    overflow:visible;
    display:inline-block;
    border:0;
    margin:0;
    text-align:center;
    white-space:nowrap;
    cursor:pointer;
    color:#555;
    background-color:#fff;
    background-image:-webkit-gradient(linear,0 0,0 100%,from(#fff),to(#f3f3f3));
    background-image:-moz-linear-gradient(#fff,#f3f3f3);
    background-image:-o-linear-gradient(#fff,#f3f3f3);
    background-image:linear-gradient(#fff,#f3f3f3);
    filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#ffffff',EndColorStr='#f3f3f3');
    zoom:1;
}

.btnw a:hover{
    border-color: #3072b3;
    border-bottom-color: #2a65a0;
    text-decoration: none;
    text-shadow: -1px -1px 0 rgba(0,0,0,0.3);
    color: #fff;
    background-color: #3c8dde;
    background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#599bdc), to(#3072b3));
    background-image: -moz-linear-gradient(#599bdc, #3072b3);
    background-image: -o-linear-gradient(#599bdc, #3072b3);
    background-image: linear-gradient(#599bdc, #3072b3);
    }

.btnw a:active{
    color:#666;
    background-color:#f3f3f3;
    background-image:-webkit-gradient(linear,0 0,0 100%,from(#f3f3f3),to(#fff));
    background-image:-moz-linear-gradient(#f3f3f3,#fff);
    background-image:-o-linear-gradient(#f3f3f3,#fff);background-image:linear-gradient(#f3f3f3,#fff);
    filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#f3f3f3',EndColorStr='#ffffff')
}
</t>
<t tx="zoomq.20120727213305.14775">@APP.route('/tag/&lt;tid&gt;/del')
def tagdel(tid):
    ''' realy ACTION:
        - set isdel == 1
        - remove t:id from CFG.K4D['tag']
    '''
    sysk, crtags = INIobjSYS('tag')
    try:
        #print tid
        crtag = KV.get(tid)
        #print crtag
        crtag['isdel'] = 1
        KV.set(tid, crtag)
        crtags.pop(crtags.index(tid))
        KV.set(sysk, crtags)    # VERY NEED
    except:
        # cancel reDel,
        print "&gt;&gt;&gt;/mana/tag/../del \n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    redirect("/mana/tags")
    #return "deleting %s"% tid


</t>
<t tx="zoomq.20120727213305.14776">&lt;span class="label"&gt;名称:&lt;/span&gt;
&lt;input type="text" name="name" id="name" value="{{ tag['name'] }} "
    class="required min-length_4" title="标签名称必填!且长过4字!"/&gt;
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;
&lt;input type="text" name="desc" id="desc" value="{{ tag['desc'] }} "
    class="required min-length_4" title="标签描述必填!且长过4字!"/&gt;
    &lt;br/&gt;
&lt;label&gt;
&lt;/label&gt;
    &lt;br/&gt;
&lt;span id="reply_submit" class="btnw"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/mana/tags" &gt;返回&lt;/a&gt;
&lt;/span&gt;
    &lt;br/&gt;
&lt;i&gt;
id: {{ tag['id'] }} 
;order: {{ tag['order'] }} 
&lt;/i&gt;</t>
<t tx="zoomq.20120727213305.14778">&lt;/label&gt;


&lt;span id="reply_submit" class="btnw"&gt;
    &lt;a href="/mana/tag/{{ tag.id }}/ed" &gt;编辑&lt;/a&gt;
&lt;/span&gt;
&lt;span id="del_submit" class="btnw"&gt;
    &lt;a href="/mana/tag/{{ tag.id }}/del" &gt;删除&lt;/a&gt;
&lt;/span&gt;
&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/mana/tags" &gt;返回&lt;/a&gt;
&lt;/span&gt;

    &lt;br/&gt;
&lt;i&gt;
id: {{ tag['id'] }} 
;order: {{ tag['order'] }} 
&lt;/i&gt;</t>
<t tx="zoomq.20120727213305.14779">&lt;ul&gt;
{% for t in tags %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;&lt;a href="/mana/tag/{{ t.id }}" title="{{ t.desc }}"&gt;{{ t.name }}&lt;/a&gt;
    &lt;sub&gt;
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/tag/{{ t.id }}/ed" &gt;改&lt;/a&gt;
    &lt;/span&gt;
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/tag/{{ t.id }}/del" &gt;删&lt;/a&gt;
    &lt;/span&gt;
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120727213305.14781">#iterm sub{
    float: right; padding: 0; margin: 5px 0 0 0; 
    border-bottom: 1px dotted #ccc;
    height:22px; line-height:22px; 
    overflow:hidden;
}

#iterm .btnwa{
    display:inline-block;
    border:1px solid #ccc;
    height:22px;
}
#iterm .btnwa a {
    text-decoration: none;
    font-size:12px;
    text-align:center;
    overflow:visible;
    padding:0 18px;
    height:22px;
    line-height:22px;
    vertical-align:text-bottom;

    z-index:1;
    display:inline-block;
    border:0;
    text-align:center;
    white-space:nowrap;
    cursor:pointer;
    color:#555;
    background-color:#fff;
    background-image:-webkit-gradient(linear,0 0,0 100%,from(#fff),to(#f3f3f3));
    background-image:-moz-linear-gradient(#fff,#f3f3f3);
    background-image:-o-linear-gradient(#fff,#f3f3f3);
    background-image:linear-gradient(#fff,#f3f3f3);
    filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#ffffff',EndColorStr='#f3f3f3');
    zoom:1;
}

#iterm .btnwa a:hover{
    border-color: #3072b3;
    border-bottom-color: #2a65a0;
    text-decoration: none;
    text-shadow: -1px -1px 0 rgba(0,0,0,0.3);
    color: #fff;
    background-color: #3c8dde;
    background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#599bdc), to(#3072b3));
    background-image: -moz-linear-gradient(#599bdc, #3072b3);
    background-image: -o-linear-gradient(#599bdc, #3072b3);
    background-image: linear-gradient(#599bdc, #3072b3);
    }

#iterm .btnwa a:active{
    color:#666;
    background-color:#f3f3f3;
    background-image:-webkit-gradient(linear,0 0,0 100%,from(#f3f3f3),to(#fff));
    background-image:-moz-linear-gradient(#f3f3f3,#fff);
    background-image:-o-linear-gradient(#f3f3f3,#fff);background-image:linear-gradient(#f3f3f3,#fff);
    filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#f3f3f3',EndColorStr='#ffffff')
}
</t>
<t tx="zoomq.20120727213305.14782"></t>
<t tx="zoomq.20120727213305.14786">@language html
{% extends "base.html" %}

{% block title4act %}
CRX try PUB/BAK
    {% endblock title4act %}

{% block headJS %}
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;h1&gt;确认发布/退回::&lt;/h1&gt;
&lt;fieldset&gt;
&lt;legend&gt;处置扩展::&lt;/legend&gt;

{% if jump == "pub" %}
&lt;form action="/mana/crx/{{ crx.uuid }}/pub" method="post"&gt;

{% elif jump == "bak" %}
&lt;form action="/mana/crx/{{ crx.uuid }}/bak" method="post"&gt;

{% elif jump == "out" %}
&lt;form action="/mana/crx/{{ crx.uuid }}/out" method="post"&gt;

{% elif jump == "arch" %}
&lt;form action="/mana/crx/{{ crx.uuid }}/arch" method="post"&gt;

{% elif jump == "recover" %}
&lt;form action="/mana/crx/{{ crx.uuid }}/recover" method="post"&gt;

{% endif %}

@others

&lt;/form&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}


{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120727213305.14791">@language html
{% extends "base.html" %}
{% block title4act %}
CRXinfo.
    {% endblock title4act %}
{% block headJS %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展详情::&lt;/legend&gt;


&lt;&lt;操作按钮&gt;&gt;
&lt;br/&gt;&lt;hr/&gt;
&lt;&lt;详情展示&gt;&gt;
&lt;br/&gt;&lt;hr/&gt;
&lt;&lt;操作按钮&gt;&gt;
&lt;br/&gt;
&lt;&lt;配图&gt;&gt;

&lt;&lt;退回信息&gt;&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}

{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120727213305.14792">&lt;span class="label"&gt;名称:&lt;/span&gt;{{ crx.name }}
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;&lt;pre class="desc"&gt;{{ crx.desc }}
&lt;/pre&gt;
    &lt;br/&gt;
&lt;span class="label"&gt;版本:&lt;/span&gt;{{ crx.version }}
    &lt;br/&gt;

&lt;span class="label"&gt;推荐?&lt;/span&gt;
     {% if crx.isreco == 1 %}
    &lt;b class="alert"&gt;是;-)&lt;/b&gt;
     {% else %}
    &lt;i&gt;否;-|&lt;/i&gt;
     {% endif %}
    &lt;br/&gt;
    
&lt;span class="label"&gt;详情:&lt;/span&gt;&lt;pre class="desc"&gt;
{{ crx.detail }}
&lt;/pre&gt;
    &lt;br/&gt;
&lt;span class="label"&gt;下载量:&lt;/span&gt;{{ crx.dlrank }}
    &lt;br/&gt;

&lt;span class="label"&gt;下载crx:&lt;/span&gt;
&lt;a href="{{ sspath4crx }}/{{ crx.sid }}"&gt;
{{ crx.sid }}
&lt;/a&gt;
    &lt;br/&gt;

&lt;span class="label"&gt;标签:&lt;/span&gt;
{% if tags is none %}
    &lt;b class="alert"&gt;未绑定!&lt;/b&gt;
    &lt;br/&gt;
{% else %}
    {% for t in tags %}
    &lt;a href="/mana/tag/{{ t.id }}"&gt;{{ t.name }}&lt;/a&gt; ; 
    {% endfor %}
    &lt;br/&gt;
{% endif %}

&lt;span class="label"&gt;团队:&lt;/span&gt;
{% if grp is none %}
    &lt;b class="alert"&gt;未指定!&lt;/b&gt;
    &lt;br/&gt;
{% else %}
    &lt;a href="/mana/grp/{{ grp.id }}"&gt;{{ grp.name }}&lt;/a&gt; ;
    &lt;br/&gt;
{% endif %}


&lt;span class="label"&gt;G.下载:&lt;/span&gt;{{ crx.gsdl }}
    &lt;br/&gt;
&lt;span class="label"&gt;G.活跃用户数:&lt;/span&gt;{{ crx.gsusr }}
    &lt;br/&gt;
&lt;span class="label"&gt;G.Rank:&lt;/span&gt;{{ crx.gsrank }}
    &lt;br/&gt;
    




</t>
<t tx="zoomq.20120727213305.14795">@language html
{% extends "base.html" %}
{% block title4act %}
CRXed.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展上传重样儿了!-(&lt;/legend&gt;

@others

&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120727213305.14803">@APP.route('/grps')
@auth_required()
def grps():
    ''' realy ACTION:
        - listing all grp with ctrl links
    '''
    sysk, crgrps = INIobjSYS('grp')
    #print sysk, crgrps
    #print KV.get(sysk)
    #print len(crgrps)
    if 0 == len(crgrps):
        objgrps = None
    else:
        objgrps = []
        for gid in crgrps:
            #print gid
            #print KV.get(gid)
            objgrps.append(KV.get(gid))
    return template('grps.html', grps=objgrps)


@others


</t>
<t tx="zoomq.20120727213305.14804">@APP.route('/grp/ini', method='POST')
def inigrp():
    ''' realy ACTION:
        - deepcopy(CFG.objGRP) updeta with from
        - appended g:id into CFG.K4D['grp']
        - jump into /grp/g:id/info
    '''
    name = request.forms.get('name')
    desc = request.forms.get('desc', '...') 
    grp =  deepcopy(CFG.objGRP)
    #print "CFG.objTAG id: ", id(CFG.objTAG)
    #print "tag id: ", id(tag)
    gid = GENID('grp')
    grp['id'] = gid
    grp['name'] = name.decode('utf-8')
    grp['desc'] = desc.decode('utf-8')
    #print grp
    sysk, crgrps = INIobjSYS('grp')
    #print sysk, crgrps
    try:
        KV.add(gid, grp)
        crgrps.append(gid)  # return None !!!!
        KV.set(sysk, crgrps)
        uri = "/mana/grp/%s"% gid
        #print uri
        #redirect("/tag/%s/info"% tid, code=303)
        response.set_header('location', uri)
        response.status = 303
        #redirect NOT WORK! abt.
        #https://github.com/defnull/bottle/issues/236
        #https://groups.google.com/forum/#!topic/bottlepy/RQV3B7ACiNk/discussion
    except:
        print "&gt;&gt;&gt;/mana/tag/ini\n\t", traceback.print_exc()
        #sys.exit(1)
        return None
        
    #return None


</t>
<t tx="zoomq.20120727213305.14805">@APP.route('/grp/&lt;gid&gt;')
def grpsee(gid):
    ''' realy ACTION:
        - get obj. by g:id
    ,'crxs':[]      # 已发布的
    ,'trys':[]      # 待发布的
    ,'outs':[]      # 被下架的
    '''
    crgrp = KV.get(gid)
    #print "\t crgrp['baks']:", crgrp['baks']
    crxs = IDX4LIST(crgrp['crxs'], KV)
    trys = IDX4LIST(crgrp['trys'], KV)
    outs = IDX4LIST(crgrp['outs'], KV)
    baks = IDX4LIST(crgrp['baks'], KV)
    #print "\tcrxs,trys,outs\n\t", crxs, trys, outs
    return template('grp.html'
        , grp = crgrp
        , crxs = crxs
        , trys = trys
        , outs = outs
        , baks = baks
        )


    '''
    print "\tcrgrp.crxs/trys/outs\n\t", crgrp['crxs'], crgrp['trys'], crgrp['outs']
    cli = []
    for i in crgrp['trys']:
        if "g:" == i[:2]:
            print i
        else:
            cli.append(i)
    print "\tcli:", cli
    crgrp['trys'] = cli
    KV.set(gid, crgrp)
    '''
</t>
<t tx="zoomq.20120727213305.14806">@APP.route('/grp/&lt;gid&gt;/ed')
@auth_required()
def grped(gid):
    ''' realy ACTION:
        - get obj. by g:id
    '''
    #print gid
    #print INIobjSYS('grp')
    crgrp = KV.get(gid)
    #print crgrp
    return template('grped.html', grp = crgrp)


</t>
<t tx="zoomq.20120727213305.14807">@APP.route('/grp/&lt;gid&gt;/del')
def grpdel(gid):
    ''' realy ACTION:
        - set isdel == 1
        - remove g:id from CFG.K4D['grp']
    '''
    sysk, crgrps = INIobjSYS('grp')
    try:
        #print gid
        crgrp = KV.get(gid)
        #print crgrp
        crgrp['isdel'] = 1
        KV.set(gid, crgrp)
        crgrps.pop(crgrps.index(gid))
        KV.set(sysk, crgrps)    # VERY NEED
        #print KV.get(gid)
    except:
        # cancel reDel,
        print "&gt;&gt;&gt;/mana/grp/../del \n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    redirect("/mana/grps")
    #return "deleting %s"% tid


</t>
<t tx="zoomq.20120727213305.14808">@APP.route('/grp/&lt;gid&gt;/info', method='POST')
@auth_required()
def grpinfo(gid):
    ''' realy ACTION:
        - set obj. vars base g:id
    '''
    name = request.forms.get('name')
    desc = request.forms.get('desc', '...') #request.files.get('data')
    lead = request.forms.get('lead')
    weibo = request.forms.get('weibo')
    mail = request.forms.get('mail')
    #print name, desc
    #print INIobjSYS('grp')
    crgrp = KV.get(gid)
    crgrp['name'] = name.decode('utf-8')
    crgrp['desc'] = desc.decode('utf-8')
    crgrp['lead'] = lead.decode('utf-8')
    crgrp['weibo'] = weibo.decode('utf-8')
    crgrp['mail'] = mail
       
    KV.set(gid, crgrp)
    #print crgrp
    redirect("/mana/grp/%s"% gid)
    #return template('grp.html', grp=crgrp)


</t>
<t tx="zoomq.20120727213305.14817"></t>
<t tx="zoomq.20120727213305.14822">@language html
{% extends "base.html" %}

{% block title4act %}
GROUPs
    {% endblock title4act %}

{% block headJS %}
{% endblock%}

{% block mainbody %}
    {% if usrs is none %}
    {% else %}
            &lt;h1&gt;当前权限帐号s::&lt;/h1&gt;
                &lt;&lt;author li&gt;&gt;
&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
&lt;pre&gt;
当前只能通过 CLI 工具,远程进行维护
$ python lb4crx2cli.py 
Usage:
    $ lb4crx2cli.py usr[add|del|mod|chk] 用户名:口令:级别 http://XX.XX.XX
&lt;/pre&gt;
    {% endif %}

{% endblock mainbody %}

{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120727213305.14823">&lt;ul&gt;
{% for u in usrs %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;
{{ u.name }}
    &lt;sub&gt;
    level:{{ u.level }};
    isdel:{{ u.isdel }};
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120727213305.14835">@APP.route('/crxs')
@auth_required()
def crxs():
    ''' realy ACTION:
        - listing all crx with ctrl links
    '''
    k4crx, crcrxs = INIobjSYS('crx')
    k4try, crtrys = INIobjSYS('try')
    k4out, crouts = INIobjSYS('out')
    k4bak, crbaks = INIobjSYS('bak')
    k4arch, crxarch = INIobjSYS('arch')
    #print KV.get(k4crx)
    obj4crx = IDX4LIST(crcrxs, KV)
    obj4try = IDX4LIST(crtrys, KV)
    obj4out = IDX4LIST(crouts, KV)
    obj4bak = IDX4LIST(crbaks, KV)
    obj4arch = IDX4LIST(crxarch, KV)
    if obj4crx: print "\t obj4crx=", len(obj4crx)
    if obj4try: print "\t obj4try=", len(obj4try)
    if obj4out: print "\t obj4out=", len(obj4out)
    if obj4bak: print "\t obj4bak=", len(obj4bak)
    if obj4arch: print "\t obj4arch=", len(obj4arch)
    #print obj4crx
    return template('crxs.html'
        , obj4crx = obj4crx
        , obj4try = obj4try
        , obj4out = obj4out
        , obj4bak = obj4bak
        , obj4arch = obj4arch
        )


@others


</t>
<t tx="zoomq.20120727213305.14836">@APP.route('/crx/jsini')
def jsini():
    '''初始/升级 .js   realy ACTION:
        - 填写 UUID 
        - deepcopy(CFG.objCRX) set var with .crx
            - append uuid into CFG.K4D['uuid']
            - append uuid into CFG.K4D['try']
        - jump into /crx/x:id/info
    '''
    crcrx = {}
    k4tag, crtags = INIobjSYS('tag')
    k4grp, crgrps = INIobjSYS('grp')
    #print "\tk4grp, crgrps", k4grp, crgrps
    tags = IDX4LIST(crtags, KV)
    grps = IDX4LIST(crgrps, KV)
    print "\tgrps::", grps
    return template('ujsed.html'
        , crx = crcrx
        , tags = tags
        , grps = grps
        )
</t>
<t tx="zoomq.20120727213305.14837">@APP.route('/crx/&lt;uuid&gt;')
@auth_required()
def crxsee(uuid):
    '''realy ACTION:
        - get obj. by uuid
    '''
    #print uuid
    crcrx = KV.get(uuid)
    #print crcrx
    #print crcrx['name']
    incrx, intry, inout, inbak, inarch = ST4CRX(uuid)
    tags = crcrx['tagid']
    #print "\t crcrx['grpid']:", crcrx['grpid']
    tobjs = IDX4LIST(tags, KV)
    grp = crcrx['grpid']
    if grp:
        gobj = KV.get(grp)
    else:
        gobj = None
    #print "\t tags", tobjs
    return template('crx.html'
        , crx = crcrx 
        , incrx = incrx 
        , intry = intry 
        , inout = inout 
        , inbak = inbak
        , inarch = inarch 
        , tags = tobjs 
        , grp = gobj 
        )







</t>
<t tx="zoomq.20120727213305.14838">@APP.route('/crx/&lt;uuid&gt;/duplicate')
def crxduplicated(uuid):
    ''' realy ACTION:
        - get obj. by uuid
        - alert DUPLICATE ERROR 
    '''
    crcrx = KV.get(uuid)
    #print crcrx
    return template('crxduplicated.html', crx = crcrx)


</t>
<t tx="zoomq.20120727213305.14839">@APP.route('/crx/&lt;uuid&gt;/out', method='POST')
def crxout(uuid):
    ''' realy ACTION:
        - set ispub == 0
            - set all abt. KV append/remove uuid
            - see utility.KV4CRX
        - jump bak /mana/crxs
    '''
    try:
        #print uuid
        crcrx = KV.get(uuid)
        #print crcrx
        crcrx['ispub'] = 0
        KV.set(uuid, crcrx)
        # SYS idx.s fixed
        KV4CRX(uuid, 'out')
    except:
        # cancel reDel,
        print "&gt;&gt;&gt;/mana/crx/:uuid/out \n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    KV4GRP(uuid)
    redirect("/mana/pubs")
    #return "deleting %s"% tid


</t>
<t tx="zoomq.20120727213305.14840">@APP.route('/crx/&lt;uuid&gt;/info', method='POST')
@auth_required()
def crxinfo(uuid):
    ''' realy ACTION:
        - set obj. vars base uuid
         if upload pic:
            + put into Storage
            + create new objPIC KV
            + append sid into SYS:pics
            + append sid into crx.pic
        + binding TAG/GRP
    '''
    picfile = request.files.get('picture', None) #request.files.get('data')
    if picfile is not None:
        filename = picfile.filename
        raw = picfile.file.read() # This is dangerous for big files
        sid, uri, crcrx = PUT_PIC4CRX(raw, filename, uuid)
    else:
        crcrx = KV.get(uuid)
    name = request.forms.get('name')
    desc = request.forms.get('desc')
    detail = request.forms.get('detail')
    version = request.forms.get('version')
    isreco = request.forms.get('isreco', 'noreco')
    #print isreco
    dlrank = request.forms.get('dlrank')
    gsdl = request.forms.get('gsdl')
    gsusr = request.forms.get('gsusr')
    gsrank = request.forms.get('gsrank')
    
    tags = request.forms.getlist('tags')
    grp = request.forms.get('grp')
    print "\tgrp,tags:\n\t", grp,tags
    #return None
    
    @others
    
    redirect("/mana/crx/%s"% uuid)
    #tobjs = IDX4LIST(tags, KV)
    #gobj = KV.get(grp)
    
    '''
    return template('crx.html'
        , crx = crcrx 
        , tags = tobjs 
        , grp = gobj 
        )
    '''






</t>
<t tx="zoomq.20120727213305.14842">@APP.route('/pubs')
@auth_required()
def crxpubs():
    ''' realy ACTION:
        - list obj. from CFG.K4D['try']
    '''
    #print INIobjSYS('pub')
    sysk, crtpubs = INIobjSYS('try')
    if 0 == len(crtpubs):
        objcrxs = None
    else:
        objcrxs = []
        for xid in crtpubs:
            #print xid
            #print KV.get(xid)
            objcrxs.append(KV.get(xid))
    #print sysk, crtpubs
    #print objcrxs
    return template('crxpubs.html'
        , crxs4try=objcrxs
        )


</t>
<t tx="zoomq.20120727213305.14848">@language html
{% extends "base.html" %}
{% block title4act %}
CRXs
    {% endblock title4act %}
{% block headJS %}
    {% include 'validatious.html' %} 
{% endblock%}
{% block mainbody %}
    {% if obj4crx is none %}
        &lt;h1&gt;还未发布任何扩展s::&lt;/h1&gt;
        &lt;fieldset&gt;
        &lt;legend&gt;上传个,先;-)&lt;/legend&gt;
        &lt;&lt;1st CRX&gt;&gt;            
        &lt;/fieldset&gt;
            &lt;hr/&gt;
    {% else %}
        &lt;h1&gt;发布ed杰出扩展s::&lt;/h1&gt;
        &lt;fieldset&gt;
        &lt;legend&gt;追加;-}&lt;/legend&gt;
        &lt;&lt;1st CRX&gt;&gt;            
        &lt;/fieldset&gt;
            &lt;hr/&gt;
            &lt;&lt;CRX li&gt;&gt;
            &lt;hr/&gt;
    {% endif %}
    
    {% if obj4try is not none %}
        &lt;h1&gt;待发布扩展s::&lt;/h1&gt;
            &lt;&lt;CRX pub&gt;&gt;
    {% endif %}
    
    {% if obj4bak is not none %}
        &lt;h1&gt;己退回扩展s::&lt;/h1&gt;
            &lt;&lt;CRX bak&gt;&gt;
    {% endif %}
    
    {% if obj4out is not none %}
        &lt;h3&gt;已下架扩展s::&lt;/h3&gt;
            &lt;&lt;CRX out&gt;&gt;
    {% endif %}
    
    {% if obj4arch is not none %}
        &lt;h3&gt;已归档扩展s::&lt;/h3&gt;
            &lt;&lt;CRX arch&gt;&gt;
    {% endif %}
    
    
            
{% endblock mainbody %}

{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}
</t>
<t tx="zoomq.20120727213305.14849">&lt;table&gt;
&lt;tr&gt;&lt;td&gt;
&lt;form action="/mana/crx/ini" method="post"  
    enctype="multipart/form-data"
    id="inicrxform" name="inicrxform" class="validate"&gt;
.crx &lt;input type="file" name="crxfile" id="crxfile" 
    class="required"  title="扩展文件必选!"/&gt;
&lt;span id="reply_submit" class="btnw right"&gt;
    &lt;button type="submit" name="submit" class="action" &gt;就酱&lt;/button&gt;
&lt;/span&gt;
&lt;/form&gt;
&lt;/td&gt;&lt;td&gt;
&lt;b&gt;&lt;a href="/mana/crx/jsini"&gt;追加/升级 UserScript 进入&gt;&gt;&gt;&lt;/a&gt;&lt;/b&gt;
&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
</t>
<t tx="zoomq.20120727213305.14850">&lt;ul&gt;
{% for x in obj4crx %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;&lt;a href="/mana/crx/{{ x.uuid }}" title="{{ x.desc }}"&gt;{{ x.name }}&lt;/a&gt;
    &lt;sub&gt;
    &lt;&lt;zip info.s&gt;&gt;
    
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/out" &gt;下架&lt;/a&gt;
    &lt;/span&gt;
    
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/ed" &gt;增补&lt;/a&gt;
    &lt;/span&gt;
    
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120727213305.14851">&lt;ul&gt;
{% for x in obj4try %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;&lt;a href="/mana/crx/{{ x.uuid }}" title="{{ x.desc }}"&gt;{{ x.name }}&lt;/a&gt;
    &lt;sub&gt;
    &lt;&lt;zip info.s&gt;&gt;
    
    &lt;span id="pub_submit" class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/pub" &gt;上架&lt;/a&gt;
    &lt;/span&gt;
    &lt;span id="bak_submit" class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/bak" &gt;退回&lt;/a&gt;
    &lt;/span&gt;
    
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/ed" &gt;增补&lt;/a&gt;
    &lt;/span&gt;
    
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120727213305.14852">&lt;ul&gt;
{% for x in obj4out %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;&lt;a href="/mana/crx/{{ x.uuid }}" title="{{ x.desc }}"&gt;{{ x.name }}&lt;/a&gt;
    &lt;sub&gt;
    &lt;&lt;zip info.s&gt;&gt;
    
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/pub" &gt;上架&lt;/a&gt;
    &lt;/span&gt;
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/arch" &gt;归档&lt;/a&gt;
    &lt;/span&gt;
    
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/ed" &gt;增补&lt;/a&gt;
    &lt;/span&gt;
    
    
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120727213305.14854">@APP.route('/crx/&lt;uuid&gt;/pub', method='POST')
def crxpub(uuid):
    ''' realy ACTION:
        - set ispub == 1
            - set all abt. KV append/remove uuid
            - see utility.KV4CRX
        - jump bak /mana/crxs
    '''
    #name = request.forms.get('name')
    #desc = request.forms.get('desc', '...')
    reply = request.forms.get('reply', '...') 
    try:
        #print uuid
        crcrx = KV.get(uuid)
        #print crcrx
        crcrx['ispub'] = 1
        #crcrx['name'] = name.decode('utf-8')
        #crcrx['desc'] = desc.decode('utf-8')
        crcrx['reply'] = reply.decode('utf-8')
        KV.set(uuid, crcrx)
        # SYS idx.s fixed
        KV4CRX(uuid, 'pub')
    except:
        # cancel reDel,
        print "&gt;&gt;&gt;/mana/crx/:uuid/pub \n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    KV4GRP(uuid)
    redirect("/mana/pubs")
    #return "deleting %s"% tid


</t>
<t tx="zoomq.20120727213305.14856">@APP.route('/crx/&lt;uuid&gt;/bak', method='POST')
def crxbak(uuid):
    ''' realy ACTION:
        - set ispub == 0
            - set all abt. KV append/remove uuid
            - see utility.KV4CRX
        - jump bak /mana/crxs
    '''
    reply = request.forms.get('reply')
    try:
        crcrx = KV.get(uuid)
        crcrx['ispub'] = 0
        crcrx['reply'] = reply.decode('utf-8')
        KV.set(uuid, crcrx)
        # SYS idx.s fixed
        KV4CRX(uuid, 'bak')
    except:
        # cancel reDel,
        print "&gt;&gt;&gt;/mana/crx/:uuid/bak \n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    KV4GRP(uuid)
    redirect("/mana/pubs")
    #return "deleting %s"% tid


</t>
<t tx="zoomq.20120727213305.14859">@language html
{% extends "base.html" %}

{% block title4act %}
CRXs 待发布
    {% endblock title4act %}

{% block headJS %}
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
    {% if crxs4try is none %}
            &lt;h1&gt;还未有任何 扩展s 在等待,审核发布!&lt;/h1&gt;
            &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/mana/crxs" &gt;返回&lt;/a&gt;
&lt;/span&gt;

    {% else %}
                &lt;h1&gt;待发布扩展s::&lt;/h1&gt;
                    &lt;&lt;CRX pub&gt;&gt;

    {% endif %}
        
{% endblock mainbody %}


{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120727213305.14860">&lt;ul&gt;
{% for x in crxs4try %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;&lt;a href="/mana/crx/{{ x.uuid }}" title="{{ x.desc }}"&gt;{{ x.name }}&lt;/a&gt;
    &lt;sub&gt;
    &lt;sup&gt;v{{ x.version }}:{{ x.dlrank }} {{ x.uuid }}&lt;/sup&gt;
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/pub" &gt;上架&lt;/a&gt;
    &lt;/span&gt;
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/bak" &gt;退回&lt;/a&gt;
    &lt;/span&gt;
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120727213305.14862">&lt;span class="label"&gt;名称:&lt;/span&gt;
{{ crx['name'] }}
    &lt;br/&gt;

&lt;span class="label"&gt;描述:&lt;/span&gt;&lt;pre class="desc"&gt;
{{ crx.desc }}
&lt;/pre&gt;
    &lt;br/&gt;

&lt;span class="label"&gt;回执:&lt;/span&gt;
&lt;textarea name="reply" id="reply" 
    placeholder="填写为毛回退不给发布的理由,至少4字吼..."
    class="required min-length_4" title="扩展处置回执 必填!且长过4字!"
    rows="3" /&gt;{{ crx['reply'] }}&lt;/textarea&gt;
    &lt;br/&gt;

    &lt;br/&gt;
    &lt;br/&gt;
&lt;span id="kinds_submit" class="btnw"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/mana/crxs" &gt;返回&lt;/a&gt;
&lt;/span&gt;

    &lt;br/&gt;
&lt;i&gt;
id: {{ crx['id'] }} 
; uuid: {{ crx['uuid'] }} 
&lt;/i&gt;</t>
<t tx="zoomq.20120727213305.14864">@APP.route('/crx/&lt;uuid&gt;/try/&lt;act&gt;')
@auth_required()
def crxtry(uuid, act):
    ''' realy ACTION:
        - get obj. by uuid
        - exp. as page for confirmed
        - jump into page by ACT
    '''
    #print act
    crcrx = KV.get(uuid)
    #print crcrx
    return template('crxtry.html', crx = crcrx, jump = act)


</t>
<t tx="zoomq.20120727213305.3937">@language python
@tabwidth -4

mana/initea
    + teaminfo ~ up/:teamid
mana/upcrx
    + crxinfo</t>
<t tx="zoomq.20120802192540.5461">def MANIFEST4CRX(f):
    import zipfile
    z = zipfile.ZipFile()
    json = eval(z.open("manifest.json").read())
    #print json
    return json
    '''
    names = z.namelist()
    for name in names:
        print 'Processing %s' % name
        #print z.read(name)
    '''</t>
<t tx="zoomq.20120802192540.5463">def IDX4LIST(idx, KV):
    '''BASE idx list collection all Obj. into List
    '''
    #print "\tIDX4LIST(idx, KV):", idx
    #print "\t len(idx):", len(idx)
    if 0 == len(idx):
        return None
        
    exp = []
    for i in idx:
        exp.append(KV.get(i))
    if 0 == len(exp):
        return None
    else:
        return exp



</t>
<t tx="zoomq.20120802192540.5468">def GENID(obj,name=""):
    '''通用ID生成器:
        yymmddHHMMSS+5位微秒+对象鍵3位+全局序号
        e.g.
        x:12080110561431076CRX1111
    '''
    timestamp = TSTAMP()
    tot = INCR4KV()
    GOBJMAP = {'his':'h:%(date)s%(ms)sHIS%(tot)d'
        ,'crx':'x:%(timestamp)sCRX%(tot)d%(name)s'
        ,'pic':'p%(timestamp)sSAE%(tot)d%(name)s'
        ,'tag':'t:%(timestamp)sTAG%(tot)d%(name)s'
        ,'grp':'g:%(timestamp)sGRP%(tot)d%(name)s'
        ,'sae':'%(name)s_%(timestamp)sSAE%(tot)d'
        }
    if obj in GOBJMAP.keys():
        return GOBJMAP[obj]% locals()
    else:
        return None



</t>
<t tx="zoomq.20120802192540.7098">@APP.route('/crx/&lt;uuid&gt;/arch', method='POST')
def crxarch(uuid):
    ''' realy ACTION:
        - set ispub = 0 isdel = 1
            - set all abt. KV append/remove uuid
            - see utility.KV4CRX
        - jump bak /mana/crxs
    '''
    try:
        #print uuid
        crcrx = KV.get(uuid)
        #print crcrx
        crcrx['ispub'] = 0
        crcrx['isdel'] = 1
        KV.set(uuid, crcrx)
        # SYS idx.s fixed
        KV4CRX(uuid, 'arch')
    except:
        # cancel reDel,
        print "&gt;&gt;&gt;/mana/crx/:uuid/bak \n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    KV4GRP(uuid)
    redirect("/mana/pubs")
    #return "deleting %s"% tid


</t>
<t tx="zoomq.20120802192540.7100">def TSTAMP():
    '''通用时间戳生成器:
        yymmddHHMMSS+5位微秒
        e.g.
        12080110561431076
    '''
    date = strftime("%y%m%d%H%M%S", localtime())
    mms = "%.5f"% time()
    ms = mms[-5:]
    return "%s%s"% (date, ms)




</t>
<t tx="zoomq.20120802192540.8726">def PUTHIS(crobjs, act):
    '''put any obj. into SYS:his
        + copy obj. as new h:id KV
        + return h:id
    '''
    his = deepcopy(CFG.objHis)
    hid = GENID('his')
    his['id'] = hid
    his['hisobj'] = deepcopy(crobjs)
    his['hisact'] = act
    his['tstamp'] = TSTAMP()
    #   appended into KVDB
    KV.add(his['id'],his)
    #   collected into SYS:his
    k4his, crthis = INIobjSYS("his")
    INS2KV(hid, k4his, crthis)
    #print "\tSYS:his:", KV.get(k4his)
    return hid



</t>
<t tx="zoomq.20120802192540.8728">def INS2KV(xid, k4obj, crobjs):
    #k4obj, crobjs = INIobjSYS(sysk)
    try:
        if xid in crobjs:
            pass
        else:
            crobjs.append(xid)
            KV.set(k4obj, crobjs)
    except:
        print "&gt;&gt;&gt;INS2KV(xid, sysk)\n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    return True



</t>
<t tx="zoomq.20120804110957.4136">@APP.route('/crx/&lt;uuid&gt;/ed')
@auth_required()
def crxed(uuid):
    ''' realy ACTION:
        - get obj. by uuid
    '''
    crcrx = KV.get(uuid)
    pp.pprint(crcrx)
    print "\tcrcrx.grpid", crcrx['grpid']
    k4tag, crtags = INIobjSYS('tag')
    k4grp, crgrps = INIobjSYS('grp')
    #print "\tk4grp, crgrps", k4grp, crgrps
    tags = IDX4LIST(crtags, KV)
    grps = IDX4LIST(crgrps, KV)
    print "\tgrps::", grps
    return template('crxed.html'
        , crx = crcrx
        , tags = tags
        , grps = grps
        )


</t>
<t tx="zoomq.20120804110957.4139">@language html
{% extends "base.html" %}
{% block title4act %}
CRXed.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展附图, 编辑&lt;/legend&gt;
&lt;form action="/mana/crx/{{ uuid }}/pic/{{ sid }}/see" method="post"
    class="validate"&gt;

@others

&lt;/form&gt;

&lt;i&gt;
uri: {{ ssuri }}
&lt;/i&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120804110957.4140">
&lt;span id="reply_submit" class="btnw"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/mana/crx/{{ uuid }}" &gt;返回&lt;/a&gt;
&lt;/span&gt;
    &lt;br/&gt;


</t>
<t tx="zoomq.20120804110957.4142">&lt;span class="label"&gt;名称:&lt;/span&gt;{{ crx['name'] }}
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;{{ crx['desc'] }}
&lt;/label&gt;
    &lt;br/&gt;
&lt;span class="label"&gt;版本:&lt;/span&gt; 
    依然是&lt;b class="alert"&gt; {{ crx['version'] }} &lt;/b&gt;?!
    &lt;br/&gt;
    
    &lt;br/&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/mana/crxs" &gt;返回再试&lt;/a&gt;
&lt;/span&gt;

    &lt;br/&gt;
&lt;i&gt;
id: {{ crx['id'] }} 
; uuid: {{ crx['uuid'] }} 
; ispub: {{ crx['ispub'] }} 
; isdel: {{ crx['isdel'] }} 
&lt;/i&gt;</t>
<t tx="zoomq.20120804110957.4144">def POP4KV(xid, k4obj, crobjs):
    try:
        #k4obj, crobjs = INIobjSYS(sysk)
        if xid in crobjs:
            crobjs.pop(crobjs.index(xid))
            KV.set(k4obj, crobjs)
        else:
            pass
    except:
        print "&gt;&gt;&gt;POP2KV(xid, sysk)\n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    return True



</t>
<t tx="zoomq.20120804110957.4146">def PUT2SS(raw, fname, actype):
    '''put file into SAE.storage
        + return s:id
    '''
    if 'sae' == actype:
        sid = "%s.crx"% GENID('sae', fname)
        domain = CFG.D2X
    elif 'pic' == actype:
        sid = "%s.%s"% (GENID('pic'), fname.split(".")[-1])
        domain = CFG.D2P
    elif 'html' == actype:
        sid = "%s.html"% fname
        domain = CFG.D4P
        
    #print "\n PUT2SS:", sid
    #   初始化一个Storage客户端。
    ss = sae.storage.Client()
    ob = sae.storage.Object(raw)
    ss.put(domain, sid, ob)
    uri = ss.url(domain, sid)
    return sid, uri



</t>
<t tx="zoomq.20120804110957.4147">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ by 42qu.com 
input,button,select,textarea{font-size:16px;line-height:28px}

*/
input,button,select,textarea{
    font-size:14px;line-height:28px
}
div{cursor:default}

input{  
    font-size:22px;
    line-height:36px;
    height:42px;
    padding:4px 3px;
    border:1px solid #ddd;
    width:27em;
}
input.checkbox{
    font-size:22px;
    line-height:24px;
    height:24px;
    width:auto;

}  

#optradios input{
    font-size:18px;line-height:22px;height:26px;
    padding:0px;
    border:1px solid #ddd;
    width:1em;
}
    
select{
    font-size:16px;line-height:18px;
    padding:8px;
    text-align:center;border:1px solid #ccc;
    margin-right:8px;
    width:120px;
}

textarea{
    font-size:22px;
    overflow:auto;resize:none;
    border:1px solid #ccc;
    padding:4px 3px;
    margin:0;
    width:27em;
}
</t>
<t tx="zoomq.20120804110957.4148">ul li {font-size:120%;
    line-height: 36px;
    border-top:1px dotted #aaa;
    width:98%;
    list-style-type:none;
    padding: 5px 0px 0px 10px;
}
ul li.textarea3 {
    height: 108px;
    border: 0px dotted #930;
}
ul li.textarea1 {
    height: 50px;
    border: 0px dotted #930;
}
.even{
    background: #FFF4DB;
}
ul.asform li{
    display:inline-block; 
    vertical-align:top; 
    border-top:0px dotted #aaa;
}
.leftlabel{
    float: left;
}
.rightinput{
    float: right;
}
span.label{
    display:inline-block; 
    border: 1px solid #777;
    width:7em;
    padding: 5px;
    text-align:right;
}

ol li {font-size:120%;
    line-height: 24px;
    border-bottom:1px dotted #aaa;
    width:90%;
    list-style-type:none;
    margin-left: 20px;
}

sub,sup {font-size:10px; }
fieldset sub{
    color:#999;
}


fieldset{
    margin-top: 10px;
    padding: 20px;
    border-radius: 0px 15px 0px 15px;
    box-shadow: 3px 3px 4px #ddd;
}
fieldset i{
    font-size: 70%;
    color: #787;
    margin-top: 10px;
    line-height:36px;
}

</t>
<t tx="zoomq.20120804110957.4149">b.alert{
    font-size: 150%;
    color: #930;
}


pre {
    font-weight：lighter;
    font-size: 80%;
    border: 4px dotted #fefefe;
    background : #ededed;
    padding: 5px;
    border-radius: 0px 15px 0px 15px;
    box-shadow: 3px 3px 4px #ddd;
}

pre.desc {
    font-size: 14px;
    border: 2px dotted #ddd;
    background : #fefefe;
    padding: 10px;
    border-radius: 15px 0px 15px 0px;
    width:70%;
    display:inline-block;
}
</t>
<t tx="zoomq.20120804110957.4151">&lt;ul&gt;
{% for x in obj4arch %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;&lt;a href="/mana/crx/{{ x.uuid }}" title="{{ x.desc }}"&gt;{{ x.name }}&lt;/a&gt;
    &lt;sub&gt;
    &lt;&lt;zip info.s&gt;&gt;
    
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/recover" &gt;回收&lt;/a&gt;
    &lt;/span&gt;
    
    
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120804110957.4153">@APP.route('/crx/&lt;uuid&gt;/recover', method='POST')
def crxrecover(uuid):
    ''' realy ACTION:
        - set ispub = 0 isdel = 0
            - set all abt. KV append/remove uuid
            - see utility.KV4CRX
        - jump bak /mana/crxs
    '''
    try:
        #print uuid
        crcrx = KV.get(uuid)
        #print crcrx
        crcrx['ispub'] = 0
        crcrx['isdel'] = 0
        KV.set(uuid, crcrx)
        # SYS idx.s fixed
        KV4CRX(uuid, 'recover')
    except:
        # cancel reDel,
        print "&gt;&gt;&gt;/mana/crx/:uuid/bak \n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    KV4GRP(uuid)
    redirect("/mana/pubs")
    #return "deleting %s"% tid


</t>
<t tx="zoomq.20120804110957.4478">def ST4CRX(uuid):
    '''.crx 目前状态 统一检测器:
        - 从系统扩展状态索引系列列表中
        - 抽取出当前扩展的状态,返回为一组状态值
      act\KV|crx try out bak arch api4cx 
        待发  0   1   0   0    0   0       
        回退  0   0   0   1    0   0   
        上架  1   0   0   0    0   1   
        下架  0   0   1   0    0   0   
        归档  0   0   0   0    1   0   
        回收  0   1   0   0    0   0   
    '''
    #print uuid
    #KV = sae.kvdb.KVClient()
    k4crx, crcrxs = INIobjSYS('crx')
    k4try, crtrys = INIobjSYS('try')
    k4out, crouts = INIobjSYS('out')
    k4bak, crbaks = INIobjSYS('bak')
    k4arc, crarch = INIobjSYS('arch')
    incrx = (uuid in crcrxs)
    intry = (uuid in crtrys)
    inout = (uuid in crouts)
    inbak = (uuid in crbaks)
    inarch = (uuid in crarch)
    #print "\t in SYS:crx? %s"% incrx
    #print "\t in SYS:try? %s"% intry
    #print "\t in SYS:out? %s"% inout
    #print "\t in SYS:arch? %s"% inarch
    
    return incrx, intry, inout, inbak, inarch



</t>
<t tx="zoomq.20120804110957.4480">&lt;span class="btnw right"&gt;
    &lt;a href="/mana/crx/{{ crx.uuid }}/ed" &gt;编辑&lt;/a&gt;
&lt;/span&gt;
&lt;!--
        - 对扩展的所有状态对应的组合映射到一批列表中
    status\KV|crx try out arch api4cx 
        待发  0   1   0   0    0       
        架上  1   0   0   0    1       
        下架  0   0   1   0    0       
        归档  0   0   0   1    0       
{{ incrx, intry, inout, inarch }}
--&gt;
{% if inarch %}
    &lt;span class="btnw right"&gt;
        &lt;a href="/mana/crx/{{ crx.uuid }}/try/recover" &gt;回收&lt;/a&gt;
    &lt;/span&gt;
{% else %}
    {% if incrx %}
        &lt;span id="out_submit" class="btnw right"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/try/out" &gt;下架&lt;/a&gt;
        &lt;/span&gt;
    {% elif intry %}
        &lt;span id="bak_submit" class="btnw right"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/try/bak" &gt;退回&lt;/a&gt;
        &lt;/span&gt;
        &lt;span id="pub_submit" class="btnw right"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/try/pub" &gt;上架&lt;/a&gt;
        &lt;/span&gt;
    {% elif inout %}
        &lt;span id="pub_submit" class="btnw right"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/try/pub" &gt;上架&lt;/a&gt;
        &lt;/span&gt;
    {% endif %}
    
    &lt;span id="bak_submit" class="btnw right"&gt;
        &lt;a href="/mana/crx/{{ crx.uuid }}/try/arch" &gt;归档&lt;/a&gt;
    &lt;/span&gt;
{% endif %}
    
    
    
&lt;span id="back_submit" class="btnw right"&gt;
    &lt;a href="/mana/crxs" &gt;返回总表&lt;/a&gt;
&lt;/span&gt;

    &lt;br/&gt;
&lt;i&gt;
&lt;/i&gt;


</t>
<t tx="zoomq.20120804110957.4482">@APP.route('/')
@auth_required()
def mana():
    return template('mana.html')
    





</t>
<t tx="zoomq.20120804110957.4483">&lt;fieldset&gt;
    &lt;legend&gt;配图::&lt;/legend&gt;

    &lt;ul&gt;
    {% for pid in crx.pic %}
    &lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;
    &lt;img src="{{ sspath4pic }}/{{ pid }}"/&gt;

    &lt;sub&gt;
    {% if pid == crx.icon %}
    &lt;b class="alert"&gt;icon&lt;/b&gt;
    {% endif %}
    
        &lt;span class="btnwa"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/pic/{{ pid }}/ed"&gt;调整&lt;/a&gt;
        &lt;/span&gt;    
    
        &lt;span class="btnwa"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/pic/{{ pid }}/del"&gt;删除&lt;/a&gt;
        &lt;/span&gt;
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;

&lt;/fieldset&gt;



</t>
<t tx="zoomq.20120804110957.4485">def POP4LIST(cnt, listobj):
    '''try safty pop SOMETHING from list
    '''
    try:
        idxcnt = listobj.index(cnt)
    except:
        print "&gt;&gt;&gt;POP4LIST(cnt, listobj)\n\t", traceback.print_exc()
        #sys.exit(1)
        return None
    listobj.pop(idxcnt)
    return True






</t>
<t tx="zoomq.20120804110957.4487">@APP.route('/crx/&lt;uuid&gt;/pic/&lt;sid&gt;/ed')
@auth_required()
def edpic(uuid, sid):
    '''edit. crx's pic:
        + get info. byr sid
    '''
    #print uuid, sid
    crtpic = KV.get(sid)
    #print crtpic
    ss = sae.storage.Client()
    ssuri = ss.url(CFG.D2P, sid)
    #return None
    return template('crxpic.html'
        , uuid = uuid 
        , sid = sid
        , pic = crtpic
        , ssuri =ssuri
        )

    





</t>
<t tx="zoomq.20120804110957.4489">def PUT_PIC4CRX(raw, fname, uuid):
    '''put pic into SAE.storage, REALY doing:
            + put into Storage
            + create new objPIC KV
            + append sid into SYS:pics
            + append sid into crx.pic
    #filename = picfile.filename
    if picfile is not None:
        raw = picfile.file.read() # This is dangerous for big files
        sid, uri = PUT2SS(raw, filename, 'pic')
        print uri
        picfile.file.close()
    '''
    sid, uri = PUT2SS(raw, fname, 'pic')
    #   + create new objPIC KV
    pic = deepcopy(CFG.objPIC)
    pic['note'] = sid
    KV.add(sid, pic)
    #   + append sid into SYS:pics
    #INS2KV(sid, k4pic, crpicss)
    k4pic, crpics = INIobjSYS('pic')
    crpics.append(sid)
    KV.set(k4pic, crpics)
    #print k4pic, crpics
    #   + append sid into crx.pic
    crcrx = KV.get(uuid)
    #   fixed 有可能的重复插入?
    crcrx['pic'].append(sid)
    crcrx['pic'] = list(set(crcrx['pic']))
    #KV.set(xid, crcrx)
    
    return sid, uri, crcrx



</t>
<t tx="zoomq.20120804110957.4492">@language html
{% extends "base.html" %}
{% block title4act %}
CRXed.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;杰出扩展, 编辑&lt;/legend&gt;
&lt;form action="/mana/crx/{{ crx.uuid }}/info" method="post"
    enctype="multipart/form-data" class="validate"&gt;
@others
&lt;/form&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120804110957.4493">
&lt;&lt;操作按钮&gt;&gt;
&lt;br/&gt;&lt;hr/&gt;
&lt;ul class="asform"&gt;
&lt;&lt;详情&gt;&gt;
&lt;&lt;标签选列&gt;&gt;
&lt;&lt;团队选列&gt;&gt;
&lt;/ul&gt;
&lt;br/&gt;&lt;hr/&gt;
&lt;&lt;操作按钮&gt;&gt;
    


    &lt;br/&gt;
&lt;i&gt;
id: {{ crx['id'] }} 
; uuid: {{ crx['uuid'] }} 
; {{ crx.name }}
&lt;/i&gt;


</t>
<t tx="zoomq.20120804110957.4495">@APP.route('/crx/&lt;uuid&gt;/pic/&lt;sid&gt;/see', method='POST')
def seepic(uuid, sid):
    '''confirmed crx pic's editor:
        + get info. byr sid
    '''
    note = request.forms.get('note', '...')
    icon = request.forms.get('icon', 'noicon')
    #print icon
    crtcrx = KV.get(uuid)
    crtpic = KV.get(sid)
    crtpic['note'] = note.decode('utf-8')
    if "icon"==icon:
        crtpic['icon'] = 1
        crtcrx['icon'] = sid
    else:
        crtpic['icon'] = 0
        crtcrx['icon'] = None
    KV.set(sid, crtpic)
    
    #return None
    return template('seepic.html'
        , uuid = uuid 
        , sid = sid 
        , pic = crtpic
        )

    





</t>
<t tx="zoomq.20120804110957.4498">@language html
{% extends "base.html" %}
{% block title4act %}
CRXed.
    {% endblock title4act %}
{% block headJS %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展附图, 信息&lt;/legend&gt;
@others
&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120804110957.4499">
&lt;span id="reply_submit" class="btnw"&gt;
    &lt;a href="/mana/crx/{{ uuid }}" &gt;就酱&lt;/a&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/mana/crx/{{ uuid }}/pic/{{ sid }}/ed" &gt;返回&lt;/a&gt;
&lt;/span&gt;
    &lt;br/&gt;
&lt;i&gt;

&lt;/i&gt;


</t>
<t tx="zoomq.20120804110957.4500">&lt;li class=""&gt;
&lt;span class="label"&gt;标签:&lt;/span&gt;
{% for t in tags %}

&lt;input type="checkbox" class="checkbox"
    name="tags" id="tags" 
     {% if t.id in crx.tagid %}
    checked
     {% endif %}
    value="{{ t.id }}"/&gt;
    &lt;label for="{{ t.id }}"&gt;{{ t.name }}&lt;/label&gt;

{% endfor %}

&lt;/li&gt;
</t>
<t tx="zoomq.20120804110957.4502">&lt;li class=""&gt;
&lt;span class="label"&gt;团队:&lt;/span&gt;
{% for g in grps %}

&lt;input type="radio" class="checkbox"
    name="grp" id="grp"
     {% if crx.grpid is not none %}
         {% if g.id == crx.grpid %}
        checked
         {% endif %}
    {% endif %}
    value="{{ g.id }}"/&gt;
    &lt;label for="{{ g.id }}"&gt;{{ g.name }}&lt;/label&gt;

{% endfor %}

&lt;/li&gt;
</t>
<t tx="zoomq.20120805183037.15010">@APP.route('/gen')
@auth_required()
def genall():
    '''gen all can gen pages:
        - dict of pages idx:
            + tag include pages
            + all pages uri
        tags={
            tid:{TAG's norm. dict data
                + "pub":{
                    xid:{CRX's norm. dict data}
                    ,,,}
                ,,,}
            ,,,}
    '''
    k4tags, crttags = INIobjSYS('tag')
    k4pubs, crtpubs = INIobjSYS('crx')
    #print crttags
    tags = []
    for tag in crttags:
        crxtag = KV.get(tag)
        crxtag['pub'] = []
        for xid in crxtag['crxs']:
            if xid in crtpubs:
                crxtag['pub'].append(KV.get(xid))
            else:
                #print KV.get(xid)['ispub']
                pass
        tags.append(crxtag)
    '''
    for k in tags.keys():
        print tags[k]['pub'].keys()
    '''
    return template('gen.html'
        , tags = tags
        )
    





</t>
<t tx="zoomq.20120805183037.15012">@language html
{% extends "base.html" %}

{% block title4act %}
Mana.
{% endblock %}

{% block mainbody %}
    &lt;h1&gt;猎豹扩展商店后台:管理(Bottle版) &lt;/h1&gt;
    
    &lt;h2&gt;管理扩展&lt;/h2&gt;
    &lt;ol&gt;
    &lt;li&gt;&lt;a href="/mana/pubs"&gt;审发扩展&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="/mana/crxs"&gt;扩展维护&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="/mana/tags"&gt;编辑标签&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="/mana/grps"&gt;团队维护&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="/mana/usrs"&gt;帐户列表&lt;/a&gt;&lt;/li&gt;
    &lt;/ol&gt;

    &lt;h2&gt;商店管理&lt;/h2&gt;
    
    &lt;ol&gt;
    &lt;li&gt;
    &lt;a href="/mana/gen"&gt;页面生成&lt;/a&gt;&lt;/li&gt;
    &lt;/ol&gt;
    &lt;br/&gt;
    &lt;a href="/mana/st"&gt;商店状态&lt;/a&gt;
    

    &lt;h2&gt;推荐管理&lt;/h2&gt;
    &lt;a href="/mana/reco"&gt;推荐维护&lt;/a&gt;
    
    

{% endblock %}

{% block footernav %}
{% include 'manav.html' %} 
{% endblock %}</t>
<t tx="zoomq.20120805183037.4183">crcrx['name'] = name.decode('utf-8')
crcrx['desc'] = desc.decode('utf-8')
crcrx['detail'] = detail.decode('utf-8')
crcrx['version'] = version
if "isreco"==isreco:
    crcrx['isreco'] = 1
else:
    crcrx['isreco'] = 0
crcrx['dlrank'] = dlrank
crcrx['gsdl'] = gsdl
crcrx['gsusr'] = gsusr
crcrx['gsrank'] = gsrank

crcrx['tagid'] = tags
crcrx['grpid'] = grp
KV.set(uuid, crcrx)
</t>
<t tx="zoomq.20120805183037.4184">if tags:
    for t in tags:
        tag = KV.get(t)
        tag['crxs'] = INS2LIST(uuid, tag['crxs'])
        KV.set(t, tag)
    </t>
<t tx="zoomq.20120805183037.4185">if grp:
    grpcrxs, grptrys, grpouts, grpbaks = KV4GRP(uuid)
    '''
    crtgrp = KV.get(grp)
    incrx, intry, inout, inarch = ST4CRX(uuid)
    #crtgrp['']
    if incrx:
        #crtgrp['crxs'] = grp
        crtgrp['crxs'] = INS2LIST(uuid, crtgrp['crxs'])
        POP4LIST(uuid, crtgrp['trys'])
        POP4LIST(uuid, crtgrp['outs'])
    elif intry:
        POP4LIST(uuid, crtgrp['crxs'])
        crtgrp['trys'] = INS2LIST(uuid, crtgrp['trys'])
        POP4LIST(uuid, crtgrp['outs'])
    elif inout:
        POP4LIST(uuid, crtgrp['crxs'])
        POP4LIST(uuid, crtgrp['trys'])
        crtgrp['outs'] = INS2LIST(uuid, crtgrp['outs'])
    elif incrx:
        POP4LIST(uuid, crtgrp['crxs'])
        POP4LIST(uuid, crtgrp['crxs'])
        POP4LIST(uuid, crtgrp['outs'])
    KV.set(grp, crtgrp)
    '''
</t>
<t tx="zoomq.20120805183037.4187">def INS2LIST(cnt, listobj):
    '''try safty insert SOMETHING to list
    '''
    #print "\t&gt;&gt;&gt;", cnt, listobj
    listobj.append(cnt)
    return list(set(listobj)) # 防止意外重复



</t>
<t tx="zoomq.20120805183037.4190">&lt;span class="label"&gt;名称:&lt;/span&gt;{{ tag['name'] }}
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;{{ tag['desc'] }}
    &lt;br/&gt;
</t>
<t tx="zoomq.20120805183037.4191">{% if crxs is not none %}
&lt;span class="label"&gt;包含.crx:&lt;/span&gt;
{% for crx in crxs %}
    &lt;a href="/mana/crx/{{ crx.uuid }}"&gt;{{ crx.name }}&lt;/a&gt; ; 
{% endfor %}
    &lt;br/&gt;
{% endif %}
</t>
<t tx="zoomq.20120805183037.4193">def KV4GRP(uuid):
    '''.crx 状态对应 团队拥有 .crx 状态切换器:
        - 对扩展的所有状态对应的组合映射到一批列表中
      act\KV|crxs trys outs baks
        新增  0    1    0    0
        回退  0    0    0    1
        上架  1    0    0    0
        下架  0    0    1    0
        归档  0    0    0    0
        回收  0    1    0    0
    '''
    #print uuid
    grpid = KV.get(uuid)['grpid']
    if grpid:
        &lt;&lt;set crc grp 相关值列表&gt;&gt;
        return crtgrp['crxs'], crtgrp['trys'], crtgrp['outs'], crtgrp['baks']
    else:
        # grpid 为 None 时
        return None, None, None, None

    


</t>
<t tx="zoomq.20120805183037.4195">@APP.route('/&lt;gid&gt;')
@auth_required()
def grpsee(gid):
    ''' realy ACTION:
        - get obj. by g:id
    ,'crxs':[]      # 已发布的
    ,'trys':[]      # 待发布的
    ,'outs':[]      # 被下架的
    '''
    crgrp = KV.get(gid)
    crxs = IDX4LIST(crgrp['crxs'], KV)
    trys = IDX4LIST(crgrp['trys'], KV)
    outs = IDX4LIST(crgrp['outs'], KV)
    baks = IDX4LIST(crgrp['baks'], KV)
    print "\t crxs ", crxs
    print "\t trys ", trys
    print "\t outs ", outs
    print "\t baks ", baks
    
    return template('upgrp.html'
        , grp = crgrp
        , crxs = crxs
        , trys = trys
        , outs = outs
        , baks = baks
        , gid = gid
        )

    #print crgrp['name']
    '''
    print "\tcrgrp.crxs/trys/outs\n\t", crgrp['crxs'], crgrp['trys'], crgrp['outs']
    cli = []
    for i in crgrp['trys']:
        if "g:" == i[:2]:
            print i
        else:
            cli.append(i)
    print "\tcli:", cli
    crgrp['trys'] = cli
    KV.set(gid, crgrp)
    '''




</t>
<t tx="zoomq.20120805183037.4197">@APP.route('/&lt;gid&gt;/crx/&lt;uuid&gt;/ed')
@auth_required()
def crxed(gid, uuid):
    ''' realy ACTION:
        - get obj. by uuid
    '''
    crcrx = KV.get(uuid)
    k4tag, crtags = INIobjSYS('tag')
    tags = IDX4LIST(crtags, KV)
    #print tags, grps
    return template('upcrxed.html'
        , crx = crcrx
        , tags = tags
        , gid = gid
        , uuid = uuid
        )



</t>
<t tx="zoomq.20120805183037.4202">@language html
{% extends "base.html" %}
{% block title4act %}
GROUPinfo. ed.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;原创团队, 信息编辑&lt;/legend&gt;
&lt;form action="/up/{{ grp.id }}/info" method="post" class="validate"&gt;

    &lt;&lt;团队信息&gt;&gt;
    &lt;&lt;操作指引&gt;&gt;
    &lt;label&gt;
    &lt;/label&gt;

&lt;/form&gt;

&lt;/fieldset&gt;

    &lt;br/&gt;
&lt;i&gt;
id: {{ grp['id'] }} 
;order: {{ grp['order'] }} 
&lt;/i&gt;
{% endblock mainbody %}



{% block footernav %}
&lt;b&gt;[导航]&lt;/b&gt;&lt;a href="/up/{{ gid }}"&gt;首页&lt;/a&gt;
    {% endblock footernav %}

</t>
<t tx="zoomq.20120805183037.4203">&lt;span class="label"&gt;名称:&lt;/span&gt;
&lt;input type="text" name="name" id="name" value="{{ grp['name'] }} "
    class="required min-length_4" title="团队 名称必填!且长过4字!"/&gt;
&lt;br/&gt;    

&lt;span class="label"&gt;描述:&lt;/span&gt;
&lt;textarea name="desc" id="desc" 
    class="required min-length_13" title="团队 描述必填!且长过13字!"
    rows="3" /&gt;{{ grp['desc'] }}&lt;/textarea&gt;
&lt;br/&gt;    
</t>
<t tx="zoomq.20120805183037.4205">

&lt;span id="reply_submit" class="btnw"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;
</t>
<t tx="zoomq.20120805183037.4207">@APP.route('/&lt;gid&gt;/ed')
@auth_required()
def grped(gid):
    ''' realy ACTION:
        - get obj. by g:id
    '''
    crgrp = KV.get(gid)
    return template('upgrped.html'
        , grp = crgrp
        , gid = gid
        )




</t>
<t tx="zoomq.20120805183037.4212">@language html
{% extends "base.html" %}
{% block title4act %}
GROUPinfo.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}

&lt;h1&gt;不合适的访问!&lt;/h1&gt;

&lt;b class="alert"&gt;
每个团队进入后台是有唯一编号的!
&lt;/b&gt;
请咨询管理员大妈!

&lt;pre&gt;
zoomquiet+lb4crx2srv # gmail.com
&lt;/pre&gt;
{% endblock mainbody %}

{% block footernav %}
    {% endblock footernav %}

</t>
<t tx="zoomq.20120805183037.4217">@APP.route('/&lt;gid&gt;/info', method='POST')
def grpinfo(gid):
    ''' realy ACTION:
        - get values by POST, and set all into. by g:id
    '''
    name = request.forms.get('name')
    desc = request.forms.get('desc', '...') #request.files.get('data')
    crgrp = KV.get(gid)
    crgrp['name'] = name.decode('utf-8')
    crgrp['desc'] = desc.decode('utf-8')
    KV.set(gid, crgrp)
    redirect("/up/%s"% gid)
    
    '''
    crxs = IDX4LIST(crgrp['crxs'], KV)
    trys = IDX4LIST(crgrp['trys'], KV)
    outs = IDX4LIST(crgrp['outs'], KV)
    return template('upgrp.html'
        , grp = crgrp
        , crxs = crxs
        , trys = trys
        , outs = outs
        , gid = gid
        )
    '''



</t>
<t tx="zoomq.20120805183037.4222">@language html
{% extends "base.html" %}
{% block title4act %}
CRXinfo.
    {% endblock title4act %}
{% block headJS %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展详情::&lt;/legend&gt;
&lt;&lt;详情展示&gt;&gt;
&lt;&lt;操作按钮&gt;&gt;

    &lt;hr/&gt;
&lt;span class="label"&gt;前次退回评注:&lt;/span&gt;&lt;pre class="desc"&gt;
{{ crx.reply }}
&lt;/pre&gt;
    &lt;br/&gt;
    
&lt;&lt;配图&gt;&gt;

    &lt;br/&gt;
&lt;i&gt;
id: {{ crx['id'] }} 
; uuid: {{ crx['uuid'] }} 
; ispub: {{ crx['ispub'] }} 
; isdel: {{ crx['isdel'] }} 
&lt;/i&gt;

&lt;/fieldset&gt;

{% endblock mainbody %}

{% block footernav %}
&lt;b&gt;[导航]&lt;/b&gt;&lt;a href="/up/{{ gid }}"&gt;首页&lt;/a&gt;
    {% endblock footernav %}

</t>
<t tx="zoomq.20120805183037.4223">&lt;span class="label"&gt;名称:&lt;/span&gt;{{ crx.name }}
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;&lt;pre class="desc"&gt;
{{ crx.desc }}
&lt;/pre&gt;
    &lt;br/&gt;
&lt;span class="label"&gt;版本:&lt;/span&gt;{{ crx.version }}
    &lt;br/&gt;

&lt;span class="label"&gt;标签:&lt;/span&gt;
{% if tags is not none %}
    {% for t in tags %}
        {{ t.name }} ; 
    {% endfor %}
{% else %}
    &lt;b class="alert"&gt;未绑定!&lt;/b&gt;
{% endif %}
    &lt;br/&gt;

{% if grp is defined %}
&lt;!--
&lt;span class="label"&gt;团队:&lt;/span&gt;
    &lt;a href="/mana/grp/{{ grp.id }}"&gt;{{ grp.name }}&lt;/a&gt; ;
    &lt;br/&gt;
--&gt;
{% endif %}

&lt;span class="label"&gt;下载:&lt;/span&gt;
&lt;a href="{{ sspath4crx }}/{{ crx.sid }}"&gt;
{{ crx.sid }}
&lt;/a&gt;
    &lt;br/&gt;
&lt;label&gt;
&lt;/label&gt;




</t>
<t tx="zoomq.20120805183037.4224">&lt;fieldset&gt;
    &lt;legend&gt;配图::&lt;/legend&gt;

    &lt;ul&gt;
    {% for pid in crx.pic %}
    &lt;li id="iterm"&gt;
    &lt;img src="{{ sspath4pic }}/{{ pid }}"/&gt;

    &lt;sub&gt;
        &lt;span class="btnwa"&gt;
            &lt;a href="/up/{{ gid }}/crx/{{ crx.uuid }}/pic/{{ pid }}/ed"&gt;调整&lt;/a&gt;
        &lt;/span&gt;    
    
        &lt;span class="btnwa"&gt;
            &lt;a href="/up/{{ gid }}/crx/{{ crx.uuid }}/pic/{{ pid }}/del"&gt;删除&lt;/a&gt;
        &lt;/span&gt;
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;

&lt;/fieldset&gt;

</t>
<t tx="zoomq.20120805183037.4225">    &lt;br/&gt;
&lt;span class="btnw"&gt;
    &lt;a href="/up/{{ gid }}/crx/{{ crx.uuid }}/ed" &gt;编辑&lt;/a&gt;
&lt;/span&gt;
&lt;!--
        - 对扩展的所有状态对应的组合映射到一批列表中
    status\KV|crx try out arch api4cx 
        待发  0   1   0   0    0       
        架上  1   0   0   0    1       
        下架  0   0   1   0    0       
        归档  0   0   0   1    0       
{{ incrx, intry, inout, inarch }}
{% if inarch %}
    &lt;span class="btnw"&gt;
        &lt;a href="/mana/crx/{{ crx.uuid }}/try/recover" &gt;回收&lt;/a&gt;
    &lt;/span&gt;
{% else %}
--&gt;
    {% if incrx %}
    &lt;!--
        &lt;span id="out_submit" class="btnw"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/try/out" &gt;下架&lt;/a&gt;
        &lt;/span&gt;
    --&gt;
    {% elif intry %}
    &lt;!--
        &lt;span id="bak_submit" class="btnw"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/try/bak" &gt;退回&lt;/a&gt;
        &lt;/span&gt;
    --&gt;
        &lt;span id="pub_submit" class="btnw"&gt;
            &lt;a href="/up/{{ gid }}/crx/{{ crx.uuid }}/pub" &gt;请求上架&lt;/a&gt;
        &lt;/span&gt;
    {% elif inbak %}
        &lt;span id="pub_submit" class="btnw"&gt;
            &lt;a href="/up/{{ gid }}/crx/{{ crx.uuid }}/pub" &gt;再次上架&lt;/a&gt;
        &lt;/span&gt;
    {% elif inout %}
    &lt;!--
        &lt;span id="pub_submit" class="btnw"&gt;
            &lt;a href="/mana/crx/{{ crx.uuid }}/try/pub" &gt;上架&lt;/a&gt;
        &lt;/span&gt;
    --&gt;
    {% else %}
        &lt;span id="pub_submit" class="btnw"&gt;
            &lt;a href="/up/{{ gid }}/crx/{{ crx.uuid }}/pub" &gt;请求上架&lt;/a&gt;
        &lt;/span&gt;
    {% endif %}
    &lt;!--
    &lt;span id="bak_submit" class="btnw"&gt;
        &lt;a href="/mana/crx/{{ crx.uuid }}/try/arch" &gt;归档&lt;/a&gt;
    &lt;/span&gt;
    --&gt;
    
{% endif %}
    
    
    
&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/up/{{ gid }}" &gt;返回&lt;/a&gt;
&lt;/span&gt;


</t>
<t tx="zoomq.20120805183037.4230">@language html
{% extends "base.html" %}
{% block title4act %}
CRXed.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;杰出扩展, 编辑&lt;/legend&gt;
&lt;form action="/up/{{ gid }}/crx/{{ uuid }}/info" method="post"
    enctype="multipart/form-data" class="validate"&gt;
@others
&lt;/form&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
&lt;b&gt;[导航]&lt;/b&gt;&lt;a href="/up/{{ gid }}"&gt;首页&lt;/a&gt;
    {% endblock footernav %}

</t>
<t tx="zoomq.20120805183037.4231">&lt;span class="label"&gt;名称:&lt;/span&gt;
&lt;input type="text" name="name" id="name" value="{{ crx['name'] }} "
    class="required min-length_4" title="扩展 名称必填!且长过4字!"/&gt;
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;

&lt;textarea name="desc" id="desc" 
    class="required min-length_13" title="扩展 描述必填!且长过13字!"
    rows="3" /&gt;{{ crx['desc'] }}&lt;/textarea&gt;

    &lt;br/&gt;
&lt;span class="label"&gt;图片:&lt;/span&gt;
&lt;input type="file" name="picture" id="picture" 
    class=""  title="扩展文件必选!"/&gt;
    &lt;br/&gt;
    
@others
    
&lt;label&gt;
&lt;/label&gt;

    &lt;br/&gt;
&lt;span id="reply_submit" class="btnw"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/up/{{ gid }}" &gt;返回&lt;/a&gt;
&lt;/span&gt;
    &lt;br/&gt;
&lt;i&gt;
id: {{ crx['id'] }} 
; uuid: {{ crx['uuid'] }} 
&lt;/i&gt;


</t>
<t tx="zoomq.20120805183037.4232">&lt;span class="label"&gt;标签:&lt;/span&gt;

{% for t in tags %}

&lt;input type="checkbox" class="checkbox"
    name="tags" id="tags" 
     {% if t.id in crx.tagid %}
    checked
     {% endif %}
    value="{{ t.id }}"/&gt;
    &lt;label for="{{ t.id }}"&gt;{{ t.name }}&lt;/label&gt;

{% endfor %}

    &lt;br/&gt;
</t>
<t tx="zoomq.20120805183037.4235">@APP.route('/&lt;gid&gt;/crx/&lt;uuid&gt;/pic/&lt;sid&gt;/ed')
@auth_required()
def crxpiced(gid, uuid, sid):
    '''edit. crx's pic:
        + get info. byr sid
    '''
    #print uuid, sid
    crtpic = KV.get(sid)
    #print crtpic
    #return None
    return template('upcrxpic.html'
        , gid = gid
        , uuid = uuid 
        , sid = sid
        , pic = crtpic
        )




</t>
<t tx="zoomq.20120805183037.4238">@language html
{% extends "base.html" %}
{% block title4act %}
CRX's pic
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展附图, 编辑&lt;/legend&gt;
&lt;form action="/up/{{ gid }}/crx/{{ uuid }}/pic/{{ sid }}/see" method="post"
    class="validate"&gt;
@others
&lt;/form&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
&lt;b&gt;[导航]&lt;/b&gt;&lt;a href="/up/{{ gid }}"&gt;首页&lt;/a&gt;
    {% endblock footernav %}

</t>
<t tx="zoomq.20120805183037.4239">&lt;img src="{{ sspath4pic }}/{{ sid }}"/&gt;
    &lt;br/&gt;

&lt;span class="label"&gt;描述:&lt;/span&gt;
&lt;input type="text" name="note" id="note" value="{{ pic.note }} "
    class="required min-length_4" title="扩展 描述必填!且长过4字!"/&gt;

&lt;label&gt;
&lt;/label&gt;
    &lt;br/&gt;

&lt;span id="reply_submit" class="btnw"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/up/{{ gid }}/crx/{{ uuid }}" &gt;返回&lt;/a&gt;
&lt;/span&gt;
    &lt;br/&gt;
&lt;i&gt;
&lt;/i&gt;


</t>
<t tx="zoomq.20120805183037.4241">@APP.route('/&lt;gid&gt;/crx/&lt;uuid&gt;/pic/&lt;sid&gt;/see', method='POST')
def crxpicsee(gid, uuid, sid):
    '''confirmed crx pic's editor:
        + get info. byr sid
    '''
    note = request.forms.get('note', '...')
    #print uuid, sid
    crtpic = KV.get(sid)
    crtpic['note'] = note.decode('utf-8')
    KV.set(sid, crtpic)
    #return None
    return template('upseepic.html'
        , gid = gid
        , uuid = uuid 
        , sid = sid 
        , pic = crtpic
        )
</t>
<t tx="zoomq.20120805183037.4244">@language html
{% extends "base.html" %}
{% block title4act %}
CRX's pic
    {% endblock title4act %}
{% block headJS %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展附图, 信息&lt;/legend&gt;
@others
&lt;/fieldset&gt;

{% endblock mainbody %}

{% block footernav %}
&lt;b&gt;[导航]&lt;/b&gt;&lt;a href="/up/{{ gid }}"&gt;首页&lt;/a&gt;
    {% endblock footernav %}

</t>
<t tx="zoomq.20120805183037.4245">&lt;img src="{{ sspath4pic }}/{{ sid }}"/&gt;
    &lt;br/&gt;

&lt;span class="label"&gt;描述:&lt;/span&gt;
{{ pic.note }}

&lt;label&gt;
&lt;/label&gt;
    &lt;br/&gt;

&lt;span id="reply_submit" class="btnw"&gt;
    &lt;a href="/up/{{ gid }}/crx/{{ uuid }}" &gt;就酱&lt;/a&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/up/{{ gid }}/crx/{{ uuid }}/pic/{{ sid }}/ed" &gt;返回&lt;/a&gt;
&lt;/span&gt;
    &lt;br/&gt;
&lt;i&gt;

&lt;/i&gt;


</t>
<t tx="zoomq.20120805183037.4247">@APP.route('/&lt;gid&gt;/crx/&lt;uuid&gt;/pic/&lt;sid&gt;/del')
def crxpicdel(gid, uuid, sid):
    '''del. crx's pic:
        + del. SS obj
        + pop sid from SYS:pics
        + pop sid from crx.pic
        + set pic['isdel'] = 1
    '''
    #print uuid, sid
    try:
        ss = sae.storage.Client()
        ss.delete(CFG.D2P, sid)
        #print "\tKV.get(k4pic)", KV.get(k4pic)
    except:
        print "&gt;&gt;&gt;/crx/&lt;xid&gt;/pic/&lt;sid&gt;/del \n\t", traceback.print_exc()
    #   + pop sid from SYS:pic
    k4pic, crpics = INIobjSYS('pic')
    POP4KV(sid, k4pic, crpics)
    #   + pop sid from crx.pic
    crx = KV.get(uuid)
    crpics = crx['pic']
    POP4LIST(sid, crpics)   #crpics.pop(crpics.index(sid))
    crx['pic'] = crpics
    KV.set(uuid, crx)
    #   + set pic['isdel'] = 1
    pic = KV.get(sid)
    pic['isdel'] = 1
    KV.set(sid, pic)
    #print "\tKV.set(uuid)['pic']:", KV.get(uuid)['pic']
    uri = "/up/%s/crx/%s"% (gid,uuid)
    #print uri
    redirect(uri)    
    #response.set_header('location', uri)
    #response.status = 303
    #redirect(uri)




</t>
<t tx="zoomq.20120805183037.5876">@APP.route('/&lt;gid&gt;/crx/&lt;uuid&gt;')
@auth_required()
def seecrx(gid, uuid):
    crcrx = KV.get(uuid)
    #print "\tseecrx()", gid, uuid
    #print crcrx['name']
    incrx, intry, inout, inbak, inarch = ST4CRX(uuid)
    #print "\t incrx, intry, inout, inbak, inarch\n\t ",incrx, intry, inout, inbak, inarch
    #tags = crcrx['tagid']
    #print "\tcrcrx['tagid']", crcrx['tagid']
    tobjs = IDX4LIST(crcrx['tagid'], KV)
    #gobj = KV.get(gid)
    return template('upcrx.html'
        , crx = crcrx
        , incrx = incrx
        , intry = intry
        , inout = inout
        , inbak = inbak
        , inarch = inarch
        , gid = gid
        , uuid = uuid
        , tags = tobjs
        )


</t>
<t tx="zoomq.20120805183037.5879">uuid = crx_id.GetCRXAppID4upload(crxfile.file)
#   read manifest.json from crx file
zz = zipfile.ZipFile(crxfile.file, "r")
manifest = zz.open("manifest.json").read()
#   fixed error JSON format from:"夜间模式.crx"
json = eval(manifest.replace("\r\n",""))
if KV.get(uuid):
    crtcrx = KV.get(uuid)
    if json['version'] == crtcrx['version']:
        # not any upgrade?!
        redirect("/up/%s/crx/%s/duplicate"% (gid, uuid) )
    else:
        # update try...
        &lt;&lt;upgrade crx&gt;&gt;
else:
    # new .crx ;-)
    raw = crxfile.file.read() # This is dangerous for big files
    sid, uri = PUT2SS(raw, uuid, 'sae')
    crxfile.file.close()
    &lt;&lt;new .crx&gt;&gt;
    #   default try-&gt;pub ;-)
    KV4CRX(uuid, "try")

#print "\tdata.file.closed? ", data.file.closed
#LIST所有的domain
#print ss.list_domain()
#print "\tcrx4lb inc files:", len(ss.list(CFG.D2X))
#print ss.url(CFG.D2X, sskey)

</t>
<t tx="zoomq.20120805183037.5880">#   for create NEW crx
crx = deepcopy(CFG.objCRX)
xid = GENID('crx')
crx['id'] = xid
crx['uuid'] = uuid
crx['sid'] = sid
crx['grpid'] = gid  #&lt;~~~ 关键行为!
#hid = PUTHIS(crx, "C")
#crx['hisid'] = crx['hisid'].append(hid)
crx['name'] = json['name'].decode('utf-8')
crx['desc'] = json['description'].decode('utf-8')
crx['version'] = json['version']
#print crx
KV.add(uuid, crx)


</t>
<t tx="zoomq.20120805183037.5882">@APP.route('/&lt;gid&gt;/crx/&lt;uuid&gt;/duplicate')
def crxduplicated(gid, uuid):
    ''' realy ACTION:
        - get obj. by uuid
        - alert DUPLICATE ERROR 
    '''
    crcrx = KV.get(uuid)
    #print crcrx
    return template('upcrxduplicated.html'
        , crx = crcrx
        , gid = gid
        , uuid = uuid
        )


</t>
<t tx="zoomq.20120805183037.5885">@language html
{% extends "base.html" %}
{% block title4act %}
CRX duplicated
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;扩展上传重样儿了!-(&lt;/legend&gt;

@others

&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
&lt;b&gt;[导航]&lt;/b&gt;&lt;a href="/up/{{ gid }}"&gt;首页&lt;/a&gt;
    {% endblock footernav %}

</t>
<t tx="zoomq.20120805183037.5886">&lt;span class="label"&gt;名称:&lt;/span&gt;{{ crx['name'] }}
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;{{ crx['desc'] }}
&lt;/label&gt;
    &lt;br/&gt;
&lt;span class="label"&gt;版本:&lt;/span&gt; 
    依然是&lt;b class="alert"&gt; {{ crx['version'] }} &lt;/b&gt;?!
    &lt;br/&gt;
&lt;label&gt;
&lt;/label&gt;
    
    &lt;br/&gt;

&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/up/{{ gid }}" &gt;重来!-)&lt;/a&gt;
&lt;/span&gt;

&lt;span id="pub_submit" class="btnw"&gt;
    &lt;a href="/up/{{ gid }}/crx/{{ uuid }}/pub" &gt;请求上架&lt;/a&gt;
&lt;/span&gt;

    &lt;br/&gt;
&lt;i&gt;
id: {{ crx['id'] }} 
; uuid: {{ crx['uuid'] }} 
; ispub: {{ crx['ispub'] }} 
; isdel: {{ crx['isdel'] }} 
&lt;/i&gt;</t>
<t tx="zoomq.20120805183037.5887">#print "\n TRY update by uploading..."
crx4update = deepcopy(crtcrx)
xid = crx4update['id']
crx4update['name'] = json['name'].decode('utf-8')
crx4update['desc'] = json['description'].decode('utf-8')
crx4update['version'] = json['version']
#hid = PUTHIS(crtcrx, "U")
#crx4update['hisid'] = crx4update['hisid'].append(hid)
raw = crxfile.file.read() # This is dangerous for big files
sid, uri = PUT2SS(raw, uuid, 'sae')
crx4update['sid'] = sid
crxfile.file.close()
KV.set(uuid, crx4update)
#print KV.get(uuid)
</t>
<t tx="zoomq.20120805183037.5889">
    &lt;hr/&gt;
&lt;span class="label"&gt;前次退回信息:&lt;/span&gt;&lt;pre class="desc"&gt;
{{ crx.reply }}
&lt;/pre&gt;</t>
<t tx="zoomq.20120805183037.5891">@APP.route('/&lt;gid&gt;/crx/&lt;uuid&gt;/pub')
@auth_required()
def crxpub(gid, uuid):
    ''' realy ACTION:
        - set uuid into:
            + SYS:trys[]
            + objGRP.objGRP[] &lt;~~~
        - jump back
    for k in c.keys():
        print "\t%s:\t%s"% (k, c[k])
    '''
    #print "\t gid, uuid:", gid, uuid
    KV4CRX(uuid, "ini")  
    c = KV.get(uuid)
    grpcrxs, grptrys, grpouts, grpbaks = KV4GRP(uuid)
    #print "\t grpcrxs, grptrys, grpouts, grpbaks"
    #print "\t", grpcrxs, grptrys, grpouts, grpbaks
    #return None
    redirect("/up/%s"% gid) 



</t>
<t tx="zoomq.20120805183037.5894">&lt;ul&gt;
{% for x in obj4bak %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;&lt;a href="/mana/crx/{{ x.uuid }}" title="{{ x.desc }}"&gt;{{ x.name }}&lt;/a&gt;
    &lt;sub&gt;
    &lt;&lt;zip info.s&gt;&gt;
    
    &lt;span id="pub_submit" class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/try/pub" &gt;上架&lt;/a&gt;
    &lt;/span&gt;
    
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/crx/{{ x.uuid }}/ed" &gt;增补&lt;/a&gt;
    &lt;/span&gt;
    
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120805183037.5896">def INS2DICT4LIST(cnt, dictobj, keyname):
    '''try safty insert SOMETHING to list
    '''
    #print "\t&gt;&gt;&gt;", cnt, listobj
    if dictobj.has_key(keyname):
        listobj = dictobj[keyname]
        listobj.append(cnt)
        listobj  = list(set(listobj))
        #print "\t list(set(listobj))", listobj
    else:
        listobj = []
        listobj.append(cnt)
        dictobj[keyname] = listobj
        #print "\t dictobj[keyname]~", dictobj[keyname]
    return listobj, dictobj # 防止意外重复






</t>
<t tx="zoomq.20120805183037.5897">crtgrp = KV.get(grpid)
incrx, intry, inout, inbak, inarch = ST4CRX(uuid)
if incrx:
    crtgrp['crxs'], crtgrp = INS2DICT4LIST(uuid, crtgrp, 'crxs')
    POP4LIST(uuid, crtgrp['trys'])
    POP4LIST(uuid, crtgrp['outs'])
    POP4LIST(uuid, crtgrp['baks'])
elif intry:
    POP4LIST(uuid, crtgrp['crxs'])
    crtgrp['trys'], crtgrp = INS2DICT4LIST(uuid, crtgrp, 'trys')
    POP4LIST(uuid, crtgrp['outs'])
    POP4LIST(uuid, crtgrp['baks'])
elif inbak:
    POP4LIST(uuid, crtgrp['crxs'])
    POP4LIST(uuid, crtgrp['trys'])
    POP4LIST(uuid, crtgrp['outs'])
    crtgrp['baks'], crtgrp = INS2DICT4LIST(uuid, crtgrp, 'baks')
elif inout:
    POP4LIST(uuid, crtgrp['crxs'])
    POP4LIST(uuid, crtgrp['trys'])
    crtgrp['outs'], crtgrp = INS2DICT4LIST(uuid, crtgrp, 'outs')
    POP4LIST(uuid, crtgrp['baks'])
elif inarch:
    POP4LIST(uuid, crtgrp['crxs'])
    POP4LIST(uuid, crtgrp['trys'])
    POP4LIST(uuid, crtgrp['outs'])
    POP4LIST(uuid, crtgrp['baks'])
KV.set(grpid, crtgrp)

#print "\t crtgrp['crxs']:", crtgrp['crxs']
#print "\t crtgrp['trys']:", crtgrp['trys']
#print "\t crtgrp['outs']:", crtgrp['outs']

</t>
<t tx="zoomq.20120811092308.4293">&lt;img src="{{ sspath4pic }}/{{ sid }}"/&gt;
    &lt;br/&gt;

&lt;span class="label"&gt;描述:&lt;/span&gt;
&lt;input type="text" name="note" id="note" value="{{ pic.note }} "
    class="required min-length_4" title="扩展 描述必填!且长过4字!"/&gt;

    &lt;br/&gt;

&lt;span class="label"&gt;icon?&lt;/span&gt;
&lt;input type="checkbox" class="checkbox"
    name="icon" id="icon" 
     {% if pic.icon == 1 %}
    checked
     {% endif %}
    value="icon"/&gt;
    
    &lt;br/&gt;

    &lt;br/&gt;
</t>
<t tx="zoomq.20120811092308.4294">&lt;label&gt;
&lt;img src="{{ sspath4pic }}/{{ sid }}"/&gt;
    &lt;br/&gt;

&lt;span class="label"&gt;描述:&lt;/span&gt;
{{ pic.note }}
    &lt;br/&gt;

&lt;span class="label"&gt;icon?&lt;/span&gt;
     {% if pic.icon == 1 %}
    是！&lt;sup&gt;logo图标&lt;/sup&gt;
     {% else %}
    否！ &lt;sup&gt;说明大图&lt;/sup&gt;
     {% endif %}
    &lt;br/&gt;

&lt;/label&gt;
    &lt;br/&gt;
</t>
<t tx="zoomq.20120811092308.4295">各种服务性对外功能...
+ 页面生成
+ 统计
+ ...


HTML

An HTML fragment embedding a picture of small red dot: Red-dot-5px.png

&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
9TXL0Y4OHwAAAABJRU5ErkJggg==" alt="Red dot"&gt;

As demonstrated above, data URIs encoded with base64 may contain whitespace for readability.
CSS

A CSS rule that includes a background image:

ul.checklist li.complete {
    margin-left: 20px;
    background: white url('data:image/png;base64,iVBORw0KGgoAA
AANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAD///+l2Z/dAAAAM0l
EQVR4nGP4/5/h/1+G/58ZDrAz3D/McH8yw83NDDeNGe4Ug9C9zwz3gVLMDA/A6
P9/AFGGFyjOXZtQAAAAAElFTkSuQmCC') no-repeat scroll left top;
}

In Mozilla Firefox 5, Google Chrome 17, and IE 9 (released June, 2011), encoded data must not contain newlines.


</t>
<t tx="zoomq.20120811092308.4297">@APP.route('/gen/crx/&lt;uuid&gt;.html')
def gencrx(uuid):
    #print "get it!"
    crtcrx = KV.get(uuid)
    crtgrp = KV.get(crtcrx['grpid'])
    page = template('gencrx.html'
        , crx = crtcrx
        , grp = crtgrp
        )
    #print page
    sid, uri = PUT2SS(page.encode('utf-8'), uuid, 'html')
    #print sid, uri
    redirect(uri)

    return template('gencrx.html'
        , crx = crtcrx
        , grp = crtgrp
        )
    





</t>
<t tx="zoomq.20120811092308.4307">@language html
&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
&lt;&lt;sspathdefine&gt;&gt;

&lt;title&gt;猎豹商店 - 
{% block title4pub %}
{% endblock title4pub %}
&lt;/title&gt;

&lt;script language="javascript" type="text/javascript" &gt;
    {% include 'jquery.js' %} 
    {% include 'y.os.js' %} 
    {% include 'store.js' %} 
&lt;/script&gt;

{% block headJS %}
{% endblock headJS %}

{% block headCSS %}
&lt;style type="text/css"&gt;
&lt;&lt;CSS&gt;&gt;
&lt;/style&gt;
{% endblock headCSS %}
&lt;/head&gt;
&lt;body&gt;

{% block mainbody %}
{% endblock mainbody%}


{% block footerJS %} 
{% endblock footerJS %}
&lt;/body&gt;
&lt;/html&gt;
</t>
<t tx="zoomq.20120811092308.4308">@language css
@font-face {
	font-family: sansation;
	src: url("Sansation_Regular.ttf");
}
body{
	font:100%/1.4  "微软雅黑", "Microsoft YaHei",Verdana,  Arial, Helvetica, sans-serif;
	text-align: center;
	margin: 0px;
	padding: 0px;
	background-repeat: repeat-x;
	overflow: auto;
	-webkit-box-sizing: border-box;
}
html,body{
	height: 100%;
	width: 100%;
}
a:link {
	color: #87868e;
	text-decoration: none;
}
a:visited {
	color: #87868e;
	text-decoration: none;
}
a:hover {
	color: #87868e;
	text-decoration: none;
}
a:active {
	color: #87868e;
	text-decoration: none;
}
.leftbox {
	float: left;
	height: 100%;
	width: 160px;
	background-color: #FFF;
	margin-right: -100px;
	-webkit-box-sizing: border-box;
}

.leftbox img{
	height: 120px;
	width: 120px;
	margin-top: 16px;
	margin-right: auto;
	margin-left: auto;
}
.rightbox {
	float: right;
	height: 100%;
	width: 100%;
	margin-left: -200px;
	padding-left: 180px;
	-webkit-box-sizing: border-box;
	padding-right: 50px;
}
.rightbox p{
	font-size: 12px;
	line-height: 20px;
	color: #333;
	margin: 0px;
	padding: 0px;
	text-align: left;
}
.rightbox h2{
	font-size: 28px;
	line-height: 36px;
	text-align: left;
	font-family: sansation;
}


@others

</t>
<t tx="zoomq.20120811092308.5956">@language html
{% extends "base.html" %}

{% block title4act %}
Mana.
{% endblock %}

{% block mainbody %}
    &lt;h1&gt;&lt;img src="/static/logo.png"/&gt;后台:页面生成(Bottle版) &lt;/h1&gt;
&lt;hr/&gt;

&lt;table&gt;
&lt;tr&gt;
    {% for tag in tags %}
    &lt;td valign="top" class="{{ loop.cycle('odd', 'even') }}"&gt;
    &lt;a href="/mana/gen/{{ tag.id }}.html"&gt;{{ tag.name }}&lt;/a&gt;
    &lt;hr/&gt;
        {% for crx in tag.pub %}
        &lt;a href="/mana/gen/crx/{{ crx.uuid }}.html"&gt;{{ crx.name }}&lt;/a&gt;
        &lt;/br&gt;
        {% endfor %}
    &lt;/td&gt;
    {% endfor %}
&lt;/tr&gt;
&lt;/table&gt;


{% endblock %}

{% block footernav %}
{% include 'manav.html' %} 
{% endblock %}</t>
<t tx="zoomq.20120811092308.5959">@APP.route('/gen/&lt;tid&gt;.html')
def gentag(tid):
    '''gen all can gen pages:
        - dict of pages idx:
            + tag include pages
            + all pages uri
        tags={
            tid:{TAG's norm. dict data
                + "pub":{
                    xid:{CRX's norm. dict data}
                    ,,,}
                ,,,}
            ,,,}
    '''
    k4tags, crttags = INIobjSYS('tag')
    tags = []
    for t in crttags:
        tag = KV.get(t)
        tags.append({'id':tag['id'],'name':tag['name']})
    #return Nonr
    
    k4pubs, crtpubs = INIobjSYS('crx')
    crttag = KV.get(tid)
    crttag['pub'] = []
    for xid in crttag['crxs']:
        if xid in crtpubs:
            crttag['pub'].append(KV.get(xid))
    print "\t crttag['pub']:", len(crttag['pub'])
    # every 3 app.s as 1 &lt;UL&gt;
    ulcrxs = []
    ul = 0
    licrxs = []
    for crx in crttag['pub']:
        &lt;&lt;GEN APP.PAGE&gt;&gt;
        ul += 1
        if 0 == ul%3:
            licrxs.append(crx)
            ulcrxs.append(licrxs)
            licrxs = []
        else:
            licrxs.append(crx)
    if 0 != len(licrxs):
        ulcrxs.append(licrxs)
        
    #print "\t ulcrxs:", len(ulcrxs)
    #print "\t ulcrxs[0]", len(ulcrxs[0])
    page = template('gentag.html'
        , crtid = tid
        , tags = tags
        , crttag = ulcrxs
        )
    sid, uri = PUT2SS(page.encode('utf-8'), tid, 'html')
    #print sid, uri
    redirect(uri)

    return template('gentag.html'
        , crtid = tid
        , tags = tags
        , crttag = ulcrxs
        )
    





</t>
<t tx="zoomq.20120811092308.5963">@language html
{% extends "expbase.html" %}

{% block title4pub %}
{{ crx.name }}
{% endblock %}

{% block mainbody %}
&lt;div class="rightbox"&gt;
    &lt;h2&gt;{{ crx.name }}&lt;/h2&gt;
    &lt;p&gt;作者：{{ grp.name }}&lt;/p&gt;
    &lt;p&gt;版本：{{ crx.version }}&lt;/p&gt;
    &lt;p&gt;&amp;nbsp;&lt;/p&gt;
    &lt;p&gt;{{ crx.desc }}&lt;/p&gt;
    &lt;p&gt;&amp;nbsp;&lt;/p&gt;
    &lt;p&gt;
    
    {% for pid in crx.pic %}
        {% if pid != crx.icon %}
            &lt;img src="{{ sspath4pic }}/{{ pid }}"/&gt;
            &lt;/br&gt;
        {% endif %}
    {% endfor %}
    &lt;/div&gt; &lt;!-- class="rightbox" --&gt;

&lt;div class="leftbox"&gt;
    {% if crx.icon is not none %}
        &lt;img src="{{ sspath4pic }}/{{ crx.icon }}"/&gt;
    {% endif %}

    &lt;button class="cupid-blue"&gt;立即安装&lt;/button&gt;
&lt;/div&gt; &lt;!-- class="leftbox" --&gt;

{% endblock mainbody %}

</t>
<t tx="zoomq.20120811092308.5964">@language css
body{
	font:100%/1.4  "微软雅黑", "Microsoft YaHei",Verdana,  Arial, Helvetica, sans-serif;
	text-align: center;
	margin: 0px;
	padding: 50px;
	background-repeat: repeat-x;
	overflow: auto;
	-webkit-box-sizing: border-box;
}
html,body{
	height: 100%;
	width: 100%;
}
a:link {
	color: #87868e;
	text-decoration: none;
}
a:visited {
	color: #87868e;
	text-decoration: none;
}
a:hover {
	color: #87868e;
	text-decoration: none;
}
a:active {
	color: #87868e;
	text-decoration: none;
}



.topclass{
	height: 50px;
	width: 100%;
	text-align: center;
	-webkit-box-sizing: border-box;
	padding: 0px;
	list-style-type: none;
	margin-top: 20px;
	margin-right: 0px;
	margin-bottom: 0px;
	margin-left: 0px;
}
.topclass li{
	font-size: 28px;
	line-height: 50px;
	padding: 0px;
	float: left;
	height: 50px;
	width: auto;
	margin-top: 0px;
	margin-right: 20px;
	margin-bottom: 0px;
	margin-left: 0px;
	-webkit-box-sizing: border-box;
	color: #333;
	cursor: pointer;
}/*hover*/
.topclass li:hover{
	border-bottom-width: 3px;
	border-bottom-style: solid;
	border-bottom-color: #ff8a00;
}
.topclass li.select{
	border-bottom-width: 3px;
	border-bottom-style: solid;
	border-bottom-color: #ff8a00;
}

.app-box{
	height: 480px;
	width: 100%;
	margin-top: 20px;
	overflow-x:hidden;
	overflow-y:hidden;
	
	-webkit-transition: scroll-left 0.2s ease;
}
.app-box &gt; .box{
	margin: 0px;
	padding: 0px;
	height: 480px;
	width: 2290px;
}
.app-box &gt; .box &gt; ul{
	list-style-type: none;
	margin: 0px;
	padding: 0px;
	float: left;
	height: 480px;
	width: 365px;
}
.app-box &gt; .box &gt; ul li{
	margin: 0px;
	float: left;
	height: 160px;
	width: 365px;
	padding-top: 0px;
	padding-right: 0px;
	padding-bottom: 0px;
	padding-left: 136px;
	-webkit-box-sizing: border-box;
	text-align: left;
}
.app-box &gt; .box &gt; ul li img{
	height: 120px;
	width: 120px;
	margin-top: 5px;
	margin-left: -128px;
	float: left;
}
.app-box &gt; .box &gt; ul li p{
	padding: 0px;
	float: right;
	height: auto;
	width: 180px;
	font-size: 12px;
	line-height: 20px;
	color: #666;
	margin-top: 0px;
	margin-right: 30px;
	margin-bottom: 0px;
	margin-left: 0px;
}
.app-box &gt; .box &gt; ul li h2{
	font-size: 14px;
	font-weight: bold;
	color: #333;
	padding: 0px;
	float: right;
	height: auto;
	width: 180px;
	line-height: 24px;
	margin-top: 0px;
	margin-right: 30px;
	margin-bottom: 0px;
	margin-left: 0px;
}

.bigbox{
	height: 640px;
	width: 100%;
	margin-top: 50px;
}
.cover{
	width: 100%;
	position: absolute;
	z-index: 9;
	background-color: rgba(255,255,255,0.75);
	height: 100%;
	left: 0px;
	top: 0px;
}
.detail {
	-webkit-box-shadow: 10px 10px 20px rgba(0,0,0,.3);
	background-color: #FFF;
	border: 1px solid #a9a9a9;
	position: absolute;
	height: 600px;
	width: 900px;
	z-index: 10;
	left: 50px;
	top: 50px;
	text-align: right;
}

@others
</t>
<t tx="zoomq.20120811092308.5965">.toptitle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARIAAABECAIAAADC9S0qAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM0QzE4RkE0REY3NDExRTE5N0JFQkE4MjY3M0YxQUJDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM0QzE4RkE1REY3NDExRTE5N0JFQkE4MjY3M0YxQUJDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MzRDMThGQTJERjc0MTFFMTk3QkVCQTgyNjczRjFBQkMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MzRDMThGQTNERjc0MTFFMTk3QkVCQTgyNjczRjFBQkMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4eVWvTAAAgvklEQVR42ux9eYxcx3nn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');
	background-repeat: no-repeat;
	background-position: left center;
	height: 68px;
	width: 100%;
	text-align: center;
	-webkit-box-sizing: border-box;
}

.detail .close{
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAdCAYAAABbjRdIAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkFBMjVGM0IxREZBMTExRTE4MjZCOUVCOUY1RDk0NEY4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkFBMjVGM0IyREZBMTExRTE4MjZCOUVCOUY1RDk0NEY4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QUEyNUYzQUZERkExMTFFMTgyNkI5RUI5RjVEOTQ0RjgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QUEyNUYzQjBERkExMTFFMTgyNkI5RUI5RjVEOTQ0RjgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4D6a2aAAABu0lEQVR42rSWjU6DMBSFOxphTGTT6DZN9v5PZuJExjSZujGYt8m5sxKwLWVNTgIZ68e5f0WI3zUSl1nnfQMoJj1dAChJKSnimwnpnnRHuiEVA4HGpEfSHCYOEhcrOAxJyQDAK9ISBjhyHwpWkU5wJQYAKtCCNAWoJG2UJB7YAZp6AicIHTtSKye9KENSe/DTExgiPzOk5kjKADtygQhP4AiOlhpIhe4Njiq9NIUnMESObgGqAFJ5qpt9IDyAMRylyNEeoXvVHZlgNsBYcxTARQ5XdVeHix7AHYphyg0LRxsuhj6wLuA17rnqlJt1lyMXGANLOOHGFXiJNUJbmzYJHBr2HZOm+f8ML2I1lW1WjMkwbpwM3GPboWBqswdt1u1RdQl+j2wnjTRMhgTlPQPoCNC6z2iThvNorhXFHlVXAOQ82qTBEffRN0BZo+qcgLKjGHRQidB1lbc1ULYUw0Jr2C/tmKg8RtsfWFvoyq7p3RfI3yBcDGkjR4XBkRNQArTSQNxHmaUjG6CKVh4AyGOLQ7cVfku96DOuT2BI/rriY6H47zzq6TAE+KDnLnKYlS4rbRv4l/rWP68fAQYAkSuT6zmt0WoAAAAASUVORK5CYII=');
	background-repeat: no-repeat;
	background-position: center center;
	height: 30px;
	width: 30px;
	position: absolute;
	cursor: pointer;
}

.toptitle input[type=button]{
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAaCAYAAABGiCfwAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkJFNzYzQTlDREY4NTExRTFCM0JBQ0RCRDM1REExRTc5IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkJFNzYzQTlEREY4NTExRTFCM0JBQ0RCRDM1REExRTc5Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QkU3NjNBOUFERjg1MTFFMUIzQkFDREJEMzVEQTFFNzkiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QkU3NjNBOUJERjg1MTFFMUIzQkFDREJEMzVEQTFFNzkiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz52h6rIAAABiElEQVR42ryWPUvDUBSGczMIgpMILpnqKAgBp2BnJ0fniiGLP6C/QIfiPwgdgquDg5NzSdbSRZyKUgd3R6XxPXACl+PNzVfTF54hH+c+Iffk3qg8zx1DPHAOhsAHA3F9CeZgBl7Ap1MnJNNQIAJpXj8p1ygx1j/0g30wydtnwmNUylSJaAWmYAROmBGfW5UIVZUsEkVrEIPA8qQB37MWtZFN5ok5ouJx1fvXGAthymMaZaF4sriBqCAWY4Sm+1xu7yLUwonTPIlo/6HpJpe/oyL0zWQtZBnXFvHLZPoHO3PaR68dlMn0zDvIKmtdZ4uRMr/DWH4d2bKqi2pmKBZqo0x/17TSBy1EAdda588VXURby1VD0S644Vp7V29guZoathyvj4X4ybDyR9vaYigP4KDvzVNPBo5tsi6/BffgVZz/ABc2WYHH20QCFuBbsOBrodYMR+BZCH/ALdixydqyB+7Ar5Be9yEruARfmuyRpqgvGXHK8/kGzkimSn5SNxVaXQ7BOx38CTAAs9V5tMR71mQAAAAASUVORK5CYII=');
	background-repeat: no-repeat;
	background-position: center center;
	background-color: #ea732d;
	font-size: 24px;
	line-height: 30px;
	color: #666;
	height: 40px;
	width: 70px;
	border-top-width: 0px;
	border-right-width: 0px;
	border-bottom-width: 0px;
	border-left-width: 0px;
	border-top-style: none;
	border-right-style: none;
	border-bottom-style: none;
	border-left-style: none;
	outline:none;
	-webkit-box-sizing: border-box;
	padding: 5px;
	margin-top: 18px;
	display: inline;
	margin-left: 5px;
	-webkit-border-radius:3px;
	cursor: pointer;
}

.toptitle input[type=text]{
	font-size: 24px;
	line-height: 30px;
	color: #666;
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO4AAAAoCAIAAAB2PVHcAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU5MDcxMDlGREY4MzExRTFBREIzQ0ZEQUVCRDRFQTIyIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU5MDcxMEEwREY4MzExRTFBREIzQ0ZEQUVCRDRFQTIyIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTkwNzEwOURERjgzMTFFMUFEQjNDRkRBRUJENEVBMjIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTkwNzEwOUVERjgzMTFFMUFEQjNDRkRBRUJENEVBMjIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6yYRVxAAAA/ElEQVR42uzdzW2DQBRG0UAGGxpgy4auaQ/JLgEYfjKAlRoy0TkLCvh09cQKimEYtm0riuIL8hRj7LoutG3b9/33xSjkaJqm9/sdyrJ8Pp91XUuZTKV0U8YhvVqklJumeTweRiE7x3EUl/MqV1WVapYymVrX9Uz5vs9JCMEo5HiV73fjT773ibYLObrTLQ3B/yBlpAxSBimDlJEySBmkDFJGyiBlkDJIGaSMlEHKIGWQMlIGKYOUQcpIGaQMUgYpg5SRMvxdny95HhdzkJ3fdM+Ut8u6rnYhR6neM+V932OM8zy7ymR6lZdlSc/wer3GcfSdcPJ1/+zsR4ABADH0TgofSxZsAAAAAElFTkSuQmCC');
	background-repeat: no-repeat;
	height: 40px;
	width: 238px;
	border-top-width: 0px;
	border-right-width: 0px;
	border-bottom-width: 0px;
	border-left-width: 0px;
	border-top-style: none;
	border-right-style: none;
	border-bottom-style: none;
	border-left-style: none;
	outline:none;
	-webkit-box-sizing: border-box;
	padding: 5px;
	margin-top: 18px;
	display: inline;
}
</t>
<t tx="zoomq.20120811092308.5966">&lt;ul class="topclass"&gt;

{% for tag in tags %}
    {% if tag.id == crtid %}
        &lt;li class="select"&gt;
    {% else %}
        &lt;li&gt;
    {% endif %}
    &lt;a href="/mana/gen/{{ tag.id }}.html"&gt;{{ tag.name }}&lt;/a&gt;
&lt;/li&gt;
{% endfor %}

&lt;/ul&gt;

</t>
<t tx="zoomq.20120811092308.5967">
&lt;div class="toptitle"&gt;
  &lt;label for="textfield"&gt;&lt;/label&gt;
&lt;/div&gt;
</t>
<t tx="zoomq.20120811092308.5968">&lt;div class="app-box"&gt;&lt;div class="box"&gt;

{% for ul in crttag %}
&lt;ul&gt;
    {% for crx in ul %}
    &lt;li _url="{{ crx.pageuri }}"&gt;
        &lt;img src="{{ sspath4pic }}/{{ crx.icon }}"/&gt;
        &lt;h2&gt;{{ crx.name }}&lt;/h2&gt;
        &lt;p&gt;{{ crx.desc }}
        &lt;/p&gt;
    &lt;/li&gt;
    {% endfor %}
&lt;/ul&gt;
{% endfor %}


&lt;/div&gt;&lt;/div&gt;

</t>
<t tx="zoomq.20120811092308.5969">button::-moz-focus-inner {
  border: 0; }

/* cupid blue (inspired by okcupid.com)
    from 15个风格各异的CSS3按钮在线演示 
    http://www.itivy.com/html/15-css3-buttons/index.html
*******************************************************************************/
button.cupid-blue {
  background-color: #d7e5f5;
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #d7e5f5), color-stop(100%, #cbe0f5));
  background-image: -webkit-linear-gradient(top, #d7e5f5, #cbe0f5);
  background-image: -moz-linear-gradient(top, #d7e5f5, #cbe0f5);
  background-image: -ms-linear-gradient(top, #d7e5f5, #cbe0f5);
  background-image: -o-linear-gradient(top, #d7e5f5, #cbe0f5);
  background-image: linear-gradient(top, #d7e5f5, #cbe0f5);
  border-top: 1px solid #abbbcc;
  border-left: 1px solid #a7b6c7;
  border-bottom: 1px solid #a1afbf;
  border-right: 1px solid #a7b6c7;
  -webkit-border-radius: 12px;
  -moz-border-radius: 12px;
  border-radius: 12px;
  -webkit-box-shadow: inset 0 1px 0 0 white;
  -moz-box-shadow: inset 0 1px 0 0 white;
  box-shadow: inset 0 1px 0 0 white;
  color: #1a3e66;
  font: normal 11px "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Verdana, sans-serif;
  line-height: 1;
  padding: 6px 0 7px 0;
  text-align: center;
  text-shadow: 0 1px 1px #fff;
  width: 108px; 
  }
  
  button.cupid-blue:hover {
    background-color: #ccd9e8;
    background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #ccd9e8), color-stop(100%, #c1d4e8));
    background-image: -webkit-linear-gradient(top, #ccd9e8, #c1d4e8);
    background-image: -moz-linear-gradient(top, #ccd9e8, #c1d4e8);
    background-image: -ms-linear-gradient(top, #ccd9e8, #c1d4e8);
    background-image: -o-linear-gradient(top, #ccd9e8, #c1d4e8);
    background-image: linear-gradient(top, #ccd9e8, #c1d4e8);
    border-top: 1px solid #a1afbf;
    border-left: 1px solid #9caaba;
    border-bottom: 1px solid #96a3b3;
    border-right: 1px solid #9caaba;
    -webkit-box-shadow: inset 0 1px 0 0 #f2f2f2;
    -moz-box-shadow: inset 0 1px 0 0 #f2f2f2;
    box-shadow: inset 0 1px 0 0 #f2f2f2;
    color: #163659;
    cursor: pointer; 
    }
  button.cupid-blue:active {
    border: 1px solid #8c98a7;
    -webkit-box-shadow: inset 0 0 4px 2px #abbccf, 0 0 1px 0 #eeeeee;
    -moz-box-shadow: inset 0 0 4px 2px #abbccf, 0 0 1px 0 #eeeeee;
    box-shadow: inset 0 0 4px 2px #abbccf, 0 0 1px 0 #eeeeee; 
    }

</t>
<t tx="zoomq.20120811092308.5970">@language python
@tabwidth -4
# -*- coding: utf-8 -*-
#!/usr/bin/env python
import sys

if __name__ == '__main__':
    if 3 != len(sys.argv) :
        print '''Usage:
            data_uri.py /path/2/imgfile exp.base64
        '''
    else:
        imgf = sys.argv[1]
        expf = sys.argv[2]
        data_uri = open(imgf, "rb").read().encode("base64").replace("\n", "")
        img_tag = 'data:image/png;base64,{0}'.format(data_uri)
        open(expf,"w").write(img_tag)
        #print img_tag</t>
<t tx="zoomq.20120811092308.5972">@APP.route('/')
@auth_required()
def alertnoid():
    return template('upalertnoid.html')

</t>
<t tx="zoomq.20120811092308.5978">@language html
{% extends "base.html" %}
{% block title4act %}
GROUPinfo.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;原创团队, 信息&lt;/legend&gt;
    &lt;label&gt;
    &lt;&lt;团队信息&gt;&gt;
    &lt;&lt;操作指引&gt;&gt;
    &lt;/label&gt;
&lt;/fieldset&gt;
&lt;fieldset&gt;
&lt;legend&gt;原创扩展, 信息&lt;/legend&gt;
    &lt;label&gt;
    &lt;&lt;扩展信息&gt;&gt;
    &lt;/label&gt;
    &lt;br/&gt;
&lt;fieldset&gt;
&lt;legend&gt;增加/升级, 扩展&lt;/legend&gt;
    &lt;label&gt;
    &lt;&lt;add CRX&gt;&gt;
    &lt;/label&gt;
    &lt;/fieldset&gt;


&lt;i&gt;
id: {{ grp['id'] }} 
;order: {{ grp['order'] }} 
&lt;/i&gt;
&lt;/fieldset&gt;
    &lt;br/&gt;

{% endblock mainbody %}



{% block footernav %}
&lt;b&gt;[导航]&lt;/b&gt;&lt;a href="/up/{{ gid }}"&gt;首页&lt;/a&gt;
    {% endblock footernav %}

</t>
<t tx="zoomq.20120811092308.5979">&lt;form action="/up/{{ gid }}/crx/add" method="post"  
    enctype="multipart/form-data"
    id="inicrxform" name="inicrxform" class="validate"&gt;

.cxr &lt;input type="file" name="crxfile" id="crxfile" 
    class="required"  title="扩展文件必选!"/&gt;
  &lt;br/&gt;
  &lt;br/&gt;

&lt;span id="reply_submit" class="btnw right"&gt;
    &lt;button type="submit" name="submit" class="action" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;/form&gt;

&lt;!--
&lt;form action="/up/{{ gid }}/crx/add" method="post"  

--&gt;

</t>
<t tx="zoomq.20120811092308.5980">&lt;span class="label"&gt;名称:&lt;/span&gt;{{ grp['name'] }}
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;{{ grp['desc'] }}
    &lt;br/&gt;
</t>
<t tx="zoomq.20120811092308.5981">

&lt;span id="reply_submit" class="btnw"&gt;
    &lt;a href="/up/{{ grp.id }}/ed" &gt;编辑&lt;/a&gt;
&lt;/span&gt;
</t>
<t tx="zoomq.20120811092308.5982">{% if crxs is not none %}
&lt;span class="label"&gt;已发布.crx:&lt;/span&gt;
{% for crx in crxs %}
    &lt;a href="/up/{{ grp.id }}/crx/{{ crx.uuid }}"&gt;{{ crx.name }}&lt;/a&gt; ; 
{% endfor %}
    &lt;br/&gt;
{% endif %}

{% if trys is not none %}
&lt;span class="label"&gt;待发布.crx:&lt;/span&gt;
{% for crx in trys %}
    &lt;a href="/up/{{ grp.id }}/crx/{{ crx.uuid }}"&gt;{{ crx.name }}&lt;/a&gt; ; 
{% endfor %}
    &lt;br/&gt;
{% endif %}

{% if baks is not none %}
&lt;span class="label"&gt;被退回.crx:&lt;/span&gt;
{% for crx in baks %}
    &lt;a href="/up/{{ grp.id }}/crx/{{ crx.uuid }}"&gt;{{ crx.name }}&lt;/a&gt; ; 
{% endfor %}
    &lt;br/&gt;
{% endif %}

{% if outs is not none %}
&lt;span class="label"&gt;被下架.crx:&lt;/span&gt;
{% for crx in outs %}
    &lt;a href="/up/{{ grp.id }}/crx/{{ crx.uuid }}"&gt;{{ crx.name }}&lt;/a&gt; ; 
{% endfor %}
    &lt;br/&gt;
{% endif %}
</t>
<t tx="zoomq.20120812115324.4331">&lt;span id="reply_submit" class="btnw right"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw right"&gt;
    &lt;a href="/mana/crxs" &gt;返回&lt;/a&gt;
&lt;/span&gt;
</t>
<t tx="zoomq.20120812115324.4332">
&lt;li class="textarea1"&gt;
&lt;span class="label leftlabel"&gt;名称:&lt;/span&gt;
    &lt;textarea name="name" id="name" 
    class="required min-length_2" title="扩展 名称必填!且长过4字!"
    rows="1" /&gt;{{ crx.name }}&lt;/textarea&gt;
&lt;/li&gt;

&lt;li class="textarea3"&gt;
&lt;span class="label leftlabel"&gt;描述:&lt;/span&gt;
&lt;textarea name="desc" id="desc" 
    class="required min-length_13" title="扩展 描述必填!且长过13字!"
    rows="3" /&gt;{{ crx['desc'] }}&lt;/textarea&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;版本:&lt;/span&gt;
&lt;input type="text" name="version" id="version" value="{{ crx['version'] }}"
    readonly/&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;推荐?&lt;/span&gt;
&lt;input type="checkbox" class="checkbox"
    name="isreco" id="isreco" 
     {% if crx.isreco == 1 %}
    checked
     {% endif %}
    value="isreco"/&gt;
&lt;/li&gt;

&lt;li class="textarea3"&gt;
&lt;span class="label leftlabel"&gt;详情:&lt;/span&gt;
&lt;textarea name="detail" id="detail" 
    class="" title=""
    rows="3" n/&gt;{{ crx['detail'] }}&lt;/textarea&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;下载:&lt;/span&gt;
&lt;input type="text" name="dlrank" id="dlrank" value="{{ crx['dlrank'] }}"
    class="numeric" title="下载量必须为整数"/&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;图片追加:&lt;/span&gt;
&lt;input type="file" name="picture" id="picture" 
    class=""  title="!"/&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;G.下载:&lt;/span&gt;
&lt;input type="text" name="gsdl" id="gsdl" value="{{ crx['gsdl'] }}"
    class="numeric" title="G.下载量必须为整数"/&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;G.活跃用户数:&lt;/span&gt;
&lt;input type="text" name="gsusr" id="gsusr" value="{{ crx['gsusr'] }}"
    class="numeric" title="活跃量必须为整数"/&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;G.Rank:&lt;/span&gt;
&lt;input type="text" name="gsrank" id="gsrank" value="{{ crx['gsrank'] }}"
    class="numeric" title="Rank必须为整数"/&gt;
&lt;/li&gt;
</t>
<t tx="zoomq.20120812115324.4334">{% set sspath4pic = "http://lb4crx-pic2lb.stor.sinaapp.com" %}
{% set sspath4crx = "http://lb4crx-crx4lb.stor.sinaapp.com" %}
</t>
<t tx="zoomq.20120812211216.4323">crtgrp = KV.get(crx['grpid'])
page = template('gencrx.html'
    , crx = crx
    , grp = crtgrp
    )
#print page
sid, uri = PUT2SS(page.encode('utf-8'), crx['id'], 'html')
#print sid, uri

crx['pageuri'] = uri
</t>
<t tx="zoomq.20120820121523.7051">@APP.route('/js/&lt;AJS&gt;', method='GET')
@APP.route('/js/&lt;AJS&gt;', method='OPTIONS')
def apijs(AJS):
    print request.headers.keys()
    print "{'api':'/js','GET':%s}"% AJS
    result = {}
    result['method'] = "OPTIONS"
    result['q'] = AJS
    response.set_header('Access-Control-Allow-Origin', '*')
    response.set_header('Access-Control-Allow-Headers', 'x-requested-with')
    response.set_header('Content-Type','application/json; charset=utf-8')
    return result
    #return "callback($scope,['%s','%s'])"%('GET',AJS)
    



</t>
<t tx="zoomq.20120820121523.7054">@APP.route('/js/get/&lt;AJS&gt;', method='GET')
def apijs(AJS):
    print request.headers.keys()
    print "{'api':'/js','GET':%s}"% AJS
    result = {}
    result['method'] = "OPTIONS"
    result['q'] = AJS
    #result.append("GET")
    #result.append(AJS)
    #response.set_header("Cache-Control", "no-cache");
    response.set_header('Access-Control-Allow-Origin', '*')
    response.set_header('Access-Control-Allow-Headers', 'x-requested-with')
    #response.set_header('Content-Type','application/json')
    return "callback($scope,['%s','%s'])"%('GET',AJS)
    
    



</t>
<t tx="zoomq.20120820121523.7421">@APP.route('/dc/&lt;uuid&gt;', method='GET')
def apidc(uuid):
    #print "\t&gt;&gt;&gt;GET"
    result = {}
    crx = KV.get(uuid)
    if crx:
        crx['dlrank'] = int(crx['dlrank'])
        #KV.set(uuid, crx)
        result['dc'] = crx['dlrank']
        result['success'] = 1
    else:
        result['msg'] = "%s NOT exist!"
        result['success'] = 0
    result['method'] = "GET"
    response.set_header('Access-Control-Allow-Origin', '*')
    response.set_header('Access-Control-Allow-Headers', 'x-requested-with')
    response.set_header('Content-Type','application/json; charset=utf-8')
    return result
    #return "callback($scope,['%s','%s'])"%('GET',AJS)
    


</t>
<t tx="zoomq.20120820121523.7422">@language python
@tabwidth -4
# -*- coding: utf-8 -*-
&lt;&lt;declarations&gt;&gt;

@others

</t>
<t tx="zoomq.20120820121523.7423">'''base: ms4py / bottle-wiki / source — Bitbucket
	https://bitbucket.org/ms4py/bottle-wiki/src/1586473a6ce1/auth.py
'''
from bottle import request, HTTPError
from functools import partial
from hashlib import sha256

from config import CFG

import sae.kvdb
KV = sae.kvdb.KVClient()

</t>
<t tx="zoomq.20120820121523.7424">def check_login(username, password, fullpath):
    '''根据用户名,以及口令:
        - 明确是否登录
        - 明确是否有当前级别的权限!
    '''
    pw_hash = sha256_uhex(password)
    suname = sha256_uhex(username)
    usrid = "%s%s"% (CFG.PREUID, suname)
    crtusr = KV.get(usrid)
    #print fullpath.split("/")[1]
    #print type(CFG.LEVEL4USR[fullpath.split("/")[1]])
    #print type(crtusr['level'])
    if crtusr:
        crtPathLevel = CFG.LEVEL4USR[fullpath.split("/")[1]]
        if str(crtPathLevel) == str(crtusr['level']):
            print "'%s' had crt. path right ;-)"% username
            return True
        else:
            print "'%s' disallow crt. path ;-("% username
            return False
    else:
        print "'%s' NOT exist!"% username
        return False
    '''
    #print fullpath.split("/")[1]
    print CFG.LEVEL4USR[fullpath.split("/")[1]]
    usr = 1#KV.get("usr:%s"% str(sha256_uhex(username.decode('utf-8'))))
    if usr is None:
        return False
    #return usr.password == pw_hash
    return 1
    '''

</t>
<t tx="zoomq.20120820121523.7425">def auth_required(check_func=check_login, realm='bottle-authentication'):
    """
    Decorator for basic authentication. 
    
    "check_func" has to be a callable object with two 
    arguments ("username" and "password") and has to return 
    a bool value if login was sucessful or not.
    """
    def decorator(view):
        def wrapper(*args, **kwargs):
            try:
                user, password = request.auth
            except (TypeError, AttributeError):
                # catch AttributeError because of bug in bottle
                auth = False
            else:
                auth = check_login(user, password, request.fullpath)
                #print "\t path: ", request.keys()
                #print request.fullpath
            if auth:
                return view(*args, **kwargs)
            return HTTPError(401, 'Access denied!', 
                header={'WWW-Authenticate': 'Basic realm="%s"' % realm})
        return wrapper
    return decorator

</t>
<t tx="zoomq.20120820121523.7426">def sha256_uhex(data):
    ''' Generates unicode hex value of given data with SHA-256. '''
    return str(unicode(sha256(data).hexdigest()))
</t>
<t tx="zoomq.20120820121523.7432">@language python
@tabwidth -4
# -*- coding: utf-8 -*-
&lt;&lt;declarations&gt;&gt;

import pprint
pp = pprint.PrettyPrinter(indent=4)

# init all var
CFG = Borg()

@others

if __name__ == '__main__':
    if 4 != len(sys.argv) :
        print '''Usage:
    $ lb4crx2cli.py usr[add|del|mod|chk] 用户名:口令:级别 http://XX.XX.XX
    or
    $ lb4crx2cli.py crx[mod|chk|info] UUID:属性:值 http://XX.XX.XX
        '''
    else:
        mod = sys.argv[1]
        act = sys.argv[2]
        uribase = sys.argv[3]
        #print mod, act, uribase
        #print dir(CFG)
        call2sae(mod, act, uribase)


</t>
<t tx="zoomq.20120820121523.7433">import sys
import time
import base64
import urllib2 as urilib
from hashlib import md5
from base64 import urlsafe_b64encode

from config import CFG
@others


</t>
<t tx="zoomq.20120820121523.7437">def __genRESTargs(usract):
    args = "%s"% usract
    args += "/%s"% CFG.APPKEY       #"appkey=" + 
    args += "/%d"% time.time()      #"&amp;timestamp=" + 
    sign_base_string = "%s/%s"% (CFG.APITYPE, args)
    args += "/%s"% __genRESTsign(sign_base_string)
    #md5(sign_base_string + CFG.SECRET).hexdigest() #"&amp;sign=" + 
    return args</t>
<t tx="zoomq.20120820121523.7438">class Borg():
    '''base http://blog.youxu.info/2010/04/29/borg
        - 单例式配置收集类
    '''
    __collective_mind = {}
    def __init__(self):
        self.__dict__ = self.__collective_mind
    APPKEY = "5t4r3e2w1q"
    SECRET = "99fc9fdbc6761f7d898ad25762407373"
    APITYPE = "api/cli"
    PREUID = "usr:"




</t>
<t tx="zoomq.20120820121523.7439">def call2sae(mod, act, uribase):
    todo = mod
    #uname, passwd = act.split(":")
    usract = act
    aimurl = "%s/%s/%s/%s"% (uribase
        , CFG.APITYPE
        , todo
        , __genRESTargs(usract)
        )
    print aimurl
    #print urilib.urlopen(aimurl).read()
    #return
    result = urilib.urlopen(aimurl).read()
    #print eval(result)
    pp.pprint(eval(result))
    </t>
<t tx="zoomq.20120820121523.7441">@APP.route('/cli/&lt;actype&gt;/&lt;usract&gt;/&lt;APPKEY&gt;/&lt;tstamp&gt;/&lt;ssing&gt;')
def apicliusr(actype, usract, APPKEY, tstamp, ssing):
    args = "%s"% usract
    args += "/%s"% CFG.APPKEY       #"appkey=" + 
    args += "/%d"% time.time()      #"&amp;timestamp=" + 
    sign_base_string = "%s/%s"% (CFG.APITYPE, args)
    #resign = __genRESTsign(sign_base_string)
    result = {}
    if ssing == __genRESTsign(sign_base_string):
        result['success'] = 1
        if "usr" == actype[:3]:
            #print "USR matters"
            &lt;&lt;USR matters&gt;&gt;
        elif "crx" == actype[:3]:
            #print "CRX matters"
            &lt;&lt;CRX matters&gt;&gt;
        @others 
    else:
        result['success'] = 0
        result['errno'] = -2
    #pp.pprint(result)
    return result
    #return template('api.tpl')
    #redirect('/api/%s/sysincr'% 123)


#api/cli/ADD/up/up/5t4r3e2w1q/1345544583/a7a9cbd1c9e32dd40d7276780a692d19
</t>
<t tx="zoomq.20120820121523.7442">def __genRESTsign(args):
    sign_base_string = "%s/%s"% (CFG.APITYPE, args)
    return md5(sign_base_string + CFG.SECRET).hexdigest()</t>
<t tx="zoomq.20120820121523.7443">APPKEY = "5t4r3e2w1q"
SECRET = "99fc9fdbc6761f7d898ad25762407373"
APITYPE = "api/cli"
PREUID = "usr:"
MSG4PW = {'add':"created new usr"
    , 'del':"deleted new usr"
    , 'mod':"modified usr info."
    , 'chk':"listing all usr"
    }
MSG4CRX = {'mod':"fixed .crx info."
    , 'chk':"listing all .crx"
    , 'info':"all info. of one .crx"
    , 'err':"something is ERROR!"
    }

LEVEL4USR = {"mana":0
    , "up":1
    , "api":2
    }</t>
<t tx="zoomq.20120820121523.7444">#各种 命令行工具的响应支持!

@others

'''如果 API 调用成功:
    {"success": 1, "data": $data, "msg": $msg}
    调用失败,返回一个 json 字符串:
    {"success": 0, "errno": $errno, "msg": $msg}
$errno 	$msg 	说明
-1 	AppKeyError 	应用的key不存在或者key已经失效
-2 	SignError 	无效的签名
-3 	$server_timestamp 	无效的时间戳。$server_timestamp是服务器当前的时间戳
-4 	CountLimit 	超过当天查询次数限制
-5 	SpeedLimit 	查询过于频繁
-6 	ArgFormatError 查询参数格式错误，例如某些API我们要求对参数进行base64编码，如果base64编码错误，服务器将返回此错误提示
-7 	$arg 	缺少必需的查询参数。$arg说明所缺少的具体参数名
-8 	ServerBusyError 	服务器繁忙
-9 	ConflictStamp 	重复的时间戳
'''</t>
<t tx="zoomq.20120820121523.7445">uname, passwd, level = usract.split(":")
#print uname, passwd, level
suname = sha256_uhex(uname)
spasswd = sha256_uhex(passwd)
usrid = "%s%s"% (CFG.PREUID, suname)
print usrid
if KV.get(usrid):
    if "usradd" == actype:
        if KV.get(usrid):
            result['msg'] = CFG.MSG4PW['mod']
            _usrset(usract)
        else:
            result['msg'] = CFG.MSG4PW['add']
            _usradd(usract)

    elif "usrdel" == actype:
        result['msg'] = CFG.MSG4PW['del']
        usr =  KV.get(usrid)
        usr['isdel'] = 1
        KV.set(usrid, usr)
    elif "usrmod" == actype:
        result['msg'] = CFG.MSG4PW['mod']
        _usrset(usract)
    elif "usrchk" == actype:
        result['msg'] = CFG.MSG4PW['chk']
        result['data'] = _usrchk()
else:
    #print actype
    result['msg'] = CFG.MSG4PW['add']
    _usradd(usract)


'''
objUSR = {'id':None # "usr:"+unicode(sha256(用户名).hexdigest())
    ,'crxs':[]
    ,'name':""
    ,'passwd':""    # unicode(sha256(口令).hexdigest())
    ,'isdel':0      # 是否删除
    ,'level':0      # 0|1 管理|团队
}
'''</t>
<t tx="zoomq.20120821205456.4726">def _usradd(usract):
    uname, passwd, level = usract.split(":")
    suname = sha256_uhex(uname)
    spasswd = sha256_uhex(passwd)
    usrid = "%s%s"% (CFG.PREUID, suname)
    
    usr =  deepcopy(CFG.objUSR)
    usr['id'] = usrid
    usr['name'] = uname
    usr['passwd'] = spasswd
    usr['level'] = level
    KV.set(usrid, usr)
    
    k4usrs, crtusrs = INIobjSYS('usr')
    crtusrs.append(usrid)
    #print crtusrs
    KV.set(k4usrs, crtusrs)
    </t>
<t tx="zoomq.20120821205456.4728">def _usrset(usract):
    uname, passwd, level = usract.split(":")
    suname = sha256_uhex(uname)
    spasswd = sha256_uhex(passwd)
    usrid = "%s%s"% (CFG.PREUID, suname)
    
    usr =  KV.get(usrid)
    usr['passwd'] = spasswd
    usr['level'] = level
    KV.set(usrid, usr)

</t>
<t tx="zoomq.20120821205456.4729">def _usrchk():
    '''chk and export all SYS:user
    '''
    k4usrs, crtusrs = INIobjSYS('usr')
    return crtusrs</t>
<t tx="zoomq.20120821205456.4730">uuid, attribute, value = usract.split(":")
print uuid, attribute, value

if "crxmod" == actype:
    try:
        result['msg'] = CFG.MSG4CRX['mod']
        &lt;&lt;crx下载数调整&gt;&gt;
    except:
        result['msg'] = "&gt;&gt;&gt;%s apicliusr \n\t%s"% (CFG.MSG4CRX['err']
            ,traceback.print_exc())
        print "&gt;&gt;&gt;apicliusr \n\t", traceback.print_exc()
elif "crxchk" == actype:
    result['msg'] = CFG.MSG4CRX['chk']
    &lt;&lt;crx统计信息&gt;&gt;
elif "crxinfo" == actype:
    result['msg'] = CFG.MSG4CRX['info']
    &lt;&lt;crx单独信息&gt;&gt;

</t>
<t tx="zoomq.20120821205456.4732">def _xinfo(crxs):
    info = []
    for uuid in crxs:
        crx = KV.get(uuid)
        info.append([uuid
            , crx['name']
            , crx['version']
            , crx['dlrank']
            ])
    return info</t>
<t tx="zoomq.20120821205456.4733">&lt;sup&gt;v{{ x.version }} [dl={{ x.dlrank }}] {{ x.uuid }}&lt;/sup&gt;</t>
<t tx="zoomq.20120821205456.4734">
k4crx, crcrxs = INIobjSYS('crx')
k4try, crtrys = INIobjSYS('try')
k4out, crouts = INIobjSYS('out')
k4bak, crbaks = INIobjSYS('bak')
k4arc, crarch = INIobjSYS('arch')
xinfo = {}
xinfo['pub'] = {'sum':len(crcrxs)
    ,'crx':_xinfo(crcrxs)
    }
xinfo['try'] = {'sum':len(crtrys)
    ,'crx':_xinfo(crtrys)
    }
xinfo['out'] = {'sum':len(crouts)
    ,'crx':_xinfo(crouts)
    }
xinfo['bak'] = {'sum':len(crbaks)
    ,'crx':_xinfo(crbaks)
    }
xinfo['arch'] = {'sum':len(crarch)
    ,'crx':_xinfo(crarch)
    }

result['data'] = xinfo
#pp.pprint(result)
</t>
<t tx="zoomq.20120821205456.4735">crx = KV.get(uuid)
print crx[attribute]
crx[attribute] = value
KV.set(uuid, crx)
result['data'] = [uuid,attribute,value]
</t>
<t tx="zoomq.20120821205456.4736">crx = KV.get(uuid)
result['data'] = _json(crx)
</t>
<t tx="zoomq.20120821205456.4738">def _json(crx):
    info = {}
    for k in crx.keys():
        if crx[k]:
            info[k] = crx[k]
        else:
            info[k] = "None"
    return info</t>
<t tx="zoomq.20120821205456.5115"></t>
<t tx="zoomq.20120821205456.5116">@language html
{% extends "base.html" %}
{% block title4act %}
GROUPed.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;原创团队, 编辑&lt;/legend&gt;
&lt;form action="/mana/grp/{{ grp.id }}/info" method="post" class="validate"&gt;
@others
&lt;/form&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120821205456.5117">&lt;ul class="asform"&gt;
&lt;li class=""&gt;
&lt;span class="label"&gt;名称:&lt;/span&gt;
&lt;input type="text" name="name" id="name" value="{{ grp['name'] }} "
    class="required min-length_4" title="团队 名称必填!且长过4字!"/&gt;
&lt;li/&gt;
&lt;li class="textarea3"&gt;
&lt;span class="label leftlabel"&gt;描述:&lt;/span&gt;
&lt;textarea rows="3" name="desc" id="desc" 
    class="required min-length_13" title="团队描述 必填!且长过13字!"/&gt;
    {{ grp['desc'] }}
&lt;/textarea&gt;
&lt;li/&gt;
&lt;li class=""&gt;
&lt;span class="label"&gt;leader:&lt;/span&gt;
&lt;input type="text" name="lead" id="lead" value="{{ grp['lead'] }} "/&gt;
&lt;li/&gt;
&lt;li class=""&gt;
&lt;span class="label"&gt;weibo:&lt;/span&gt;
&lt;input type="text" name="weibo" id="weibo" value="{{ grp['weibo'] }} "/&gt;
&lt;li/&gt;
&lt;li class=""&gt;
&lt;span class="label"&gt;e-mail:&lt;/span&gt;
&lt;input type="text" name="mail" id="mail" value="{{ grp['mail'] }} "/&gt;
&lt;li/&gt;
&lt;/ul&gt;
    &lt;br/&gt;
</t>
<t tx="zoomq.20120821205456.5118">    &lt;br/&gt;
    &lt;hr/&gt;
&lt;span id="reply_submit" class="btnw right"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw right"&gt;
    &lt;a href="/mana/grps" &gt;返回&lt;/a&gt;
&lt;/span&gt;

&lt;i&gt;
id: {{ grp['id'] }} 
;order: {{ grp['order'] }} 
&lt;/i&gt;</t>
<t tx="zoomq.20120821205456.5119">@language html
{% extends "base.html" %}
{% block title4act %}
GROUPinfo.
    {% endblock title4act %}
{% block headJS %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;原创团队, 信息&lt;/legend&gt;


@others

&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120821205456.5120">&lt;span class="label"&gt;名称:&lt;/span&gt;{{ grp['name'] }}
    &lt;br/&gt;
&lt;span class="label"&gt;描述:&lt;/span&gt;&lt;pre class="desc"&gt;{{ grp.desc }}
&lt;/pre&gt;
    &lt;br/&gt;
&lt;span class="label"&gt;leader:&lt;/span&gt;{{ grp.lead }}
    &lt;br/&gt;
&lt;span class="label"&gt;weibo:&lt;/span&gt;{{ grp.weibo }}
    &lt;br/&gt;
&lt;span class="label"&gt;e-mail:&lt;/span&gt;{{ grp.mail }}
    &lt;br/&gt;</t>
<t tx="zoomq.20120821205456.5121">{% if crxs is not none %}
&lt;span class="label"&gt;已发布.crx:&lt;/span&gt;
{% for crx in crxs %}
    &lt;a href="/mana/crx/{{ crx.uuid }}"&gt;{{ crx.name }}&lt;/a&gt; ; 
{% endfor %}
    &lt;br/&gt;
{% endif %}

{% if trys is not none %}
&lt;span class="label"&gt;待发布.crx:&lt;/span&gt;
{% for crx in trys %}
    &lt;a href="/mana/crx/{{ crx.uuid }}"&gt;{{ crx.name }}&lt;/a&gt; ; 
{% endfor %}
    &lt;br/&gt;
{% endif %}

{% if outs is not none %}
&lt;span class="label"&gt;被下架.crx:&lt;/span&gt;
{% for crx in outs %}
    &lt;a href="/mana/crx/{{ crx.uuid }}"&gt;{{ crx.name }}&lt;/a&gt; ; 
{% endfor %}
    &lt;br/&gt;
{% endif %}
</t>
<t tx="zoomq.20120821205456.5122">&lt;br/&gt;&lt;hr/&gt;

&lt;span id="reply_submit" class="btnw"&gt;
    &lt;a href="/mana/grp/{{ grp.id }}/ed" &gt;编辑&lt;/a&gt;
&lt;/span&gt;
&lt;span id="del_submit" class="btnw"&gt;
    &lt;a href="/mana/grp/{{ grp.id }}/del" &gt;删除&lt;/a&gt;
&lt;/span&gt;
&lt;span id="back_submit" class="btnw"&gt;
    &lt;a href="/mana/grps" &gt;返回&lt;/a&gt;
&lt;/span&gt;

    &lt;br/&gt;
&lt;i&gt;
id: {{ grp['id'] }} 
;order: {{ grp['order'] }} 
&lt;/i&gt;</t>
<t tx="zoomq.20120821205456.5123">@language html
{% extends "base.html" %}

{% block title4act %}
GROUPs
    {% endblock title4act %}

{% block headJS %}
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
    {% if grps is none %}
            &lt;b&gt;还未有任何原创团队!&lt;/b&gt;
            &lt;fieldset&gt;
            &lt;legend&gt;初始化个;-}&lt;/legend&gt;
            &lt;&lt;1st GRP&gt;&gt;            
            &lt;/fieldset&gt;
    {% else %}
            &lt;h2&gt;原创团队s::&lt;/h2&gt;
                &lt;&lt;GRP li&gt;&gt;
                &lt;hr/&gt;
            &lt;fieldset&gt;
            &lt;legend&gt;追加;-}&lt;/legend&gt;
            &lt;&lt;1st GRP&gt;&gt;            
            &lt;/fieldset&gt;
    {% endif %}
        
{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20120821205456.5124">&lt;form action="/mana/grp/ini" method="post"  
    id="inigrpform" name="inigrpform" class="validate"&gt;
名称:&lt;input type="text" name="name" id="name" 
    class="required min-length_4" title="团队名称必填!且长过4字!"/&gt;
  &lt;br/&gt;
描述:&lt;textarea name="desc" id="desc" 
    class="required min-length_7" title="团队描述 必填!且长过7字!"
    rows="3"/&gt;......&lt;/textarea&gt;

  &lt;br/&gt;
&lt;span id="reply_submit" class="btnw right"&gt;
    &lt;button type="submit" name="submit" class="action" &gt;就酱&lt;/button&gt;
&lt;/span&gt;
&lt;/form&gt;
</t>
<t tx="zoomq.20120821205456.5125">&lt;ul&gt;
{% for g in grps %}
&lt;li id="iterm" class="{{ loop.cycle('odd', 'even') }}"&gt;&lt;a href="/mana/grp/{{ g.id }}" title="{{ g.desc }}"&gt;{{ g.name }}&lt;/a&gt;
    &lt;sub&gt;
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/grp/{{ g.id }}/ed" &gt;改&lt;/a&gt;
    &lt;/span&gt;
    &lt;span class="btnwa"&gt;
        &lt;a href="/mana/grp/{{ g.id }}/del" &gt;删&lt;/a&gt;
    &lt;/span&gt;
    &lt;/sub&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</t>
<t tx="zoomq.20120821205456.5126">@APP.route('/usrs')
@auth_required()
def usrs():
    sysk, crusrs = INIobjSYS('usr')
    if 0 == len(crusrs):
        objusrs = None
    else:
        objusrs = []
        for uid in crusrs:
            #print uid
            #print KV.get(uid)
            objusrs.append(KV.get(uid))
    return template('authors.html', usrs=objusrs)

</t>
<t tx="zoomq.20120821205456.5127"></t>
<t tx="zoomq.20121015120918.6085">@APP.route('/crx/ini', method='POST')
def inicrx():
    '''初始/升级 .crx   realy ACTION:
        - chk manifest.json info:
            - if  uuid exist AND ver is up -&gt;  
                + copy as x:id -&gt; historic KVobj
                + up ver/desc/name
            - else -&gt;
                + creat new crx KVobj
        - deepcopy(CFG.objCRX) set var with .crx
            - append uuid into CFG.K4D['uuid']
            - append uuid into CFG.K4D['try']
        - jump into /crx/x:id/info
    '''
    crxfile = request.files.get('crxfile', None) #request.files.get('data')
    if crxfile is not None:
        &lt;&lt;crx upload&gt;&gt;
        
    uri = "/mana/crx/%s"% uuid
    #print uri
    response.set_header('location', uri)
    response.status = 303
    #   redirect NOT WORK! abt.
    #redirect("/crx/%s/info"% tid, code=303)
    #https://github.com/defnull/bottle/issues/236
    #https://groups.google.com/forum/#!topic/bottlepy/RQV3B7ACiNk/discussion
    return None


</t>
<t tx="zoomq.20121015120918.6086">#filename = crxfile.filename
uuid = crx_id.GetCRXAppID4upload(crxfile.file)
#print '\tAppID:\t%s' % uuid
#   read manifest.json from crx file
zz = zipfile.ZipFile(crxfile.file, "r")
manifest = zz.open("manifest.json").read()
#   fixed error JSON format from:"夜间模式.crx"
manifest.replace("\r\n","")
#print manifest
&lt;&lt;read JSON&gt;&gt;
#json = eval(manifest)
#json = JSON.loads(manifest.decode('utf-8'))
if KV.get(uuid):
    crtcrx = KV.get(uuid)
    if json['version'] == crtcrx['version']:
        # not any upgrade?!
        redirect("/mana/crx/%s/duplicate"% uuid)
    else:
        # update try...
        &lt;&lt;upgrade crx&gt;&gt;
else:
    #   new .crx ;-)
    raw = crxfile.file.read() # This is dangerous for big files
    sid, uri = PUT2SS(raw, uuid, 'sae')
    crxfile.file.close()
    #print "\tdata.file.closed? ", data.file.closed
    &lt;&lt;set KV&gt;&gt;
    crcrxs, crtrys, crouts, crbaks, crarch, ctcapi = KV4CRX(uuid, "ini")

    '''
    sskey = "%s.crx"% GENID('sae', uuid) #"%s-%s.crx"% (uuid, TSTAMP())
    #   初始化一个Storage客户端。
    ss = sae.storage.Client()
    ob = sae.storage.Object(raw)
    ss.put(CFG.D2X, sskey, ob)
    '''
#print "\tdata.file.closed? ", data.file.closed
#LIST所有的domain
#print ss.list_domain()
#print "\tcrx4lb inc files:", len(ss.list(CFG.D2X))
#print ss.url(CFG.D2X, sskey)

</t>
<t tx="zoomq.20121015120918.6087">json = {}
for l in manifest.split(','):
    if '"name":' in l:
        #print l
        json['name'] = l.split(':')[1].split("\"")[1]
    elif '"version":' in l:
        print l
        json['version'] = l.split(':')[1].split("\"")[1]
        #print l.split(':')[1][2:-1]
    elif '"description":' in l:
        #print l
        json['description'] = l.split(':')[1].split("\"")[1]
    else:
        pass

#print "\t", json['name'], json['description'], json['version']
#return None</t>
<t tx="zoomq.20121015120918.6088">#print "\n TRY update by uploading..."
crx4update = deepcopy(crtcrx)
#   120822 fixed by:UnicodeDecodeError - PythonInfo Wiki
#	http://wiki.python.org/moin/UnicodeDecodeError
crx4update['name'] = json['name'].decode('utf-8', "replace")
crx4update['desc'] = json['description'].decode('utf-8', "replace")
crx4update['version'] = json['version']
#hid = PUTHIS(crtcrx, "U")
#crx4update['hisid'] = crx4update['hisid'].append(hid)
raw = crxfile.file.read() # This is dangerous for big files
sid, uri = PUT2SS(raw, uuid, 'sae')
crx4update['sid'] = sid
crxfile.file.close()
KV.set(uuid, crx4update)
#print KV.get(uuid)
xid = crx4update['id']
</t>
<t tx="zoomq.20121015120918.6089">crx = deepcopy(CFG.objCRX)
xid = GENID('crx')
crx['id'] = xid
crx['uuid'] = uuid
crx['sid'] = sid
#hid = PUTHIS(crx, "C")
#crx['hisid'] = crx['hisid'].append(hid)
crx['name'] = json['name'].decode('utf-8', "replace")
crx['desc'] = json['description'].decode('utf-8', "replace")
crx['version'] = json['version']
#print crx
KV.add(uuid, crx)
</t>
<t tx="zoomq.20121015120918.6096">@language html
{% extends "base.html" %}
{% block title4act %}
CRXed.
    {% endblock title4act %}
{% block headJS %} 
    {% include 'validatious.html' %} 
{% endblock%}

{% block mainbody %}
&lt;fieldset&gt;
&lt;legend&gt;用户脚本, 提交&lt;/legend&gt;
&lt;form action="/mana/crx/jsup" method="post"
    enctype="multipart/form-data"
    id="inicrxform" name="inicrxform" class="validate"&gt;
    
@others
&lt;/form&gt;
&lt;/fieldset&gt;

{% endblock mainbody %}



{% block footernav %}
    {% include 'manav.html' %} 
    {% endblock footernav %}

</t>
<t tx="zoomq.20121015120918.6097">
&lt;&lt;操作按钮&gt;&gt;
&lt;br/&gt;&lt;hr/&gt;
&lt;&lt;.js&gt;&gt;
&lt;ul class="asform"&gt;
&lt;&lt;详情&gt;&gt;
&lt;&lt;标签选列&gt;&gt;
&lt;&lt;团队选列&gt;&gt;
&lt;/ul&gt;
&lt;br/&gt;&lt;hr/&gt;
&lt;&lt;操作按钮&gt;&gt;
    


    &lt;br/&gt;
&lt;i&gt;
id: {{ crx['id'] }} 
; uuid: {{ crx['uuid'] }} 
; {{ crx.name }}
&lt;/i&gt;


</t>
<t tx="zoomq.20121015120918.6098">&lt;span id="reply_submit" class="btnw right"&gt;
    &lt;button type="submit" name="submit" &gt;就酱&lt;/button&gt;
&lt;/span&gt;

&lt;span id="back_submit" class="btnw right"&gt;
    &lt;a href="/mana/crxs" &gt;返回&lt;/a&gt;
&lt;/span&gt;
</t>
<t tx="zoomq.20121015120918.6099">&lt;li class="textarea1"&gt;
&lt;span class="label leftlabel"&gt;UUID:&lt;/span&gt;
    &lt;textarea name="uuid" id="uuid" 
    class="required min-length_4" title="扩展 UUID 必填!且长过24字!"
    rows="1" /&gt;{{ crx.uuid }}&lt;/textarea&gt;
&lt;/li&gt;

&lt;li class="textarea1"&gt;
&lt;span class="label leftlabel"&gt;名称:&lt;/span&gt;
    &lt;textarea name="name" id="name" 
    class="required min-length_2" title="扩展 名称必填!且长过4字!"
    rows="1" /&gt;{{ crx.name }}&lt;/textarea&gt;
&lt;/li&gt;

&lt;li class="textarea3"&gt;
&lt;span class="label leftlabel"&gt;描述:&lt;/span&gt;
&lt;textarea name="desc" id="desc" 
    class="required min-length_13" title="扩展 描述必填!且长过13字!"
    rows="3" /&gt;{{ crx['desc'] }}&lt;/textarea&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;版本:&lt;/span&gt;
&lt;input type="text" name="version" id="version" value="{{ crx['version'] }}"
    /&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;推荐?&lt;/span&gt;
&lt;input type="checkbox" class="checkbox"
    name="isreco" id="isreco" 
     {% if crx.isreco == 1 %}
    checked
     {% endif %}
    value="isreco"/&gt;
&lt;/li&gt;

&lt;li class="textarea3"&gt;
&lt;span class="label leftlabel"&gt;详情:&lt;/span&gt;
&lt;textarea name="detail" id="detail" 
    class="" title=""
    rows="3" n/&gt;{{ crx['detail'] }}&lt;/textarea&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;下载:&lt;/span&gt;
&lt;input type="text" name="dlrank" id="dlrank" value="{{ crx['dlrank'] }}"
    class="numeric" title="下载量必须为整数"/&gt;
&lt;/li&gt;

&lt;!--

&lt;li class=""&gt;
&lt;span class="label"&gt;图片追加:&lt;/span&gt;
&lt;input type="file" name="picture" id="picture" 
    class=""  title="!"/&gt;
&lt;/li&gt;
&lt;li class=""&gt;
&lt;span class="label"&gt;G.下载:&lt;/span&gt;
&lt;input type="text" name="gsdl" id="gsdl" value="{{ crx['gsdl'] }}"
    class="numeric" title="G.下载量必须为整数"/&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;G.活跃用户数:&lt;/span&gt;
&lt;input type="text" name="gsusr" id="gsusr" value="{{ crx['gsusr'] }}"
    class="numeric" title="活跃量必须为整数"/&gt;
&lt;/li&gt;

&lt;li class=""&gt;
&lt;span class="label"&gt;G.Rank:&lt;/span&gt;
&lt;input type="text" name="gsrank" id="gsrank" value="{{ crx['gsrank'] }}"
    class="numeric" title="Rank必须为整数"/&gt;
&lt;/li&gt;
--&gt;
</t>
<t tx="zoomq.20121015120918.6100">&lt;li class=""&gt;
&lt;span class="label"&gt;标签:&lt;/span&gt;
{% for t in tags %}

&lt;input type="checkbox" class="checkbox"
    name="tags" id="tags" 
     {% if t.id in crx.tagid %}
    checked
     {% endif %}
    value="{{ t.id }}"/&gt;
    &lt;label for="{{ t.id }}"&gt;{{ t.name }}&lt;/label&gt;

{% endfor %}

&lt;/li&gt;
</t>
<t tx="zoomq.20121015120918.6101">&lt;li class=""&gt;
&lt;span class="label"&gt;团队:&lt;/span&gt;
{% for g in grps %}

&lt;input type="radio" class="checkbox"
    name="grp" id="grp"
     {% if crx.grpid is not none %}
         {% if g.id == crx.grpid %}
        checked
         {% endif %}
    {% endif %}
    value="{{ g.id }}"/&gt;
    &lt;label for="{{ g.id }}"&gt;{{ g.name }}&lt;/label&gt;

{% endfor %}

&lt;/li&gt;
</t>
<t tx="zoomq.20121015120918.6102">.js &lt;input type="file" name="ujsfile" id="ujsfile" 
    class="required"  title="扩展文件必选!"/&gt;
</t>
<t tx="zoomq.20121015120918.6108">@APP.route('/crx/jsup', method='POST')
def jsup():
    '''初始/升级 .js   realy ACTION:
        - 填写 UUID 
        - deepcopy(CFG.objCRX) set var with .crx
            - append uuid into CFG.K4D['uuid']
            - append uuid into CFG.K4D['try']
        - jump into /crx/x:id/info
    '''
    ujsfile = request.files.get('ujsfile') #request.files.get('data')
    if ujsfile is not None:
        &lt;&lt;ujsfile upload&gt;&gt;
    
    uri = "/mana/crx/%s"% uuid
    #print uri
    response.set_header('location', uri)
    response.status = 303
    #   redirect NOT WORK! abt.
    #redirect("/crx/%s/info"% tid, code=303)
    #https://github.com/defnull/bottle/issues/236
    #https://groups.google.com/forum/#!topic/bottlepy/RQV3B7ACiNk/discussion
    return None


</t>
<t tx="zoomq.20121015120918.6109">uuid = request.forms.get('uuid')
name = request.forms.get('name')
desc = request.forms.get('desc')
detail = request.forms.get('detail')
version = request.forms.get('version')
isreco = request.forms.get('isreco', 'noreco')
#print isreco
dlrank = request.forms.get('dlrank')

if KV.get(uuid):
    crtcrx = KV.get(uuid)
    if version == crtcrx['version']:
        # not any upgrade?!
        redirect("/mana/crx/%s/duplicate"% uuid)
    else:
        # update try...
        &lt;&lt;upgrade crx&gt;&gt;
else:
    #   new .js ;-)
    raw = ujsfile.file.read() # This is dangerous for big files
    #print raw
    sid, uri = PUT2SS(raw, uuid, 'sae')
    ujsfile.file.close()
    #print "\tdata.file.closed? ", data.file.closed
    &lt;&lt;set KV&gt;&gt;
    crcrxs, crtrys, crouts, crbaks, crarch, ctcapi = KV4CRX(uuid, "ini")
</t>
<t tx="zoomq.20121015120918.6111">#print "\n TRY update by uploading..."
crx4update = deepcopy(crtcrx)
#   120822 fixed by:UnicodeDecodeError - PythonInfo Wiki
#	http://wiki.python.org/moin/UnicodeDecodeError
crx4update['name'] = name.decode('utf-8', "replace")   #'].decode('utf-8', "replace")
crx4update['desc'] = desc.decode('utf-8', "replace")   #json['description'].decode('utf-8', "replace")
crx4update['version'] = version
#hid = PUTHIS(crtcrx, "U")
#crx4update['hisid'] = crx4update['hisid'].append(hid)
raw = ujsfile.file.read() # This is dangerous for big files
sid, uri = PUT2SS(raw, uuid, 'sae')
crx4update['sid'] = sid
ujsfile.file.close()
KV.set(uuid, crx4update)
#print KV.get(uuid)
xid = crx4update['id']

</t>
<t tx="zoomq.20121015120918.6112">crx = deepcopy(CFG.objCRX)
xid = GENID('crx')
crx['id'] = xid
crx['uuid'] = uuid
crx['sid'] = sid
#hid = PUTHIS(crx, "C")
#crx['hisid'] = crx['hisid'].append(hid)
crx['name'] = name.decode('utf-8', "replace")          #.decode('utf-8', "replace")
crx['desc'] = desc.decode('utf-8', "replace")   #.decode('utf-8', "replace")
crx['version'] = version
#print crx
KV.add(uuid, crx)
</t>
<t tx="zoomq.20121015120918.6115">@APP.route('/dc/add/&lt;uuid&gt;', method='GET')
def addc(uuid):
    '''add one download count
    '''
    #print "\t&gt;&gt;&gt;GET"
    result = {}
    crx = KV.get(uuid)
    if crx:
        crx['dlrank'] = int(crx['dlrank'])+1
        KV.set(uuid, crx)
        result['dc'] = crx['dlrank']
        result['success'] = 1
    else:
        result['msg'] = "%s NOT exist!"
        result['success'] = 0
    result['method'] = "GET"
    response.set_header('Access-Control-Allow-Origin', '*')
    response.set_header('Access-Control-Allow-Headers', 'x-requested-with')
    response.set_header('Content-Type','application/json; charset=utf-8')
    return result
    #return "callback($scope,['%s','%s'])"%('GET',AJS)


</t>
<t tx="zoomq.20121015120918.6117">@APP.route('/dc/dlrank/&lt;order&gt;', method='GET')
def dlrank(order):
    '''return all UUID by dlrank from memcache!
        - ASC   ~ ascend
        - DESC  ~ descend
    '''
    result = {}
    k4crx, crcrxs = INIobjSYS('crx')
    #print crcrxs
    crtdl = {}
    mc = pylibmc.Client()
    if "ASC" == order:
        result['dlorder'] = mc.get("ASCdlorder")
    else:
        result['dlorder'] = mc.get("DESCdlorder")
    #print mc.get("ASCdlorder")
    #print mc.get("DESCdlorder")
    result['success'] = 1
    result['method'] = "GET"
    response.set_header('Access-Control-Allow-Origin', '*')
    response.set_header('Access-Control-Allow-Headers', 'x-requested-with')
    response.set_header('Content-Type','application/json; charset=utf-8')
    return result
    #return "callback($scope,['%s','%s'])"%('GET',AJS)
    
</t>
<t tx="zoomq.20121015120918.7800">@APP.route('/cron/dlrank', method='GET')
def cron4dlrank():
    '''return all UUID by dlrank 
        - ASC   ~ ascend
        - DESC  ~ descend
    '''
    k4crx, crcrxs = INIobjSYS('crx')
    crtdl = {}
    for k in crcrxs:
        crtdl[k] = int(KV.get(k)['dlrank'])
    mc = pylibmc.Client()
    mc.set("ASCdlorder", pep265sd(crtdl,doreverse = False))
    mc.set("DESCdlorder", pep265sd(crtdl,doreverse = True))
    print "CRONed for dlrank update Memcache&lt;&lt;&lt;"
    #print "ASCdlorder cronED::", mc.get("ASCdlorder")
    #print "DESCdlorder cronED::", mc.get("DESCdlorder")


</t>
<t tx="zoomq.20121015120918.7801">from operator import itemgetter
def pep265sd(d,doreverse=False):
    '''proposed in PEP 265, using  the itemgetter
    '''
    return sorted(d.iteritems(), key=itemgetter(1), reverse=doreverse)
</t>
</tnodes>
</leo_file>
